[{"rule_id": 135, "name": "Unit42_MXSIAM_TI_Proactive Threat Hunt Targeting Evolving Muddled Libra (Scattered Spider) and Associated Groups 11", "severity": "SEV_030_MEDIUM", "xql_query": "//MITRE ATT&CK TTP ID: T1071.001 \u2013 Application Layer Protocol: Web Protocols\r\nconfig case_sensitive = false | dataset = xdr_data | filter event_type = ENUM.STORY | filter action_remote_ip in (\"104.247.82.11\",\"105.101.56.49\",\"105.158.12.236\",\"134.209.48.68\",\"137.220.61.53\",\"138.68.27.0\",\"146.190.44.66\",\"149.28.125.96\",\"157.245.4.113\",\"159.223.208.47\",\"159.223.238.0\",\"162.19.135.215\",\"164.92.234.104\",\"165.22.201.77\",\"167.99.221.10\",\"172.96.11.245\",\"185.56.80.28\",\"188.166.92.55\",\"193.149.129.177\",\"207.148.0.54\",\"213.226.123.104\",\"35.175.153.217\",\"45.156.85.140\",\"45.32.221.250\",\"64.227.30.114\",\"79.137.196.160\",\"92.99.114.231\") | fields _time, agent_hostname, actor_process_command_line, causality_actor_process_command_line, action_local_ip, action_remote_ip, action_remote_port, dns_query_name, action_external_hostname, dst_action_external_hostname, action_network_dpi_fields, uri", "is_enabled": true, "description": "Indicators of Compromise gathered by Unit 42 Intelligence for Muddled Libra activity.", "alert_name": "Unit42_MXSIAM_TI_Proactive Threat Hunt Targeting Evolving Muddled Libra (Scattered Spider) and Associated Groups 11", "alert_category": "OTHER", "alert_type": null, "alert_description": "Indicators of Compromise gathered by Unit 42 Intelligence for Muddled Libra activity.", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "0 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "//MITRE ATT&CK TTP ID: T1071.001 \u2013 Application Layer Protocol: Web Protocols\r\nconfig case_sensitive = false | dataset = xdr_data | filter event_type = ENUM.STORY | filter action_remote_ip in (\"104.247.82.11\",\"105.101.56.49\",\"105.158.12.236\",\"134.209.48.68\",\"137.220.61.53\",\"138.68.27.0\",\"146.190.44.66\",\"149.28.125.96\",\"157.245.4.113\",\"159.223.208.47\",\"159.223.238.0\",\"162.19.135.215\",\"164.92.234.104\",\"165.22.201.77\",\"167.99.221.10\",\"172.96.11.245\",\"185.56.80.28\",\"188.166.92.55\",\"193.149.129.177\",\"207.148.0.54\",\"213.226.123.104\",\"35.175.153.217\",\"45.156.85.140\",\"45.32.221.250\",\"64.227.30.114\",\"79.137.196.160\",\"92.99.114.231\") | fields _time, agent_hostname, actor_process_command_line, causality_actor_process_command_line, action_local_ip, action_remote_ip, action_remote_port, dns_query_name, action_external_hostname, dst_action_external_hostname, action_network_dpi_fields, uri", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": []}, {"rule_id": 134, "name": "Unit42_MXSIAM_TI_Proactive Threat Hunt Targeting Evolving Muddled Libra (Scattered Spider) and Associated Groups 10", "severity": "SEV_030_MEDIUM", "xql_query": "//MITRE ATT&CK TTP ID: T1074.001 \u2013 Data Staged: Local Data Staging\r\npreset = xdr_file | fields _time, agent_hostname, action_file_name, action_file_path, actor_process_command_line, causality_actor_process_command_line | filter lowercase(action_file_path) = \"c:\\users\\public\\log.log\"", "is_enabled": true, "description": "DragonForce logs are encrypted with ChaCha8 and written to C:\\Users\\Public\\log.log.", "alert_name": "Unit42_MXSIAM_TI_Proactive Threat Hunt Targeting Evolving Muddled Libra (Scattered Spider) and Associated Groups 10", "alert_category": "OTHER", "alert_type": null, "alert_description": "DragonForce logs are encrypted with ChaCha8 and written to C:\\Users\\Public\\log.log.", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "0 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "//MITRE ATT&CK TTP ID: T1074.001 \u2013 Data Staged: Local Data Staging\r\npreset = xdr_file | fields _time, agent_hostname, action_file_name, action_file_path, actor_process_command_line, causality_actor_process_command_line | filter lowercase(action_file_path) = \"c:\\users\\public\\log.log\"", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": []}, {"rule_id": 133, "name": "Unit42_MXSIAM_TI_Proactive Threat Hunt Targeting Evolving Muddled Libra (Scattered Spider) and Associated Groups 9", "severity": "SEV_030_MEDIUM", "xql_query": "//MITRE ATT&CK TTP ID: T1543.003 \u2013 Create or Modify System Process: Windows Service\r\ndataset = xdr_data | fields _time, agent_hostname, action_file_name, action_file_path, action_module_path, action_module_file_info, action_module_signature_vendor, actor_process_command_line, causality_actor_process_command_line, event_type, event_sub_type, agent_os_type | filter event_type in (ENUM.FILE, ENUM.LOAD_IMAGE) and agent_os_type = ENUM.AGENT_OS_WINDOWS | alter action_module_name = arrayindex(split(action_module_path, \"\\\"), -1) | alter module_original_name = action_module_file_info -> original_name | alter module_internal_name = action_module_file_info -> internal_name | alter module_file_version = action_module_file_info -> file_version | alter module_description = action_module_file_info -> description \r\n| filter action_file_name in (\"TrueSight.sys\", \"RentDrv.sys\") or action_module_name in (\"TrueSight.sys\", \"RentDrv.sys\") or action_module_signature_vendor = \"Hangzhou Shunwang Technology Co.,Ltd\" or ((module_description = \"RogueKiller Antirootkit Driver\" and module_file_version = \"3.3.0\") or module_original_name = \"Truesight\" or module_internal_name = \"Truesight\")", "is_enabled": true, "description": "This query identifies the dropping and loading of the TrueSight.sys and RentDrv.sys vulnerable drivers. DragonForce ransomware is known to use these drivers in a technique called \"Bring Your Own Vulnerable Driver\" (BYOVD) for process termination to evade detection.", "alert_name": "Unit42_MXSIAM_TI_Proactive Threat Hunt Targeting Evolving Muddled Libra (Scattered Spider) and Associated Groups 9", "alert_category": "OTHER", "alert_type": null, "alert_description": "This query identifies the dropping and loading of the TrueSight.sys and RentDrv.sys vulnerable drivers. DragonForce ransomware is known to use these drivers in a technique called \"Bring Your Own Vulnerable Driver\" (BYOVD) for process termination to evade detection.", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "0 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "//MITRE ATT&CK TTP ID: T1543.003 \u2013 Create or Modify System Process: Windows Service\r\ndataset = xdr_data | fields _time, agent_hostname, action_file_name, action_file_path, action_module_path, action_module_file_info, action_module_signature_vendor, actor_process_command_line, causality_actor_process_command_line, event_type, event_sub_type, agent_os_type | filter event_type in (ENUM.FILE, ENUM.LOAD_IMAGE) and agent_os_type = ENUM.AGENT_OS_WINDOWS | alter action_module_name = arrayindex(split(action_module_path, \"\\\"), -1) | alter module_original_name = action_module_file_info -> original_name | alter module_internal_name = action_module_file_info -> internal_name | alter module_file_version = action_module_file_info -> file_version | alter module_description = action_module_file_info -> description \r\n| filter action_file_name in (\"TrueSight.sys\", \"RentDrv.sys\") or action_module_name in (\"TrueSight.sys\", \"RentDrv.sys\") or action_module_signature_vendor = \"Hangzhou Shunwang Technology Co.,Ltd\" or ((module_description = \"RogueKiller Antirootkit Driver\" and module_file_version = \"3.3.0\") or module_original_name = \"Truesight\" or module_internal_name = \"Truesight\")", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": []}, {"rule_id": 132, "name": "Unit42_MXSIAM_TI_Proactive Threat Hunt Targeting Evolving Muddled Libra (Scattered Spider) and Associated Groups 8", "severity": "SEV_030_MEDIUM", "xql_query": "//MITRE ATT&CK TTP ID: T1547.001 \u2013 Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder\r\npreset = xdr_registry | filter agent_os_type = ENUM.AGENT_OS_WINDOWS | filter lowercase(action_registry_key_name) ~= \".*\\\\software\\\\microsoft\\\\windows\\\\currentversion\\\\run$\" and (lowercase(action_registry_data) contains \"powershell.exe -windowstyle hidden -command & \" or lowercase(action_registry_value_name) = \"socks5\" ) | fields _time, agent_hostname, action_registry_key_name, action_registry_value_name, action_registry_data, actor_process_command_line, causality_actor_process_command_line", "is_enabled": true, "description": "This query detects Run registry key creation used for persistence by the SystemBC malware.", "alert_name": "Unit42_MXSIAM_TI_Proactive Threat Hunt Targeting Evolving Muddled Libra (Scattered Spider) and Associated Groups 8", "alert_category": "OTHER", "alert_type": null, "alert_description": "This query detects Run registry key creation used for persistence by the SystemBC malware.", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "0 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "//MITRE ATT&CK TTP ID: T1547.001 \u2013 Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder\r\npreset = xdr_registry | filter agent_os_type = ENUM.AGENT_OS_WINDOWS | filter lowercase(action_registry_key_name) ~= \".*\\\\software\\\\microsoft\\\\windows\\\\currentversion\\\\run$\" and (lowercase(action_registry_data) contains \"powershell.exe -windowstyle hidden -command & \" or lowercase(action_registry_value_name) = \"socks5\" ) | fields _time, agent_hostname, action_registry_key_name, action_registry_value_name, action_registry_data, actor_process_command_line, causality_actor_process_command_line", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": []}, {"rule_id": 131, "name": "Unit42_MXSIAM_TI_Proactive Threat Hunt Targeting Evolving Muddled Libra (Scattered Spider) and Associated Groups 7", "severity": "SEV_030_MEDIUM", "xql_query": "//MITRE ATT&CK TTP ID: T1486 \u2013 Data Encrypted for Impact\r\nconfig case_sensitive = false | dataset = xdr_data | fields _time, agent_hostname, action_file_name, action_file_path, actor_process_command_line, causality_actor_process_command_line, event_type, event_sub_type, agent_os_type, action_file_extension | filter event_type = ENUM.FILE and agent_os_type = ENUM.AGENT_OS_WINDOWS | filter action_file_extension in (\"dragonforce_encrypted\", \"cyberbears\")", "is_enabled": true, "description": "This query searches for known file extensions used by DragonForce ransomware for encrypted files. Known affiliates of Scattered Spider have been observed deploying DragonForce ransomware.", "alert_name": "Unit42_MXSIAM_TI_Proactive Threat Hunt Targeting Evolving Muddled Libra (Scattered Spider) and Associated Groups - DragonForce Filename Extensions of Encrypted Files", "alert_category": "OTHER", "alert_type": null, "alert_description": "This query searches for known file extensions used by DragonForce ransomware for encrypted files. Known affiliates of Scattered Spider have been observed deploying DragonForce ransomware.", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "0 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "//MITRE ATT&CK TTP ID: T1486 \u2013 Data Encrypted for Impact\r\nconfig case_sensitive = false | dataset = xdr_data | fields _time, agent_hostname, action_file_name, action_file_path, actor_process_command_line, causality_actor_process_command_line, event_type, event_sub_type, agent_os_type, action_file_extension | filter event_type = ENUM.FILE and agent_os_type = ENUM.AGENT_OS_WINDOWS | filter action_file_extension in (\"dragonforce_encrypted\", \"cyberbears\")", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": []}, {"rule_id": 130, "name": "Unit42_MXSIAM_TI_Proactive Threat Hunt Targeting Evolving Muddled Libra (Scattered Spider) and Associated Groups 6", "severity": "SEV_030_MEDIUM", "xql_query": "//MITRE ATT&CK TTP IDs:T1133 \u2013 External Remote Services Defense Evasion , T1219 \u2013 Remote Access Software\r\nconfig case_sensitive = false | dataset = xdr_data | filter agent_os_type = ENUM.AGENT_OS_WINDOWS and event_type = ENUM.PROCESS and event_sub_type = ENUM.PROCESS_START | filter action_process_image_path in ( \"*aweray_remote*.exe\",\"*AweSun.exe\",\"*aa_v*.exe\",\"*AeroAdmin.exe\",\"*anydesk.exe\",\"*AnyViewerSetup.exe\",\"*RCClient.exe\",\"*RCService.exe\",\"*atera_agent.exe\",\"*bomgar-scc.exe\",\"*bomgar-rdp.exe\",\"*screenconnect.clientservice.exe\",\"*screenconnect.windowsclient.exe\",\"*distant-desktop.exe\",\"*dwagsvc.exe\",\"*g2comm.exe\",\"*g2fileh.exe\",\"*g2host.exe\",\"*g2mainh.exe\",\"*g2printh.exe\",\"*g2svc.exe\",\"*g2tray.exe\",\"*gopcsrv.exe\",\"*ROMServer.exe\",\"*ROMFUSClient.exe\",\"*termsrv.exe\",\"*client32.exe\",\"*awrem32.exe\",\"*awhost32.exe\",\"*PCMonitorManager.exe\",\"*pcmonitorsrv.exe\",\"*quickassist.exe\",\"*radmin3.exe\",\"*famitrfc.exe\",\"*rserver3.exe\",\"*rutserv.exe\",\"*rutview.exe\",\"*Remote Workforce Client.exe\",\"*strwinclt.exe\",\"*supremo.exe\",\"*supremohelper.exe\",\"*supremosystem.exe\",\"*teamviewer_desktop.exe\",\"*teamviewer.exe\",\"*teamviewer.exe\",\"*teamviewer_service.exe\",\"*teamviewerhost\",\"*winvnc.exe\",\"*vncviewer.exe\",\"*winvncsc.exe\",\"*winwvc.exe\",\"*saazapsc.exe\",\"*lmiignition.exe\",\"*lmiguardiansvc.exe\",\"*logmein.exe\",\"*UltraVNC*.exe\",\"*Zaservice.exe\",\"*Zohours.exe\",\"*ZohoMeeting.exe\",\"*dcagentservice.exe\",\"*UltraViewer_Desktop.exe\",\"*UltraViewer_setup*\",\"*UltraViewer_Service.exe\",\"*NinjaRMMAgent.exe\",\"*NinjaRMMAgenPatcher.exe\",\"*ninjarmm-cli.exe\",\"*fleetdeck_agent.exe\",\"*fleetdeck_agent_svc.exe\",\"*fleetdeck_installer.exe\",\"*fleetdeck_commander_svc.exe\",\"*fleetdeck_commander_launcher.exe\",\"*level-windows-amd64.exe\",\"*level.exe\",\"*level-remote-control-ffmpeg.exe\",\"*FixMeit Expert Setup.exe\",\"*FixMeit Client.exe\",\"*FixMeitClient*.exe\",\"*TiExpertStandalone.exe\",\"*TiExpertCore.exe\",\"*FixMeit Unattended Access Setup.exe\",\"*ITarianRemoteAccessSetup.exe\",\"*ComodoRemoteControl.exe\",\"*RAccess.exe\",\"*RViewer.exe\",\"*domotz.exe\",\"*Domotz Pro Desktop App Setup*.exe\",\"*Domotz Pro Desktop App.exe\",\"*domotz-windows*.exe\",\"*rport.exe\",\"*Sorillus Launcher.exe\",\"*Sorillus-Launcher*.exe\",\"*Syncro.Service.exe\",\"*Syncro.Installer.exe\",\"*Syncro.App.Runner.exe\",\"*SyncroLive.Agent.exe\",\"*SyncroLive.Service.exe\",\"*Syncro.Overmind.Service.exe\",\"*KabutoSetup.exe\",\"*Kabuto.Installer.exe\",\"*Kabuto.Service.Runner.exe\",\"*Kabuto.App.Runner.exe\",\"*rustdesk*.exe\",\"*ERAAgent.exe\",\"*dwrcs.exe\",\"*DameWare Remote Support.exe\",\"*SolarWinds-Dameware-DRS*.exe\",\"*DameWare Mini Remote Control*.exe\",\"*SolarWinds-Dameware-MRC*.exe\",\"*Agent_*_RW.exe\",\"*winagent.exe\",\"*BASupApp.exe\",\"*TakeControl.exe\",\"*BASupSysInf.exe\",\"*BASupAppSrvc.exe\",\"*BASupAppElev.exe\",\"*SplashtopSOS.exe\",\"*SRServer.exe\",\"*Splashtop_Streamer_Windows*.exe\",\"*SRManager.exe\",\"*GotoHTTP*.exe\",\"*action1_agent.exe\",\"*action1_remote.exe\",\"*action1_connector.exe\",\"*action1_update.exe\",\"*TightVNCViewerPortable*.exe\",\"*tvnviewer.exe\",\"*tvnserver.exe\",\"*smpcsetup.exe\",\"*showmypc*.exe\",\"*ImperoClientSVC.exe\",\"*InstantHousecall.exe\",\"*ISLLight.exe\",\"*ISLLightClient.exe\",\"*TSClient.exe\",\"*Pilixo_Installer*.exe\",\"*idrive.RemotePCAgent\",\"*Idrive.File-Transfer\",\"*RemotePC.exe\",\"*RemotePCService.exe\",\"*superops.exe\",\"*superopsticket.exe\",\"*RDConsole.exe\",\"*RocketRemoteDesktop_Setup.exe\",\"*GetScreen.exe\",\"*ManageEngine_Remote_Access_Plus.exe\",\"*InstallShield Setup.exe\",\"*remcos*.exe\",\"*g2aprocessfactory.exe\",\"*AEMAgent.exe\",\"*KaseyaAgent\",\"*mRemoteNG.exe\",\"*MeshAgent.exe\",\"*Remote Access.exe\" ) | alter company = action_process_file_info -> company | bin _time span = 1d | fields _time, agent_hostname, actor_effective_username, action_process_image_path, action_process_image_command_line, action_process_image_sha256, actor_process_image_path, actor_process_command_line, causality_actor_process_image_path, causality_actor_process_command_line, company | comp count_distinct(company) as RMM_Company_count, values(action_process_image_path) as RMM_File, values(company) as RMM_company by agent_hostname, _time | filter RMM_Company_count > 4", "is_enabled": true, "description": "Identifies hosts on which an unusually high number of different Remote Monitoring and Management (RMM) tools have been installed within a 24-hour period. Threat actors like Muddled Libra often install multiple RMM tools to ensure persistent access to compromised environments.", "alert_name": "Unit42_MXSIAM_TI_Proactive Threat Hunt Targeting Evolving Muddled Libra (Scattered Spider) and Associated Groups - Multiple RMM Tool Installation - Potential Muddled Libra/Scattered Spider Persistence", "alert_category": "OTHER", "alert_type": null, "alert_description": "Identifies hosts on which an unusually high number of different Remote Monitoring and Management (RMM) tools have been installed within a 24-hour period. Threat actors like Muddled Libra often install multiple RMM tools to ensure persistent access to compromised environments.", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "0 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "//MITRE ATT&CK TTP IDs:T1133 \u2013 External Remote Services Defense Evasion , T1219 \u2013 Remote Access Software\r\nconfig case_sensitive = false | dataset = xdr_data | filter agent_os_type = ENUM.AGENT_OS_WINDOWS and event_type = ENUM.PROCESS and event_sub_type = ENUM.PROCESS_START | filter action_process_image_path in ( \"*aweray_remote*.exe\",\"*AweSun.exe\",\"*aa_v*.exe\",\"*AeroAdmin.exe\",\"*anydesk.exe\",\"*AnyViewerSetup.exe\",\"*RCClient.exe\",\"*RCService.exe\",\"*atera_agent.exe\",\"*bomgar-scc.exe\",\"*bomgar-rdp.exe\",\"*screenconnect.clientservice.exe\",\"*screenconnect.windowsclient.exe\",\"*distant-desktop.exe\",\"*dwagsvc.exe\",\"*g2comm.exe\",\"*g2fileh.exe\",\"*g2host.exe\",\"*g2mainh.exe\",\"*g2printh.exe\",\"*g2svc.exe\",\"*g2tray.exe\",\"*gopcsrv.exe\",\"*ROMServer.exe\",\"*ROMFUSClient.exe\",\"*termsrv.exe\",\"*client32.exe\",\"*awrem32.exe\",\"*awhost32.exe\",\"*PCMonitorManager.exe\",\"*pcmonitorsrv.exe\",\"*quickassist.exe\",\"*radmin3.exe\",\"*famitrfc.exe\",\"*rserver3.exe\",\"*rutserv.exe\",\"*rutview.exe\",\"*Remote Workforce Client.exe\",\"*strwinclt.exe\",\"*supremo.exe\",\"*supremohelper.exe\",\"*supremosystem.exe\",\"*teamviewer_desktop.exe\",\"*teamviewer.exe\",\"*teamviewer.exe\",\"*teamviewer_service.exe\",\"*teamviewerhost\",\"*winvnc.exe\",\"*vncviewer.exe\",\"*winvncsc.exe\",\"*winwvc.exe\",\"*saazapsc.exe\",\"*lmiignition.exe\",\"*lmiguardiansvc.exe\",\"*logmein.exe\",\"*UltraVNC*.exe\",\"*Zaservice.exe\",\"*Zohours.exe\",\"*ZohoMeeting.exe\",\"*dcagentservice.exe\",\"*UltraViewer_Desktop.exe\",\"*UltraViewer_setup*\",\"*UltraViewer_Service.exe\",\"*NinjaRMMAgent.exe\",\"*NinjaRMMAgenPatcher.exe\",\"*ninjarmm-cli.exe\",\"*fleetdeck_agent.exe\",\"*fleetdeck_agent_svc.exe\",\"*fleetdeck_installer.exe\",\"*fleetdeck_commander_svc.exe\",\"*fleetdeck_commander_launcher.exe\",\"*level-windows-amd64.exe\",\"*level.exe\",\"*level-remote-control-ffmpeg.exe\",\"*FixMeit Expert Setup.exe\",\"*FixMeit Client.exe\",\"*FixMeitClient*.exe\",\"*TiExpertStandalone.exe\",\"*TiExpertCore.exe\",\"*FixMeit Unattended Access Setup.exe\",\"*ITarianRemoteAccessSetup.exe\",\"*ComodoRemoteControl.exe\",\"*RAccess.exe\",\"*RViewer.exe\",\"*domotz.exe\",\"*Domotz Pro Desktop App Setup*.exe\",\"*Domotz Pro Desktop App.exe\",\"*domotz-windows*.exe\",\"*rport.exe\",\"*Sorillus Launcher.exe\",\"*Sorillus-Launcher*.exe\",\"*Syncro.Service.exe\",\"*Syncro.Installer.exe\",\"*Syncro.App.Runner.exe\",\"*SyncroLive.Agent.exe\",\"*SyncroLive.Service.exe\",\"*Syncro.Overmind.Service.exe\",\"*KabutoSetup.exe\",\"*Kabuto.Installer.exe\",\"*Kabuto.Service.Runner.exe\",\"*Kabuto.App.Runner.exe\",\"*rustdesk*.exe\",\"*ERAAgent.exe\",\"*dwrcs.exe\",\"*DameWare Remote Support.exe\",\"*SolarWinds-Dameware-DRS*.exe\",\"*DameWare Mini Remote Control*.exe\",\"*SolarWinds-Dameware-MRC*.exe\",\"*Agent_*_RW.exe\",\"*winagent.exe\",\"*BASupApp.exe\",\"*TakeControl.exe\",\"*BASupSysInf.exe\",\"*BASupAppSrvc.exe\",\"*BASupAppElev.exe\",\"*SplashtopSOS.exe\",\"*SRServer.exe\",\"*Splashtop_Streamer_Windows*.exe\",\"*SRManager.exe\",\"*GotoHTTP*.exe\",\"*action1_agent.exe\",\"*action1_remote.exe\",\"*action1_connector.exe\",\"*action1_update.exe\",\"*TightVNCViewerPortable*.exe\",\"*tvnviewer.exe\",\"*tvnserver.exe\",\"*smpcsetup.exe\",\"*showmypc*.exe\",\"*ImperoClientSVC.exe\",\"*InstantHousecall.exe\",\"*ISLLight.exe\",\"*ISLLightClient.exe\",\"*TSClient.exe\",\"*Pilixo_Installer*.exe\",\"*idrive.RemotePCAgent\",\"*Idrive.File-Transfer\",\"*RemotePC.exe\",\"*RemotePCService.exe\",\"*superops.exe\",\"*superopsticket.exe\",\"*RDConsole.exe\",\"*RocketRemoteDesktop_Setup.exe\",\"*GetScreen.exe\",\"*ManageEngine_Remote_Access_Plus.exe\",\"*InstallShield Setup.exe\",\"*remcos*.exe\",\"*g2aprocessfactory.exe\",\"*AEMAgent.exe\",\"*KaseyaAgent\",\"*mRemoteNG.exe\",\"*MeshAgent.exe\",\"*Remote Access.exe\" ) | alter company = action_process_file_info -> company | bin _time span = 1d | fields _time, agent_hostname, actor_effective_username, action_process_image_path, action_process_image_command_line, action_process_image_sha256, actor_process_image_path, actor_process_command_line, causality_actor_process_image_path, causality_actor_process_command_line, company | comp count_distinct(company) as RMM_Company_count, values(action_process_image_path) as RMM_File, values(company) as RMM_company by agent_hostname, _time | filter RMM_Company_count > 4", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": []}, {"rule_id": 129, "name": "Unit42_MXSIAM_TI_Proactive Threat Hunt Targeting Evolving Muddled Libra (Scattered Spider) and Associated Groups 5", "severity": "SEV_030_MEDIUM", "xql_query": "//MITRE ATT&CK TTP ID: T1098.004 \u2013 Account Manipulation: Add or Modify Authentication\r\nconfig case_sensitive = false | dataset = cloud_audit_logs | filter log_name = \"azure_ad_audit_logs\" | filter operation_name_orig contains \"User registered security info\" | alter initiatedBy_userPrincipalName = json_extract(raw_log, \"$.initiatedBy.user.userPrincipalName\")| alter initiatedBy_userID = json_extract(raw_log, \"$.initiatedBy.user.id\") | alter initiatedBy_IpAddress = json_extract(raw_log, \"$.initiatedBy.user.ipAddress\") | alter resultReason = json_extract(raw_log, \"$.resultReason\") | filter resultReason in (\"*User registered Alternate Mobile Phone Call*\", \"*User registered Authenticator App with Code*\", \"*User registered Authenticator App with Notification*\", \"*User registered Email Authentication Method*\", \"*User registered Email*\", \"*User registered Mobile Phone Call*\", \"*User registered Mobile Phone SMS*\", \"*User registered Office Phone Call*\", \"*User registered phone method*\") | alter operationType = json_extract(raw_log, \"$.operationType\") | alter loggedByService = json_extract(raw_log, \"$.loggedByService\") | alter TargetuserPrincipalName = json_extract(raw_log, \"$.targetResources.0.userPrincipalName\") | filter loggedByService contains \"Authentication Methods\" | fields _time, identity_name, operation_name_orig, operation_status, initiatedBy_userPrincipalName, initiatedBy_userID, initiatedBy_IpAddress, resultReason, operationType, loggedByService, TargetuserPrincipalName, raw_log | filter initiatedBy_userPrincipalName != TargetuserPrincipalName", "is_enabled": true, "description": "Identifies instances where a user (identified by initiatedBy_userPrincipalName) registers a new MFA method for a different user (identified by TargetuserPrincipalName) in Azure Active Directory. This behavior is highly suspicious and can indicate an attacker who has gained access to an account and is attempting to establish persistence or facilitate lateral movement by adding their own MFA method.", "alert_name": "Unit42_MXSIAM_TI_Proactive Threat Hunt Targeting Evolving Muddled Libra (Scattered Spider) and Associated Groups - Suspicious MFA Registration by Different User", "alert_category": "OTHER", "alert_type": null, "alert_description": "Identifies instances where a user (identified by initiatedBy_userPrincipalName) registers a new MFA method for a different user (identified by TargetuserPrincipalName) in Azure Active Directory. This behavior is highly suspicious and can indicate an attacker who has gained access to an account and is attempting to establish persistence or facilitate lateral movement by adding their own MFA method.", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {"accountid": "initiatedBy_userID", "operationname": "operation_name_orig", "action_local_ip": "initiatedBy_IpAddress", "actor_process_image_name": "identity_name"}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "0 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["identity_name"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "//MITRE ATT&CK TTP ID: T1098.004 \u2013 Account Manipulation: Add or Modify Authentication\r\nconfig case_sensitive = false | dataset = cloud_audit_logs | filter log_name = \"azure_ad_audit_logs\" | filter operation_name_orig contains \"User registered security info\" | alter initiatedBy_userPrincipalName = json_extract(raw_log, \"$.initiatedBy.user.userPrincipalName\")| alter initiatedBy_userID = json_extract(raw_log, \"$.initiatedBy.user.id\") | alter initiatedBy_IpAddress = json_extract(raw_log, \"$.initiatedBy.user.ipAddress\") | alter resultReason = json_extract(raw_log, \"$.resultReason\") | filter resultReason in (\"*User registered Alternate Mobile Phone Call*\", \"*User registered Authenticator App with Code*\", \"*User registered Authenticator App with Notification*\", \"*User registered Email Authentication Method*\", \"*User registered Email*\", \"*User registered Mobile Phone Call*\", \"*User registered Mobile Phone SMS*\", \"*User registered Office Phone Call*\", \"*User registered phone method*\") | alter operationType = json_extract(raw_log, \"$.operationType\") | alter loggedByService = json_extract(raw_log, \"$.loggedByService\") | alter TargetuserPrincipalName = json_extract(raw_log, \"$.targetResources.0.userPrincipalName\") | filter loggedByService contains \"Authentication Methods\" | fields _time, identity_name, operation_name_orig, operation_status, initiatedBy_userPrincipalName, initiatedBy_userID, initiatedBy_IpAddress, resultReason, operationType, loggedByService, TargetuserPrincipalName, raw_log | filter initiatedBy_userPrincipalName != TargetuserPrincipalName", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "CUSTOM", "action": "ALERTS", "lookup_mapping": []}, {"rule_id": 127, "name": "Unit42_MXSIAM_TI_Proactive Threat Hunt Targeting Evolving Muddled Libra (Scattered Spider) and Associated Groups 4", "severity": "SEV_030_MEDIUM", "xql_query": "//MITRE ATT&CK TTP ID: T1098.004 \u2013 Account Manipulation: Add or Modify Authentication\r\nconfig case_sensitive = false | dataset = cloud_audit_logs | filter log_name = \"azure_ad_audit_logs\" | filter operation_name_orig contains \"User registered security info\" | alter initiatedBy_userPrincipalName = json_extract(raw_log, \"$.initiatedBy.user.userPrincipalName\") | alter initiatedBy_userID = json_extract(raw_log, \"$.initiatedBy.user.id\") | alter initiatedBy_IpAddress = json_extract(raw_log, \"$.initiatedBy.user.ipAddress\") | alter resultReason = json_extract(raw_log, \"$.resultReason\") | alter operationType = json_extract(raw_log, \"$.operationType\") | alter loggedByService = json_extract(raw_log, \"$.loggedByService\") |filter loggedByService contains \"Authentication Methods\" | filter resultReason contains \"User registered phone method\" | alter PhoneNUmber = json_extract(raw_log, \"$.targetResources.0.modifiedProperties.2.newValue\") | alter PhoneNUmber = replace(PhoneNUmber, \"\\\"\", \"\") | alter TargetuserPrincipalName = json_extract(raw_log, \"$.targetResources.0.userPrincipalName\") | fields _time, identity_name, operation_name_orig, operation_status, initiatedBy_userPrincipalName, initiatedBy_userID, initiatedBy_IpAddress, resultReason, operationType, loggedByService, PhoneNUmber, TargetuserPrincipalName, raw_log | comp values(_time) as times, count_distinct(TargetuserPrincipalName) as numOfUsers, values(TargetuserPrincipalName) as UsersWithSamePhoneNumber, values(initiatedBy_userPrincipalName) as initiatedBy_userPrincipalName by PhoneNUmber, loggedByService, resultReason | filter numOfUsers > 1 | fields times, initiatedBy_userPrincipalName, PhoneNUmber, UsersWithSamePhoneNumber, numOfUsers, resultReason", "is_enabled": true, "description": "Identifies instances where a single phone number is registered as a security authentication method across multiple user accounts in Azure Active Directory. This behavior can indicate attacker-controlled device registration, a technique potentially used by threat actors to gain unauthorized access or maintain persistence by associating their devices with legitimate user accounts.", "alert_name": "Unit42_MXSIAM_TI_Proactive Threat Hunt Targeting Evolving Muddled Libra (Scattered Spider) and Associated Groups - Suspicious Phone Number Registration Across Multiple User Accounts", "alert_category": "OTHER", "alert_type": null, "alert_description": "Identifi es instances where a single phone number is registered as a security authentication method across multiple user accounts in Azure Active Directory. This behavior can indicate attacker-controlled device registration, a technique potentially used by threat actors to gain unauthorized access or maintain persistence by associating their devices with legitimate user accounts.", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {"phone_number": "PhoneNUmber", "actor_process_image_name": "initiatedBy_userPrincipalName"}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "0 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["initiatedBy_userPrincipalName"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "//MITRE ATT&CK TTP ID: T1098.004 \u2013 Account Manipulation: Add or Modify Authentication\r\nconfig case_sensitive = false | dataset = cloud_audit_logs | filter log_name = \"azure_ad_audit_logs\" | filter operation_name_orig contains \"User registered security info\" | alter initiatedBy_userPrincipalName = json_extract(raw_log, \"$.initiatedBy.user.userPrincipalName\") | alter initiatedBy_userID = json_extract(raw_log, \"$.initiatedBy.user.id\") | alter initiatedBy_IpAddress = json_extract(raw_log, \"$.initiatedBy.user.ipAddress\") | alter resultReason = json_extract(raw_log, \"$.resultReason\") | alter operationType = json_extract(raw_log, \"$.operationType\") | alter loggedByService = json_extract(raw_log, \"$.loggedByService\") |filter loggedByService contains \"Authentication Methods\" | filter resultReason contains \"User registered phone method\" | alter PhoneNUmber = json_extract(raw_log, \"$.targetResources.0.modifiedProperties.2.newValue\") | alter PhoneNUmber = replace(PhoneNUmber, \"\\\"\", \"\") | alter TargetuserPrincipalName = json_extract(raw_log, \"$.targetResources.0.userPrincipalName\") | fields _time, identity_name, operation_name_orig, operation_status, initiatedBy_userPrincipalName, initiatedBy_userID, initiatedBy_IpAddress, resultReason, operationType, loggedByService, PhoneNUmber, TargetuserPrincipalName, raw_log | comp values(_time) as times, count_distinct(TargetuserPrincipalName) as numOfUsers, values(TargetuserPrincipalName) as UsersWithSamePhoneNumber, values(initiatedBy_userPrincipalName) as initiatedBy_userPrincipalName by PhoneNUmber, loggedByService, resultReason | filter numOfUsers > 1 | fields times, initiatedBy_userPrincipalName, PhoneNUmber, UsersWithSamePhoneNumber, numOfUsers, resultReason", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "CUSTOM", "action": "ALERTS", "lookup_mapping": []}, {"rule_id": 128, "name": "Unit42_MXSIAM_TI_Proactive Threat Hunt Targeting Evolving Muddled Libra (Scattered Spider) and Associated Groups 3", "severity": "SEV_030_MEDIUM", "xql_query": "//MITRE ATT&CK TTP ID: T1098.004 \u2013 Account Manipulation: Add or Modify Authentication\r\nconfig case_sensitive = false | dataset = cloud_audit_logs | filter log_name = \"azure_ad_audit_logs\" | filter operation_name_orig contains \"User registered security info\" | alter initiatedBy_userPrincipalName = json_extract(raw_log, \"$.initiatedBy.user.userPrincipalName\") | alter initiatedBy_userID = json_extract(raw_log, \"$.initiatedBy.user.id\") | alter initiatedBy_IpAddress = json_extract(raw_log, \"$.initiatedBy.user.ipAddress\") | alter resultReason = json_extract(raw_log, \"$.resultReason\") | alter operationType = json_extract(raw_log, \"$.operationType\") | alter loggedByService = json_extract(raw_log, \"$.loggedByService\") | alter TargetuserPrincipalName = json_extract(raw_log, \"$.targetResources.0.userPrincipalName\") | alter TargetuserPrincipalName = replace(TargetuserPrincipalName, \"\\\"\",\"\") | alter emailDomain = arrayindex(split(TargetuserPrincipalName,\"@\"),1) | filter loggedByService contains \"Authentication Methods\" | filter resultReason contains \"User registered Email Authentication Method\" | alter EmailAddress = json_extract(raw_log, \"$.targetResources.0.modifiedProperties.0.newValue\")| alter EmailAddress = replace(EmailAddress, \"\\\"\",\"\") | filter EmailAddress not contains emailDomain | fields _time, identity_name, operation_name_orig, operation_status, initiatedBy_userPrincipalName, initiatedBy_userID, initiatedBy_IpAddress, resultReason, operationType, loggedByService, EmailAddress, TargetuserPrincipalName, raw_log", "is_enabled": true, "description": "Identifies instances where an email address from a domain outside the organization's approved domains is registered as a security authentication method for a user account in Azure Active Directory. This behavior can be indicative of an attacker attempting to add their own email address as an MFA option, potentially allowing them to bypass MFA and gain unauthorized access.", "alert_name": "Unit42_MXSIAM_TI_Proactive Threat Hunt Targeting Evolving Muddled Libra (Scattered Spider) and Associated Groups - Suspicious External Email Registration as MFA Method", "alert_category": "OTHER", "alert_type": null, "alert_description": "Identifi es instances where an email address from a domain outside the organization's approved domains is registered as a security authentication method for a user account in Azure Active Directory. This behavior can be indicative of an attacker attempting to add their own email address as an MFA option, potentially allowing them to bypass MFA and gain unauthorized access.", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {"email": "EmailAddress", "operationname": "operation_name_orig", "action_local_ip": "initiatedBy_IpAddress", "actor_process_image_name": "identity_name"}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "0 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["identity_name"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "//MITRE ATT&CK TTP ID: T1098.004 \u2013 Account Manipulation: Add or Modify Authentication\r\nconfig case_sensitive = false | dataset = cloud_audit_logs | filter log_name = \"azure_ad_audit_logs\" | filter operation_name_orig contains \"User registered security info\" | alter initiatedBy_userPrincipalName = json_extract(raw_log, \"$.initiatedBy.user.userPrincipalName\") | alter initiatedBy_userID = json_extract(raw_log, \"$.initiatedBy.user.id\") | alter initiatedBy_IpAddress = json_extract(raw_log, \"$.initiatedBy.user.ipAddress\") | alter resultReason = json_extract(raw_log, \"$.resultReason\") | alter operationType = json_extract(raw_log, \"$.operationType\") | alter loggedByService = json_extract(raw_log, \"$.loggedByService\") | alter TargetuserPrincipalName = json_extract(raw_log, \"$.targetResources.0.userPrincipalName\") | alter TargetuserPrincipalName = replace(TargetuserPrincipalName, \"\\\"\",\"\") | alter emailDomain = arrayindex(split(TargetuserPrincipalName,\"@\"),1) | filter loggedByService contains \"Authentication Methods\" | filter resultReason contains \"User registered Email Authentication Method\" | alter EmailAddress = json_extract(raw_log, \"$.targetResources.0.modifiedProperties.0.newValue\")| alter EmailAddress = replace(EmailAddress, \"\\\"\",\"\") | filter EmailAddress not contains emailDomain | fields _time, identity_name, operation_name_orig, operation_status, initiatedBy_userPrincipalName, initiatedBy_userID, initiatedBy_IpAddress, resultReason, operationType, loggedByService, EmailAddress, TargetuserPrincipalName, raw_log", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "CUSTOM", "action": "ALERTS", "lookup_mapping": []}, {"rule_id": 126, "name": "Unit42_MXSIAM_TI_Proactive Threat Hunt Targeting Evolving Muddled Libra (Scattered Spider) and Associated Groups 2", "severity": "SEV_030_MEDIUM", "xql_query": "//MITRE ATT&CK TTP ID: T1484.002 \u2013 Domain Trust Modifi cation\r\nconfig case_sensitive = false | dataset = cloud_audit_logs | filter log_name = \"azure_ad_audit_logs\" | filter operation_name_orig = \"Set domain authentication\" | alter initiatedBy_userPrincipalName = json_extract(raw_log, \"$.initiatedBy.user.userPrincipalName\") | alter initiatedBy_userID = json_extract(raw_log, \"$.initiatedBy.user.id\") | alter initiatedBy_IpAddress = json_extract(raw_log, \"$.initiatedBy.user.ipAddress\") | alter Domain_Name = json_extract(raw_log, \"$.targetResources.0.displayName\") | alter Modified_Property = json_extract(raw_log, \"$.targetResources.0.modifiedProperties.0.displayName\") | alter Old_Value = json_extract(raw_log, \"$.targetResources.0.modifiedProperties.0.oldValue\") | alter New_Value = json_extract(raw_log, \"$.targetResources.0.modifiedProperties.0.newValue\") | fields _time, identity_name, operation_name_orig, operation_status, initiatedBy_userPrincipalName, initiatedBy_userID, initiatedBy_IpAddress, Domain_Name, Modified_Property, Old_Value, New_Value, raw_log", "is_enabled": true, "description": "Monitors for changes to domain authentication in Microsoft Entra ID, potentially to hijack trust relationships and enable external identity abuse.", "alert_name": "Unit42_MXSIAM_TI_Proactive Threat Hunt Targeting Evolving Muddled Libra (Scattered Spider) and Associated Groups - Abuse of Entra ID Domain Federation Settings", "alert_category": "OTHER", "alert_type": null, "alert_description": "Monitors for changes to domain authentication in Microsoft Entra ID, potentially to hijack trust relationships and enable external identity abuse.", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {"action_remote_ip": "initiatedBy_IpAddress", "agent_device_domain": "Domain_Name", "actor_effective_username": "identity_name", "actor_process_image_name": "initiatedBy_userPrincipalName", "actor_process_command_line": "operation_name_orig"}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "0 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["identity_name"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "//MITRE ATT&CK TTP ID: T1484.002 \u2013 Domain Trust Modifi cation\r\nconfig case_sensitive = false | dataset = cloud_audit_logs | filter log_name = \"azure_ad_audit_logs\" | filter operation_name_orig = \"Set domain authentication\" | alter initiatedBy_userPrincipalName = json_extract(raw_log, \"$.initiatedBy.user.userPrincipalName\") | alter initiatedBy_userID = json_extract(raw_log, \"$.initiatedBy.user.id\") | alter initiatedBy_IpAddress = json_extract(raw_log, \"$.initiatedBy.user.ipAddress\") | alter Domain_Name = json_extract(raw_log, \"$.targetResources.0.displayName\") | alter Modified_Property = json_extract(raw_log, \"$.targetResources.0.modifiedProperties.0.displayName\") | alter Old_Value = json_extract(raw_log, \"$.targetResources.0.modifiedProperties.0.oldValue\") | alter New_Value = json_extract(raw_log, \"$.targetResources.0.modifiedProperties.0.newValue\") | fields _time, identity_name, operation_name_orig, operation_status, initiatedBy_userPrincipalName, initiatedBy_userID, initiatedBy_IpAddress, Domain_Name, Modified_Property, Old_Value, New_Value, raw_log", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "CUSTOM", "action": "ALERTS", "lookup_mapping": []}, {"rule_id": 125, "name": "Unit42_MXSIAM_TI_Proactive Threat Hunt Targeting Evolving Muddled Libra (Scattered Spider) and Associated Groups 1", "severity": "SEV_030_MEDIUM", "xql_query": "//MITRE ATT&CK TTP ID: T1566.002 \u2013 Phishing: Spearphishing via Service\r\nconfig case_sensitive = false | dataset = xdr_data | filter event_type = ENUM.USER_SESSION and actor_process_image_name in (\"ms-teams.exe\", \"updater.exe\") and title contains \"(external)\" and title contains \"help\" | filter title not contains \"lifemark\" | fields _time, event_type, agent_hostname, actor_effective_username, event_sub_type, title, actor_process_image_name, actor_process_image_sha256, actor_process_image_command_line, agent_hostname, _time, action_process_image_name", "is_enabled": true, "description": "Detects suspicious use of Microsoft Teams showing external, help desk-related session titles, potentially tied to social engineering-based helpdesk impersonation.", "alert_name": "Unit42_MXSIAM_TI_Proactive Threat Hunt Targeting Evolving Muddled Libra (Scattered Spider) and Associated Groups - Helpdesk Impersonation via Microsoft Teams", "alert_category": "OTHER", "alert_type": null, "alert_description": "Detects suspicious use of Microsoft Teams showing external, help desk-related session titles, potentially tied to social engineering-based helpdesk impersonation.", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "0 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "//MITRE ATT&CK TTP ID: T1566.002 \u2013 Phishing: Spearphishing via Service\r\nconfig case_sensitive = false | dataset = xdr_data | filter event_type = ENUM.USER_SESSION and actor_process_image_name in (\"ms-teams.exe\", \"updater.exe\") and title contains \"(external)\" and title contains \"help\" | filter title not contains \"lifemark\" | fields _time, event_type, agent_hostname, actor_effective_username, event_sub_type, title, actor_process_image_name, actor_process_image_sha256, actor_process_image_command_line, agent_hostname, _time, action_process_image_name", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": []}, {"rule_id": 124, "name": "Unit42_MXSIAM_TI_Impact Report Threat Brief CVE-2025-31324 3", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1055.001\ndataset = xdr_data | filter event_type = ENUM.FILE and event_sub_type in (ENUM.FILE_WRITE, ENUM.FILE_CREATE_NEW) | filter lowercase(actor_process_signature_product) = \"sap netweaver\" or lowercase(actor_process_image_name) contains \"jstart\" | filter action_file_extension in (\"jsp\", \"jar\", \"class\") | filter action_file_name in (\"helper.jsp\", \"cache.jsp\", \"ran.jsp\", \"forwardsap.jsp\", \"coresap.jsp\", \"webhelp.jsp\", \"usage.jsp\", \"usage1.jsp\", \"404_error.jsp\") | fields _time, event_sub_type, agent_hostname, actor_process_image_name, actor_process_command_line, action_file_name, action_file_path, action_file_sha256 ", "is_enabled": true, "description": "Flags SAP NetWeaver processes (e.g., jstart.exe) writing potentially malicious JSP, JAR, or CLASS files, which may indicate abuse of legitimate SAP components for persistence or payload deployment.", "alert_name": "Unit42_MXSIAM_TI_Impact Report Threat Brief CVE-2025-31324 3", "alert_category": "OTHER", "alert_type": null, "alert_description": "Flags SAP NetWeaver processes (e.g., jstart.exe) writing potentially malicious JSP, JAR, or CLASS files, which may indicate abuse of legitimate SAP components for persistence or payload deployment.", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1055.001\ndataset = xdr_data | filter event_type = ENUM.FILE and event_sub_type in (ENUM.FILE_WRITE, ENUM.FILE_CREATE_NEW) | filter lowercase(actor_process_signature_product) = \"sap netweaver\" or lowercase(actor_process_image_name) contains \"jstart\" | filter action_file_extension in (\"jsp\", \"jar\", \"class\") | filter action_file_name in (\"helper.jsp\", \"cache.jsp\", \"ran.jsp\", \"forwardsap.jsp\", \"coresap.jsp\", \"webhelp.jsp\", \"usage.jsp\", \"usage1.jsp\", \"404_error.jsp\") | fields _time, event_sub_type, agent_hostname, actor_process_image_name, actor_process_command_line, action_file_name, action_file_path, action_file_sha256 ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 123, "name": "Unit42_MXSIAM_TI_Impact Report Threat Brief CVE-2025-31324 2", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1505.003\ndataset = xdr_data  | filter event_type = ENUM.FILE and event_sub_type = ENUM.FILE_WRITE  | filter action_file_extension in (\"jsp\", \"jar\", \"class\")  | filter lowercase(action_file_path) ~= \"sap\\.?com[\\/\\\\]irj[\\/\\\\]servlet_?jsp[\\\\\\/]irj[\\\\\\/]\"  | fields _time, agent_hostname, actor_process_image_name, actor_process_command_line, action_file_name, action_file_path, action_file_sha256 ", "is_enabled": true, "description": "Detects creation of potentially malicious JSP, JAR, or CLASS files in the /irj/servlet_jsp/irj/root/ path, a known public-facing SAP web directory targeted for web shell deployment.", "alert_name": "Unit42_MXSIAM_TI_Impact Report Threat Brief CVE-2025-31324 2", "alert_category": "OTHER", "alert_type": null, "alert_description": "Detects creation of potentially malicious JSP, JAR, or CLASS files in the /irj/servlet_jsp/irj/root/ path, a known public-facing SAP web directory targeted for web shell deployment.", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1505.003\ndataset = xdr_data  | filter event_type = ENUM.FILE and event_sub_type = ENUM.FILE_WRITE  | filter action_file_extension in (\"jsp\", \"jar\", \"class\")  | filter lowercase(action_file_path) ~= \"sap\\.?com[\\/\\\\]irj[\\/\\\\]servlet_?jsp[\\\\\\/]irj[\\\\\\/]\"  | fields _time, agent_hostname, actor_process_image_name, actor_process_command_line, action_file_name, action_file_path, action_file_sha256 ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 122, "name": "Unit42_MXSIAM_TI_Impact Report Threat Brief CVE-2025-31324 1", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1190\ndataset = xdr_data | filter event_type = ENUM.STORY  | filter uri contains \"/developmentserver/metadatauploader\"  | filter http_method = \"POST\" and http_status_code = 200 | filter incidr(action_local_ip  , \"10.0.0.0/8\") != true and incidr(action_local_ip, \"192.168.0.0/16\") != true and incidr(action_local_ip, \"172.16.0.0/12\") != true and incidr(action_local_ip, \"100.64.0.0/10\") != true and incidr(action_local_ip, \"127.0.0.0/8\") != true and incidr(action_local_ip, \"169.254.0.0/16\") != true and incidr(action_local_ip, \"224.0.0.0/4\") != true and incidr(action_local_ip, \"255.255.255.255/32\") != true and incidr(action_local_ip, \"198.18.0.0/15\") != true | filter action_local_ip != \"0.0.0.0\" and action_local_ip != \"\" and action_local_ip != null and action_local_ip not contains \"*::*\" | fields _time, agent_hostname, action_local_ip, action_local_port, action_remote_ip, action_remote_port, dns_query_name, action_external_hostname, dst_action_external_hostname,action_network_dpi_fields,uri, http_method, user_agent_data,http_method, http_status_code, http_req_user_agent_header, actor_process_image_path, actor_process_image_command_line, actor_process_command_line,causality_actor_process_command_line ", "is_enabled": true, "description": "Detects unauthenticated POST requests to the vulnerable /developmentserver/metadatauploader endpoint, which is the entry point for CVE-2025-31324 file upload exploitation.", "alert_name": "Unit42_MXSIAM_TI_Impact Report Threat Brief CVE-2025-31324 1", "alert_category": "OTHER", "alert_type": null, "alert_description": "Detects unauthenticated POST requests to the vulnerable /developmentserver/metadatauploader endpoint, which is the entry point for CVE-2025-31324 file upload exploitation.", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1190\ndataset = xdr_data | filter event_type = ENUM.STORY  | filter uri contains \"/developmentserver/metadatauploader\"  | filter http_method = \"POST\" and http_status_code = 200 | filter incidr(action_local_ip  , \"10.0.0.0/8\") != true and incidr(action_local_ip, \"192.168.0.0/16\") != true and incidr(action_local_ip, \"172.16.0.0/12\") != true and incidr(action_local_ip, \"100.64.0.0/10\") != true and incidr(action_local_ip, \"127.0.0.0/8\") != true and incidr(action_local_ip, \"169.254.0.0/16\") != true and incidr(action_local_ip, \"224.0.0.0/4\") != true and incidr(action_local_ip, \"255.255.255.255/32\") != true and incidr(action_local_ip, \"198.18.0.0/15\") != true | filter action_local_ip != \"0.0.0.0\" and action_local_ip != \"\" and action_local_ip != null and action_local_ip not contains \"*::*\" | fields _time, agent_hostname, action_local_ip, action_local_port, action_remote_ip, action_remote_port, dns_query_name, action_external_hostname, dst_action_external_hostname,action_network_dpi_fields,uri, http_method, user_agent_data,http_method, http_status_code, http_req_user_agent_header, actor_process_image_path, actor_process_image_command_line, actor_process_command_line,causality_actor_process_command_line ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 121, "name": "Unit42_MXSIAM_TI_Multi-Stage Infection Chain Analysis of New Ransomware Tooling 4", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1059.001, T1218.007\nconfig case_sensitive = false | dataset = xdr_data | filter event_type = PROCESS and actor_process_image_name = \"msiexec.exe\" and action_process_image_name = \"powershell.exe\" | filter action_process_image_command_line contains \"-ExecutionPolicy*Bypass*-WindowStyle Hidden*-File*.ps1\" | filter action_process_image_command_line not contains \"clean-up-pcoip-usb-driver.ps1\" | fields agent_hostname, actor_effective_username, actor_process_image_name, action_process_image_name, action_process_image_command_line ", "is_enabled": true, "description": "msiexec launching suspicious child Powershell process", "alert_name": "Unit42_MXSIAM_TI_Multi-Stage Infection Chain Analysis of New Ransomware Tooling 4", "alert_category": "OTHER", "alert_type": null, "alert_description": "msiexec launching suspicious child Powershell process", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1059.001, T1218.007\nconfig case_sensitive = false | dataset = xdr_data | filter event_type = PROCESS and actor_process_image_name = \"msiexec.exe\" and action_process_image_name = \"powershell.exe\" | filter action_process_image_command_line contains \"-ExecutionPolicy*Bypass*-WindowStyle Hidden*-File*.ps1\" | filter action_process_image_command_line not contains \"clean-up-pcoip-usb-driver.ps1\" | fields agent_hostname, actor_effective_username, actor_process_image_name, action_process_image_name, action_process_image_command_line ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 120, "name": "Unit42_MXSIAM_TI_Multi-Stage Infection Chain Analysis of New Ransomware Tooling 3", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1027, T1059.001\nconfig case_sensitive = false | dataset = xdr_data | filter event_type = EVENT_LOG and agent_os_type = AGENT_OS_WINDOWS and action_evtlog_description = \"AmsiScanBuffer\" | filter action_evtlog_data_fields contains \"frombase64string\" and action_evtlog_data_fields contains \"invoke-expression\" and action_evtlog_data_fields contains \"-bxor\"   | fields agent_hostname, actor_effective_username, action_evtlog_data_fields, action_evtlog_description, action_evtlog_event_id, action_evtlog_message, action_evtlog_raw_params, actor_process_command_line | alter script_content = json_extract(action_evtlog_data_fields, \"$.content\")  ", "is_enabled": true, "description": "Search AMSI event logs for base64 + xor'ed content execution", "alert_name": "Unit42_MXSIAM_TI_Multi-Stage Infection Chain Analysis of New Ransomware Tooling 3", "alert_category": "OTHER", "alert_type": null, "alert_description": "Search AMSI event logs for base64 + xor'ed content execution", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1027, T1059.001\nconfig case_sensitive = false | dataset = xdr_data | filter event_type = EVENT_LOG and agent_os_type = AGENT_OS_WINDOWS and action_evtlog_description = \"AmsiScanBuffer\" | filter action_evtlog_data_fields contains \"frombase64string\" and action_evtlog_data_fields contains \"invoke-expression\" and action_evtlog_data_fields contains \"-bxor\"   | fields agent_hostname, actor_effective_username, action_evtlog_data_fields, action_evtlog_description, action_evtlog_event_id, action_evtlog_message, action_evtlog_raw_params, actor_process_command_line | alter script_content = json_extract(action_evtlog_data_fields, \"$.content\")  ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 119, "name": "Unit42_MXSIAM_TI_Multi-Stage Infection Chain Analysis of New Ransomware Tooling 2", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1547.001, T1564.001\nconfig case_sensitive = false | dataset = xdr_data | filter event_type = FILE and event_sub_type = ENUM.FILE_WRITE and action_file_path contains \"ProgramData\\Microsoft\\Windows\\Start Menu\\hidden\" | fields event_type, event_sub_type, actor_process_image_name, action_file_path, actor_process_command_line ", "is_enabled": true, "description": "Creation of \"Hidden\" folder in Startup directory", "alert_name": "Unit42_MXSIAM_TI_Multi-Stage Infection Chain Analysis of New Ransomware Tooling 2", "alert_category": "OTHER", "alert_type": null, "alert_description": "Creation of \"Hidden\" folder in Startup directory", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": false, "suppression_duration": null, "suppression_fields": null, "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1547.001, T1564.001\nconfig case_sensitive = false | dataset = xdr_data | filter event_type = FILE and event_sub_type = ENUM.FILE_WRITE and action_file_path contains \"ProgramData\\Microsoft\\Windows\\Start Menu\\hidden\" | fields event_type, event_sub_type, actor_process_image_name, action_file_path, actor_process_command_line ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 118, "name": "Unit42_MXSIAM_TI_Multi-Stage Infection Chain Analysis of New Ransomware Tooling 1", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1547.001, T1105, T1059.001\nconfig case_sensitive = false | dataset = xdr_data | filter event_type = REGISTRY and event_sub_type in (ENUM.REGISTRY_CREATE_KEY, ENUM.REGISTRY_SET_VALUE) and action_registry_data contains \"powershell*iwr*ps1*iex\" and action_registry_key_name contains \"Microsoft\\Windows\\CurrentVersion\\Run\" ", "is_enabled": true, "description": "Registry persistence and internet ps1 download", "alert_name": "Unit42_MXSIAM_TI_Multi-Stage Infection Chain Analysis of New Ransomware Tooling 1", "alert_category": "OTHER", "alert_type": null, "alert_description": "Registry persistence and internet ps1 download", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1547.001, T1105, T1059.001\nconfig case_sensitive = false | dataset = xdr_data | filter event_type = REGISTRY and event_sub_type in (ENUM.REGISTRY_CREATE_KEY, ENUM.REGISTRY_SET_VALUE) and action_registry_data contains \"powershell*iwr*ps1*iex\" and action_registry_key_name contains \"Microsoft\\Windows\\CurrentVersion\\Run\" ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 117, "name": "Unit42_MXSIAM_TI_Impact Report Venom Spider Uses Server-Side Polymorphism to Weave a Web Around Victims 4", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1543.003\ndataset = xdr_data | filter event_type = ENUM.EVENT_LOG and action_evtlog_event_id in (7045, 4697) | alter Service_Name = trim(arrayindex(regextract(action_evtlog_message, \"Service Name:.*?(\\w.*)*\\r?\\n\"),0)) | alter Service_File_Name = trim(arrayindex(regextract(action_evtlog_message, \"Service File Name:.*?(\\w.*)\\r?\\n\"),0)) | alter Service_Type = trim(arrayindex(regextract(action_evtlog_message, \"Service Type:.*?(\\w.*)\\r?\\n\"),0)) | alter Service_Start_Type = trim(arrayindex(regextract(action_evtlog_message, \"Service Start Type:.*?(\\w.*)\\r?\\n\"),0)) | fields _time, agent_hostname, Service_Name, Service_File_Name, Service_Type, Service_Start_Type, action_evtlog_event_id, action_evtlog_provider_name, action_evtlog_description, action_evtlog_message, actor_effective_username, actor_primary_username, os_actor_primary_username, action_evtlog_event_id, action_evtlog_username, action_evtlog_record_id, actor_process_image_name, actor_process_image_path, causality_actor_process_image_name, causality_actor_process_image_path, os_actor_process_image_name, os_actor_process_image_path | filter lowercase(Service_Name) = \"unconvictiv\" | sort desc _time ", "is_enabled": true, "description": "Query looks for the \"unconvictiv\" service being installed, which occurs in the Venom Spider campaign when the dynamically-generated ieuinit.inf file is loaded via ie4uinit.exe", "alert_name": "Unit42_MXSIAM_TI_Impact Report Venom Spider Uses Server-Side Polymorphism to Weave a Web Around Victims 4", "alert_category": "OTHER", "alert_type": null, "alert_description": "Query looks for the \"unconvictiv\" service being installed, which occurs in the Venom Spider campaign when the dynamically-generated ieuinit.inf file is loaded via ie4uinit.exe", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1543.003\ndataset = xdr_data | filter event_type = ENUM.EVENT_LOG and action_evtlog_event_id in (7045, 4697) | alter Service_Name = trim(arrayindex(regextract(action_evtlog_message, \"Service Name:.*?(\\w.*)*\\r?\\n\"),0)) | alter Service_File_Name = trim(arrayindex(regextract(action_evtlog_message, \"Service File Name:.*?(\\w.*)\\r?\\n\"),0)) | alter Service_Type = trim(arrayindex(regextract(action_evtlog_message, \"Service Type:.*?(\\w.*)\\r?\\n\"),0)) | alter Service_Start_Type = trim(arrayindex(regextract(action_evtlog_message, \"Service Start Type:.*?(\\w.*)\\r?\\n\"),0)) | fields _time, agent_hostname, Service_Name, Service_File_Name, Service_Type, Service_Start_Type, action_evtlog_event_id, action_evtlog_provider_name, action_evtlog_description, action_evtlog_message, actor_effective_username, actor_primary_username, os_actor_primary_username, action_evtlog_event_id, action_evtlog_username, action_evtlog_record_id, actor_process_image_name, actor_process_image_path, causality_actor_process_image_name, causality_actor_process_image_path, os_actor_process_image_name, os_actor_process_image_path | filter lowercase(Service_Name) = \"unconvictiv\" | sort desc _time ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 116, "name": "Unit42_MXSIAM_TI_Impact Report Venom Spider Uses Server-Side Polymorphism to Weave a Web Around Victims 3", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1220\ndataset = xdr_data  | filter event_type = ENUM.PROCESS and event_sub_type = ENUM.PROCESS_START  | filter lowercase(action_process_image_name) = \"msxsl.exe\" and lowercase(action_process_image_path) ~= \"\\\\appdata\\\\roaming\\\\\\w+\\\\msxsl\\.exe\" | fields _time, agent_hostname, action_process_username, action_process_image_name, action_process_image_path, action_process_image_command_line, action_process_image_sha256, action_process_cwd, action_process_file_info, action_process_file_size, action_process_file_web_mark, actor_effective_username, actor_process_image_name, actor_process_image_path, actor_process_image_command_line, actor_process_image_sha256, causality_actor_primary_username, causality_actor_process_image_name, causality_actor_process_image_path, causality_actor_process_command_line, causality_actor_process_image_sha256, os_actor_primary_username, os_actor_process_image_name, os_actor_process_image_path, os_actor_process_image_command_line, os_actor_process_image_sha256  | sort desc _time ", "is_enabled": true, "description": "Query looks for msxsl.exe executing out of the AppData directory, which occurs in the Venom Spider campaign shortly after More_eggs_Dropper executes", "alert_name": "Unit42_MXSIAM_TI_Impact Report Venom Spider Uses Server-Side Polymorphism to Weave a Web Around Victims 3", "alert_category": "OTHER", "alert_type": null, "alert_description": "Query looks for msxsl.exe executing out of the AppData directory, which occurs in the Venom Spider campaign shortly after More_eggs_Dropper executes", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1220\ndataset = xdr_data  | filter event_type = ENUM.PROCESS and event_sub_type = ENUM.PROCESS_START  | filter lowercase(action_process_image_name) = \"msxsl.exe\" and lowercase(action_process_image_path) ~= \"\\\\appdata\\\\roaming\\\\\\w+\\\\msxsl\\.exe\" | fields _time, agent_hostname, action_process_username, action_process_image_name, action_process_image_path, action_process_image_command_line, action_process_image_sha256, action_process_cwd, action_process_file_info, action_process_file_size, action_process_file_web_mark, actor_effective_username, actor_process_image_name, actor_process_image_path, actor_process_image_command_line, actor_process_image_sha256, causality_actor_primary_username, causality_actor_process_image_name, causality_actor_process_image_path, causality_actor_process_command_line, causality_actor_process_image_sha256, os_actor_primary_username, os_actor_process_image_name, os_actor_process_image_path, os_actor_process_image_command_line, os_actor_process_image_sha256  | sort desc _time ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 115, "name": "Unit42_MXSIAM_TI_Impact Report Venom Spider Uses Server-Side Polymorphism to Weave a Web Around Victims 2", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1218.010\ndataset = xdr_data  | filter event_type = ENUM.PROCESS and event_sub_type = ENUM.PROCESS_START  | filter lowercase(action_process_image_name) = \"regsvr32.exe\" and lowercase(action_process_image_command_line) ~= \"\\\\appdata\\\\roaming\\\\\\w+\\\\\\d{5}\\.dll\" | fields _time, agent_hostname, action_process_username, action_process_image_name, action_process_image_path, action_process_image_command_line, action_process_image_sha256, action_process_cwd, action_process_file_info, action_process_file_size, action_process_file_web_mark, actor_effective_username, actor_process_image_name, actor_process_image_path, actor_process_image_command_line, actor_process_image_sha256, causality_actor_primary_username, causality_actor_process_image_name, causality_actor_process_image_path, causality_actor_process_command_line, causality_actor_process_image_sha256, os_actor_primary_username, os_actor_process_image_name, os_actor_process_image_path, os_actor_process_image_command_line, os_actor_process_image_sha256  | sort desc _time ", "is_enabled": true, "description": "Query looks for regsvr32.exe being used to load the More_eggs_Dropper library, which uses a randomly-generated, 5-digit DLL name", "alert_name": "Unit42_MXSIAM_TI_Impact Report Venom Spider Uses Server-Side Polymorphism to Weave a Web Around Victims 2", "alert_category": "OTHER", "alert_type": null, "alert_description": "Query looks for regsvr32.exe being used to load the More_eggs_Dropper library, which uses a randomly-generated, 5-digit DLL name", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1218.010\ndataset = xdr_data  | filter event_type = ENUM.PROCESS and event_sub_type = ENUM.PROCESS_START  | filter lowercase(action_process_image_name) = \"regsvr32.exe\" and lowercase(action_process_image_command_line) ~= \"\\\\appdata\\\\roaming\\\\\\w+\\\\\\d{5}\\.dll\" | fields _time, agent_hostname, action_process_username, action_process_image_name, action_process_image_path, action_process_image_command_line, action_process_image_sha256, action_process_cwd, action_process_file_info, action_process_file_size, action_process_file_web_mark, actor_effective_username, actor_process_image_name, actor_process_image_path, actor_process_image_command_line, actor_process_image_sha256, causality_actor_primary_username, causality_actor_process_image_name, causality_actor_process_image_path, causality_actor_process_command_line, causality_actor_process_image_sha256, os_actor_primary_username, os_actor_process_image_name, os_actor_process_image_path, os_actor_process_image_command_line, os_actor_process_image_sha256  | sort desc _time ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 114, "name": "Unit42_MXSIAM_TI_Impact Report Venom Spider Uses Server-Side Polymorphism to Weave a Web Around Victims 1", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1222.001\ndataset = xdr_data  | filter event_type = ENUM.PROCESS and event_sub_type = ENUM.PROCESS_START  | filter lowercase(action_process_image_name) in (\"cacls.exe\", \"icacls.exe\") and lowercase(action_process_image_command_line) contains \"ie4uinit.exe\" | fields _time, agent_hostname, action_process_username, action_process_image_name, action_process_image_path, action_process_image_command_line, action_process_image_sha256, action_process_cwd, action_process_file_info, action_process_file_size, action_process_file_web_mark, actor_effective_username, actor_process_image_name, actor_process_image_path, actor_process_image_command_line, actor_process_image_sha256, causality_actor_primary_username, causality_actor_process_image_name, causality_actor_process_image_path, causality_actor_process_command_line, causality_actor_process_image_sha256, os_actor_primary_username, os_actor_process_image_name, os_actor_process_image_path, os_actor_process_image_command_line, os_actor_process_image_sha256 | sort desc _time ", "is_enabled": true, "description": "Query looks for (i)cacls.exe being used to adjust permissions on ie4uinit.exe. This activity occurs in the Venom Spider campaign when an obfuscated script executes a batch script, which ends with a line to perform such activity.", "alert_name": "Unit42_MXSIAM_TI_Impact Report Venom Spider Uses Server-Side Polymorphism to Weave a Web Around Victims 1", "alert_category": "OTHER", "alert_type": null, "alert_description": "Query looks for (i)cacls.exe being used to adjust permissions on ie4uinit.exe. This activity occurs in the Venom Spider campaign when an obfuscated script executes a batch script, which ends with a line to perform such activity.", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1222.001\ndataset = xdr_data  | filter event_type = ENUM.PROCESS and event_sub_type = ENUM.PROCESS_START  | filter lowercase(action_process_image_name) in (\"cacls.exe\", \"icacls.exe\") and lowercase(action_process_image_command_line) contains \"ie4uinit.exe\" | fields _time, agent_hostname, action_process_username, action_process_image_name, action_process_image_path, action_process_image_command_line, action_process_image_sha256, action_process_cwd, action_process_file_info, action_process_file_size, action_process_file_web_mark, actor_effective_username, actor_process_image_name, actor_process_image_path, actor_process_image_command_line, actor_process_image_sha256, causality_actor_primary_username, causality_actor_process_image_name, causality_actor_process_image_path, causality_actor_process_command_line, causality_actor_process_image_sha256, os_actor_primary_username, os_actor_process_image_name, os_actor_process_image_path, os_actor_process_image_command_line, os_actor_process_image_sha256 | sort desc _time ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 77, "name": "Akamai-Log-Ingestion-Failure", "severity": "SEV_050_CRITICAL", "xql_query": " dataset = metrics_source  \r\n| comp sum(total_event_count) as total_event_count_sum by _collector_id, _collector_ip, \r\n_collector_name, _collector_type, _final_reporting_device_ip, _final_reporting_device_name,\r\n _broker_device_id, _vendor, _product \r\n|filter _collector_name contains \"Akamai\" and total_event_count_sum = 0\r\n|filter _collector_name not contains \"Akamai WAF SIEM_instance_100146_1\" or _collector_name not contains \"Akamai WAF SIEM_instance_100146_2\" or _collector_name not contains \"Akamai WAF SIEM_instance_100146_3\"", "is_enabled": true, "description": "Akamai logs not ingested for more than 30 mins", "alert_name": "Akamai Log Ingestion Failure", "alert_category": null, "alert_type": "Ingestion", "alert_description": "Akamai $_collector_name ingestion failure", "alert_domain": "DOMAIN_HEALTH", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "30 minutes", "simple_schedule": "30 minutes", "timezone": "America/Toronto", "crontab": "*/30 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": null, "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "CUSTOM", "action": "ALERTS", "lookup_mapping": []}, {"rule_id": 113, "name": "Unit42_MXSIAM_TI_Impact Report Finding Minhook in a sideloading attack 2", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1553.002\nconfig case_sensitive = false | dataset = xdr_data  | filter event_type = ENUM.LOAD_IMAGE and event_sub_type = ENUM.LOAD_IMAGE_MODULE | alter company = action_module_file_info -> company | filter company contains \"Gala Lab Corp\" and action_module_signature_status = ENUM.SIGNED_INVALID | fields agent_hostname,action_module_file_info, actor_effective_username, actor_process_image_path, actor_process_image_sha256, action_module_path, action_module_sha256,company ", "is_enabled": true, "description": "Detects the image load of an expired digital signature belonging to Gala Lab Corp.", "alert_name": "Unit42_MXSIAM_TI_Impact Report Finding Minhook in a sideloading attack 2", "alert_category": "OTHER", "alert_type": null, "alert_description": "Detects the image load of an expired digital signature belonging to Gala Lab Corp.", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1553.002\nconfig case_sensitive = false | dataset = xdr_data  | filter event_type = ENUM.LOAD_IMAGE and event_sub_type = ENUM.LOAD_IMAGE_MODULE | alter company = action_module_file_info -> company | filter company contains \"Gala Lab Corp\" and action_module_signature_status = ENUM.SIGNED_INVALID | fields agent_hostname,action_module_file_info, actor_effective_username, actor_process_image_path, actor_process_image_sha256, action_module_path, action_module_sha256,company ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 112, "name": "Unit42_MXSIAM_TI_Impact Report Finding Minhook in a sideloading attack 1", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1105\nconfig case_sensitive = false | dataset = xdr_data | filter event_type = ENUM.FILE and event_sub_type = ENUM.FILE_CREATE_NEW | filter action_file_name in (\"syncres.dat\", \"dsccorer.mui\", \"wuapi.dat\", \"mprapi.dat\") | fields _time, agent_hostname,actor_effective_username,action_file_name,action_file_path, action_file_previous_file_path, action_file_web_mark, action_file_sha256, actor_process_image_path, actor_process_image_sha256, causality_actor_process_image_path,action_process_file_create_time | comp count_distinct(action_file_name) as file_count,values(actor_effective_username) as actor_effective_username, values(action_file_path) as action_file_path, values(action_file_sha256) as action_file_sha256, values(actor_process_image_path) as actor_process_image_path, values(causality_actor_process_image_path) as causality_actor_process_image_path by agent_hostname  | filter file_count >= 2  ", "is_enabled": true, "description": "Detects the presence of specific files associated with MiracastView side-loading attacks.", "alert_name": "Unit42_MXSIAM_TI_Impact Report Finding Minhook in a sideloading attack 1", "alert_category": "OTHER", "alert_type": null, "alert_description": "Detects the presence of specific files associated with MiracastView side-loading attacks.", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1105\nconfig case_sensitive = false | dataset = xdr_data | filter event_type = ENUM.FILE and event_sub_type = ENUM.FILE_CREATE_NEW | filter action_file_name in (\"syncres.dat\", \"dsccorer.mui\", \"wuapi.dat\", \"mprapi.dat\") | fields _time, agent_hostname,actor_effective_username,action_file_name,action_file_path, action_file_previous_file_path, action_file_web_mark, action_file_sha256, actor_process_image_path, actor_process_image_sha256, causality_actor_process_image_path,action_process_file_create_time | comp count_distinct(action_file_name) as file_count,values(actor_effective_username) as actor_effective_username, values(action_file_path) as action_file_path, values(action_file_sha256) as action_file_sha256, values(actor_process_image_path) as actor_process_image_path, values(causality_actor_process_image_path) as causality_actor_process_image_path by agent_hostname  | filter file_count >= 2  ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 111, "name": "Unit42_MXSIAM_TI_Impact Report Latest Mustang Panda Arsenal Toneshell, StarProxy, PAKLOG, CorKLOG, and SplatCloak 4", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1053.005\nconfig case_sensitive = false | dataset = xdr_data | fields _time, agent_hostname, actor_process_image_name, actor_process_command_line, actor_process_image_sha256, action_process_image_name, action_process_image_command_line, event_type | filter action_process_image_name = \"schtasks.exe\" and action_process_image_command_line contains \"TabletlnputServices\"", "is_enabled": true, "description": "Creation of scheduled task consistent with Mustang Panada and CorKLOG malware", "alert_name": "Unit42_MXSIAM_TI_Impact Report Latest Mustang Panda Arsenal Toneshell, StarProxy, PAKLOG, CorKLOG, and SplatCloak 4", "alert_category": "OTHER", "alert_type": null, "alert_description": "Creation of scheduled task consistent with Mustang Panada and CorKLOG malware", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1053.005\nconfig case_sensitive = false | dataset = xdr_data | fields _time, agent_hostname, actor_process_image_name, actor_process_command_line, actor_process_image_sha256, action_process_image_name, action_process_image_command_line, event_type | filter action_process_image_name = \"schtasks.exe\" and action_process_image_command_line contains \"TabletlnputServices\"", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 110, "name": "Unit42_MXSIAM_TI_Impact Report Latest Mustang Panda Arsenal Toneshell, StarProxy, PAKLOG, CorKLOG, and SplatCloak 3", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1562.001\nconfig case_sensitive = false | dataset = xdr_data | fields _time, agent_hostname, causality_actor_process_image_name, actor_process_image_name, actor_process_signature_vendor, actor_process_command_line, action_file_path, action_file_sha256, event_type, event_sub_type | filter event_type = ENUM.FILE and event_sub_type in (ENUM.FILE_CREATE_NEW, ENUM.FILE_RENAME) and action_file_path = \"C:\\Users\\public\\*.sys\" and actor_process_signature_vendor = \"BugSplat\" ", "is_enabled": true, "description": "Mustang Panda using SplatCloak malware to drop driver in suspicious directory ", "alert_name": "Unit42_MXSIAM_TI_Impact Report Latest Mustang Panda Arsenal Toneshell, StarProxy, PAKLOG, CorKLOG, and SplatCloak 3", "alert_category": "OTHER", "alert_type": null, "alert_description": "Mustang Panda using SplatCloak malware to drop driver in suspicious directory ", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1562.001\nconfig case_sensitive = false | dataset = xdr_data | fields _time, agent_hostname, causality_actor_process_image_name, actor_process_image_name, actor_process_signature_vendor, actor_process_command_line, action_file_path, action_file_sha256, event_type, event_sub_type | filter event_type = ENUM.FILE and event_sub_type in (ENUM.FILE_CREATE_NEW, ENUM.FILE_RENAME) and action_file_path = \"C:\\Users\\public\\*.sys\" and actor_process_signature_vendor = \"BugSplat\" ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 109, "name": "Unit42_MXSIAM_TI_Impact Report Latest Mustang Panda Arsenal Toneshell, StarProxy, PAKLOG, CorKLOG, and SplatCloak 2", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1574.002\nconfig case_sensitive = false | dataset = xdr_data | fields _time, agent_hostname, actor_process_image_name, actor_process_image_path, action_module_path, action_module_signature_vendor, action_module_sha256, event_type, agent_os_type | filter event_type = ENUM.LOAD_IMAGE and agent_os_type = ENUM.AGENT_OS_WINDOWS | filter actor_process_image_name ~= \"(?i)(mrender|FastVD|gpgconf|IsoBurner)\\.exe\" and action_module_path ~= \"(?i)(libcef|LogMeIn|libgcrypt-20|StarBurn)\\.dll$\" | alter exe_path = arrayindex(regextract(actor_process_image_path, \"^(.*\\\\)[^\\\\]+$\"), 0) | filter action_module_path contains exe_path | fields _time, agent_hostname, actor_process_image_path, action_module_path, action_module_signature_vendor, action_module_sha256 ", "is_enabled": true, "description": "DLL Sideloading consistent with Mustang Panda and ToneShell, StarProxy malware", "alert_name": "Unit42_MXSIAM_TI_Impact Report Latest Mustang Panda Arsenal Toneshell, StarProxy, PAKLOG, CorKLOG, and SplatCloak 2", "alert_category": "OTHER", "alert_type": null, "alert_description": "DLL Sideloading consistent with Mustang Panda and ToneShell, StarProxy malware", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1574.002\nconfig case_sensitive = false | dataset = xdr_data | fields _time, agent_hostname, actor_process_image_name, actor_process_image_path, action_module_path, action_module_signature_vendor, action_module_sha256, event_type, agent_os_type | filter event_type = ENUM.LOAD_IMAGE and agent_os_type = ENUM.AGENT_OS_WINDOWS | filter actor_process_image_name ~= \"(?i)(mrender|FastVD|gpgconf|IsoBurner)\\.exe\" and action_module_path ~= \"(?i)(libcef|LogMeIn|libgcrypt-20|StarBurn)\\.dll$\" | alter exe_path = arrayindex(regextract(actor_process_image_path, \"^(.*\\\\)[^\\\\]+$\"), 0) | filter action_module_path contains exe_path | fields _time, agent_hostname, actor_process_image_path, action_module_path, action_module_signature_vendor, action_module_sha256 ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 108, "name": "Unit42_MXSIAM_TI_Impact Report Latest Mustang Panda Arsenal Toneshell, StarProxy, PAKLOG, CorKLOG, and SplatCloak 1", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1574.002\nconfig case_sensitive = false | dataset = xdr_data | fields _time, agent_hostname, actor_process_image_name, actor_process_image_path, action_module_path, action_module_signature_vendor, action_module_sha256, event_type, agent_os_type | filter event_type = ENUM.LOAD_IMAGE and agent_os_type = ENUM.AGENT_OS_WINDOWS | filter actor_process_image_name in (\"pacloud.exe\", \"BugSplatHD64.exe\") and action_module_path ~= \"(?i)(pa_lang2|bugsplat64)\\.dll$\" | alter exe_path = arrayindex(regextract(actor_process_image_path, \"^(.*\\\\)[^\\\\]+$\"), 0) | filter action_module_path contains exe_path | fields _time, agent_hostname, actor_process_image_path, action_module_path, action_module_signature_vendor, action_module_sha256  ", "is_enabled": true, "description": "DLL Sideloading consistent with Mustang Panda and Paklog, Splatcloak malware", "alert_name": "Unit42_MXSIAM_TI_Impact Report Latest Mustang Panda Arsenal Toneshell, StarProxy, PAKLOG, CorKLOG, and SplatCloak 1", "alert_category": "OTHER", "alert_type": null, "alert_description": "DLL Sideloading consistent with Mustang Panda and Paklog, Splatcloak malware", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1574.002\nconfig case_sensitive = false | dataset = xdr_data | fields _time, agent_hostname, actor_process_image_name, actor_process_image_path, action_module_path, action_module_signature_vendor, action_module_sha256, event_type, agent_os_type | filter event_type = ENUM.LOAD_IMAGE and agent_os_type = ENUM.AGENT_OS_WINDOWS | filter actor_process_image_name in (\"pacloud.exe\", \"BugSplatHD64.exe\") and action_module_path ~= \"(?i)(pa_lang2|bugsplat64)\\.dll$\" | alter exe_path = arrayindex(regextract(actor_process_image_path, \"^(.*\\\\)[^\\\\]+$\"), 0) | filter action_module_path contains exe_path | fields _time, agent_hostname, actor_process_image_path, action_module_path, action_module_signature_vendor, action_module_sha256  ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 107, "name": "Unit42_MXSIAM_TI_Impact Report Unit 42 Timely Threat Intelligence - Windows bot malware \"Blitz\" abuses HuggingFace services 3", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1204.002\nconfig case_sensitive = false | preset=xdr_file  | filter action_file_name contains \"@sw1zzx_dev.exe\" | fields agent_hostname, _time, actor_process_image_name, action_file_name, action_file_path, action_file_sha256, event_id ", "is_enabled": true, "description": "The Blitz malware author distributes fake cracked software with their handle in it. ", "alert_name": "Unit42_MXSIAM_TI_Impact Report Unit 42 Timely Threat Intelligence - Windows bot malware \"Blitz\" abuses HuggingFace services 3", "alert_category": "OTHER", "alert_type": null, "alert_description": "The Blitz malware author distributes fake cracked software with their handle in it. ", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1204.002\nconfig case_sensitive = false | preset=xdr_file  | filter action_file_name contains \"@sw1zzx_dev.exe\" | fields agent_hostname, _time, actor_process_image_name, action_file_name, action_file_path, action_file_sha256, event_id ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 106, "name": "Unit42_MXSIAM_TI_Impact Report Unit 42 Timely Threat Intelligence - Windows bot malware \"Blitz\" abuses HuggingFace services 2", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1102.002\nconfig case_sensitive = false | preset=network_story  | filter dst_action_external_hostname contains \".hf.space\" and actor_process_image_name IN (\"rundll32.exe\",\"regsrv32.exe\") | fields agent_hostname, _time, actor_process_image_name, actor_process_image_path, actor_process_command_line, dst_action_external_hostname, event_id ", "is_enabled": true, "description": " Second stage Blitz malware communicating with huggingface spaces after being executed from a dll", "alert_name": "Unit42_MXSIAM_TI_Impact Report Unit 42 Timely Threat Intelligence - Windows bot malware \"Blitz\" abuses HuggingFace services 2", "alert_category": "OTHER", "alert_type": null, "alert_description": " Second stage Blitz malware communicating with huggingface spaces after being executed from a dll", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1102.002\nconfig case_sensitive = false | preset=network_story  | filter dst_action_external_hostname contains \".hf.space\" and actor_process_image_name IN (\"rundll32.exe\",\"regsrv32.exe\") | fields agent_hostname, _time, actor_process_image_name, actor_process_image_path, actor_process_command_line, dst_action_external_hostname, event_id ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 105, "name": "Unit42_MXSIAM_TI_Impact Report Unit 42 Timely Threat Intelligence - Windows bot malware \"Blitz\" abuses HuggingFace services 1", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1102.003\nconfig case_sensitive = false | preset=network_story  | filter actor_process_image_name IN (\"installer.exe\",\"*sw1zzx*\") and dst_action_external_hostname = \"huggingface.co\" | fields agent_hostname, _time, actor_process_image_name, actor_process_image_path, actor_process_command_line, dst_action_external_hostname, event_id ", "is_enabled": true, "description": "Blitz malware dropper filenames from observed files in VirusTotal communicating to huggingface.co domains", "alert_name": "Unit42_MXSIAM_TI_Impact Report Unit 42 Timely Threat Intelligence - Windows bot malware \"Blitz\" abuses HuggingFace services 1", "alert_category": "OTHER", "alert_type": null, "alert_description": "Blitz malware dropper filenames from observed files in VirusTotal communicating to huggingface.co domains", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1102.003\nconfig case_sensitive = false | preset=network_story  | filter actor_process_image_name IN (\"installer.exe\",\"*sw1zzx*\") and dst_action_external_hostname = \"huggingface.co\" | fields agent_hostname, _time, actor_process_image_name, actor_process_image_path, actor_process_command_line, dst_action_external_hostname, event_id ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 104, "name": "Unit42_MXSIAM_TI_Impact Report Introducing ToyMaker, an initial access broker working in cahoots with double extortion gangs 4", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1003\nconfig case_sensitive = false | dataset = xdr_data | filter event_type = ENUM.PROCESS and event_sub_type = ENUM.PROCESS_START | filter action_process_image_name = \"MRCv120.exe\" and action_process_image_command_line contains \"/accepteula*/silent*/go\" | fields _time, agent_hostname, actor_process_image_name, actor_process_command_line, action_process_image_name, action_process_image_command_line, actor_effective_username, action_process_signature_vendor | comp count() as mrc_executions, values(action_process_image_command_line) as mrc_commands, values (action_process_signature_vendor) as action_process_signature_vendor by actor_process_image_name, agent_hostname, actor_effective_username ", "is_enabled": true, "description": "Detects execution of Magnet RAM Capture, often used for memory dumping by ToyMaker actors.", "alert_name": "Unit42_MXSIAM_TI_Impact Report Introducing ToyMaker, an initial access broker working in cahoots with double extortion gangs 4", "alert_category": "OTHER", "alert_type": null, "alert_description": "Detects execution of Magnet RAM Capture, often used for memory dumping by ToyMaker actors.", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1003\nconfig case_sensitive = false | dataset = xdr_data | filter event_type = ENUM.PROCESS and event_sub_type = ENUM.PROCESS_START | filter action_process_image_name = \"MRCv120.exe\" and action_process_image_command_line contains \"/accepteula*/silent*/go\" | fields _time, agent_hostname, actor_process_image_name, actor_process_command_line, action_process_image_name, action_process_image_command_line, actor_effective_username, action_process_signature_vendor | comp count() as mrc_executions, values(action_process_image_command_line) as mrc_commands, values (action_process_signature_vendor) as action_process_signature_vendor by actor_process_image_name, agent_hostname, actor_effective_username ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 103, "name": "Unit42_MXSIAM_TI_Impact Report Introducing ToyMaker, an initial access broker working in cahoots with double extortion gangs 3", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1053.005\nconfig case_sensitive = false | dataset = xdr_data | filter event_type = ENUM.PROCESS and event_sub_type = ENUM.PROCESS_START | filter action_process_image_name = \"schtasks.exe\" and action_process_image_command_line contains \"/CREATE /RU SYSTEM /SC HOURLY /ST 14:00 /F /TN \\\"GoogleUpdateTaskMachine\\\"*ssh.exe*root@*C:\\Windows\\temp\\syslog.txt\\\" | fields _time, agent_hostname, actor_process_image_name, actor_process_command_line, action_process_image_name, action_process_image_command_line, actor_effective_username  | comp count() as schtask_creation_count, values(action_process_image_command_line) as schtask_creation_commands by actor_process_image_name, agent_hostname, actor_effective_username  ", "is_enabled": true, "description": "Detects scheduled task creation (schtasks.exe) used for persistence by Cactus actors.", "alert_name": "Unit42_MXSIAM_TI_Impact Report Introducing ToyMaker, an initial access broker working in cahoots with double extortion gangs 3", "alert_category": "OTHER", "alert_type": null, "alert_description": "Detects scheduled task creation (schtasks.exe) used for persistence by Cactus actors.", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1053.005\nconfig case_sensitive = false | dataset = xdr_data | filter event_type = ENUM.PROCESS and event_sub_type = ENUM.PROCESS_START | filter action_process_image_name = \"schtasks.exe\" and action_process_image_command_line contains \"/CREATE /RU SYSTEM /SC HOURLY /ST 14:00 /F /TN \\\"GoogleUpdateTaskMachine\\\"*ssh.exe*root@*C:\\Windows\\temp\\syslog.txt\\\" | fields _time, agent_hostname, actor_process_image_name, actor_process_command_line, action_process_image_name, action_process_image_command_line, actor_effective_username  | comp count() as schtask_creation_count, values(action_process_image_command_line) as schtask_creation_commands by actor_process_image_name, agent_hostname, actor_effective_username  ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 102, "name": "Unit42_MXSIAM_TI_Impact Report Introducing ToyMaker, an initial access broker working in cahoots with double extortion gangs 2", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1543.003\nconfig case_sensitive = false | dataset = xdr_data | filter event_type = ENUM.PROCESS and event_sub_type = ENUM.PROCESS_START | filter action_process_image_name = \"sc.exe\" and action_process_image_command_line = \"create WmiPrvSV start= auto error= ignore binPath= *\\Common Files\\Services\\WmiPrvSV.exe*\" | fields _time, agent_hostname, actor_process_image_name, actor_process_command_line, action_process_image_name, action_process_image_command_line, actor_effective_username  | comp count() as service_creation_count, values(action_process_image_command_line) as service_creation_commands by actor_process_image_name, agent_hostname, actor_effective_username ", "is_enabled": true, "description": "Detects service creation using sc.exe, associated with LAGTOY malware persistence.", "alert_name": "Unit42_MXSIAM_TI_Impact Report Introducing ToyMaker, an initial access broker working in cahoots with double extortion gangs 2", "alert_category": "OTHER", "alert_type": null, "alert_description": "Detects service creation using sc.exe, associated with LAGTOY malware persistence.", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1543.003\nconfig case_sensitive = false | dataset = xdr_data | filter event_type = ENUM.PROCESS and event_sub_type = ENUM.PROCESS_START | filter action_process_image_name = \"sc.exe\" and action_process_image_command_line = \"create WmiPrvSV start= auto error= ignore binPath= *\\Common Files\\Services\\WmiPrvSV.exe*\" | fields _time, agent_hostname, actor_process_image_name, actor_process_command_line, action_process_image_name, action_process_image_command_line, actor_effective_username  | comp count() as service_creation_count, values(action_process_image_command_line) as service_creation_commands by actor_process_image_name, agent_hostname, actor_effective_username ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 101, "name": "Unit42_MXSIAM_TI_Impact Report Introducing ToyMaker, an initial access broker working in cahoots with double extortion gangs 1", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1136.001\nconfig case_sensitive = false | dataset = xdr_data | filter event_type = ENUM.PROCESS and event_sub_type = ENUM.PROCESS_START | filter action_process_image_name = \"net.exe\" and (action_process_image_command_line contains \"user support Sup0rtadmin /add\" or action_process_image_command_line contains \"user whiteninja*/add\") | fields _time, agent_hostname, actor_process_image_name, actor_process_command_line, action_process_image_name, action_process_image_command_line, actor_effective_username | comp count() as num_fake_users_created, values(action_process_image_command_line) as fake_user_creation_commands by agent_hostname, actor_effective_username ", "is_enabled": true, "description": "Detects suspicious user creation using net.exe, often linked to ToyMaker and Cactus threat actors.", "alert_name": "Unit42_MXSIAM_TI_Impact Report Introducing ToyMaker, an initial access broker working in cahoots with double extortion gangs 1", "alert_category": "OTHER", "alert_type": null, "alert_description": "Detects suspicious user creation using net.exe, often linked to ToyMaker and Cactus threat actors.", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1136.001\nconfig case_sensitive = false | dataset = xdr_data | filter event_type = ENUM.PROCESS and event_sub_type = ENUM.PROCESS_START | filter action_process_image_name = \"net.exe\" and (action_process_image_command_line contains \"user support Sup0rtadmin /add\" or action_process_image_command_line contains \"user whiteninja*/add\") | fields _time, agent_hostname, actor_process_image_name, actor_process_command_line, action_process_image_name, action_process_image_command_line, actor_effective_username | comp count() as num_fake_users_created, values(action_process_image_command_line) as fake_user_creation_commands by agent_hostname, actor_effective_username ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 100, "name": "Unit42_MXSIAM_TI_Impact Report Detecting Multi-Stage Infection Chains Madness 3", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1547.001\nconfig case_sensitive = false  | dataset = xdr_data  | filter event_type = ENUM.FILE and action_file_extension in (\"vbs\", \"bat\") and (action_file_path contains \"Users\" and action_file_path contains \"Startup\") and (action_file_name contains \"pws\" or action_file_name contains \"startupppp\") | fields _time, agent_hostname, causality_actor_process_image_path, actor_process_image_path, actor_process_command_line, action_file_path | dedup agent_hostname, action_file_path ", "is_enabled": true, "description": "Persistence via Startup", "alert_name": "Unit42_MXSIAM_TI_Impact Report Detecting Multi-Stage Infection Chains Madness 3", "alert_category": "OTHER", "alert_type": null, "alert_description": "Persistence via Startup", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1547.001\nconfig case_sensitive = false  | dataset = xdr_data  | filter event_type = ENUM.FILE and action_file_extension in (\"vbs\", \"bat\") and (action_file_path contains \"Users\" and action_file_path contains \"Startup\") and (action_file_name contains \"pws\" or action_file_name contains \"startupppp\") | fields _time, agent_hostname, causality_actor_process_image_path, actor_process_image_path, actor_process_command_line, action_file_path | dedup agent_hostname, action_file_path ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 99, "name": "Unit42_MXSIAM_TI_Impact Report Detecting Multi-Stage Infection Chains Madness 2", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1218.005\nconfig case_sensitive = false  | dataset = xdr_data  | filter event_type = ENUM.PROCESS and actor_process_image_name = \"mshta.exe\" and (actor_process_image_command_line contains \"http\" OR actor_process_image_command_line contains \"script\" OR actor_process_image_command_line contains \".hta\") and action_process_image_name in (\"cmd.exe\",\"powershell.exe\",\"powershell_ise.exe\",\"curl.exe\",\"wget.exe\",\"rundll32.exe\",\"regsvr32.exe\",\"cscript.exe\",\"wscript.exe\",\"bitsadmin.exe\")  | fields _time, agent_hostname, actor_effective_username, actor_process_image_path, action_process_image_command_line | dedup agent_hostname, action_process_image_command_line ", "is_enabled": true, "description": "Mshta Suspicious Child Process", "alert_name": "Unit42_MXSIAM_TI_Impact Report Detecting Multi-Stage Infection Chains Madness 2", "alert_category": "OTHER", "alert_type": null, "alert_description": "Mshta Suspicious Child Process", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1218.005\nconfig case_sensitive = false  | dataset = xdr_data  | filter event_type = ENUM.PROCESS and actor_process_image_name = \"mshta.exe\" and (actor_process_image_command_line contains \"http\" OR actor_process_image_command_line contains \"script\" OR actor_process_image_command_line contains \".hta\") and action_process_image_name in (\"cmd.exe\",\"powershell.exe\",\"powershell_ise.exe\",\"curl.exe\",\"wget.exe\",\"rundll32.exe\",\"regsvr32.exe\",\"cscript.exe\",\"wscript.exe\",\"bitsadmin.exe\")  | fields _time, agent_hostname, actor_effective_username, actor_process_image_path, action_process_image_command_line | dedup agent_hostname, action_process_image_command_line ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 98, "name": "Unit42_MXSIAM_TI_Impact Report Detecting Multi-Stage Infection Chains Madness 1", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1566.001\nconfig case_sensitive = false | dataset = xdr_data | filter event_type = ENUM.FILE and event_sub_type = ENUM.FILE_WRITE | filter action_file_extension in (\"library-ms\") and lowercase(actor_process_image_name) in(\"outlook.exe\", \"foxmail.exe\", \"mailbird.exe\", \"mailclient.exe\",\"thunderbird.exe\") | fields _time, agent_hostname, event_type, event_sub_type, action_file_name, action_file_path, actor_effective_username, action_file_sha256, actor_process_image_path,causality_actor_process_image_path, action_file_signature_status, action_file_web_mark, action_file_size | dedup agent_hostname, action_file_path ", "is_enabled": true, "description": "Email attachment with library-ms file", "alert_name": "Unit42_MXSIAM_TI_Impact Report Detecting Multi-Stage Infection Chains Madness 1", "alert_category": "OTHER", "alert_type": null, "alert_description": "Email attachment with library-ms file", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1566.001\nconfig case_sensitive = false | dataset = xdr_data | filter event_type = ENUM.FILE and event_sub_type = ENUM.FILE_WRITE | filter action_file_extension in (\"library-ms\") and lowercase(actor_process_image_name) in(\"outlook.exe\", \"foxmail.exe\", \"mailbird.exe\", \"mailclient.exe\",\"thunderbird.exe\") | fields _time, agent_hostname, event_type, event_sub_type, action_file_name, action_file_path, actor_effective_username, action_file_sha256, actor_process_image_path,causality_actor_process_image_path, action_file_signature_status, action_file_web_mark, action_file_size | dedup agent_hostname, action_file_path ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 97, "name": "Unit42_MSIAM_TI_Impact Report Downloader Malware Written in JPHP Interpreter 2", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1071.001\ndataset = xdr_data  | filter event_type in (ENUM.NETWORK, ENUM.STORY) | filter lowercase(actor_process_image_name) = \"javaw.exe\" and lowercase(actor_process_image_command_line) contains \"jphp\" | alter ssl_sni = trim(json_extract(action_network_dpi_fields, \"$.0.Handshake.0.sni\"),\"\\\"\") | filter lowercase(action_external_hostname) = \"t.me\" or lowercase(dst_action_external_hostname) = \"t.me\" or lowercase(ssl_sni) = \"t.me\" | fields _time, agent_hostname, actor_effective_username, causality_actor_process_image_path, causality_actor_process_command_line, actor_process_image_path, actor_process_command_line, action_local_ip, action_local_port, action_remote_ip, action_remote_port, action_external_hostname, dst_action_external_hostname, ssl_sni ", "is_enabled": true, "description": "This query attempts to identify instances of Java that loaded JPHP libraries which make a network connection to Telegram.", "alert_name": "Unit42_MSIAM_TI_Impact Report Downloader Malware Written in JPHP Interpreter 2", "alert_category": "OTHER", "alert_type": null, "alert_description": "This query attempts to identify instances of Java that loaded JPHP libraries which make a network connection to Telegram.", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1071.001\ndataset = xdr_data  | filter event_type in (ENUM.NETWORK, ENUM.STORY) | filter lowercase(actor_process_image_name) = \"javaw.exe\" and lowercase(actor_process_image_command_line) contains \"jphp\" | alter ssl_sni = trim(json_extract(action_network_dpi_fields, \"$.0.Handshake.0.sni\"),\"\\\"\") | filter lowercase(action_external_hostname) = \"t.me\" or lowercase(dst_action_external_hostname) = \"t.me\" or lowercase(ssl_sni) = \"t.me\" | fields _time, agent_hostname, actor_effective_username, causality_actor_process_image_path, causality_actor_process_command_line, actor_process_image_path, actor_process_command_line, action_local_ip, action_local_port, action_remote_ip, action_remote_port, action_external_hostname, dst_action_external_hostname, ssl_sni ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 96, "name": "Unit42_MSIAM_TI_Impact Report Downloader Malware Written in JPHP Interpreter 1", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1105\ndataset = xdr_data  | filter agent_os_type = ENUM.AGENT_OS_WINDOWS  | filter event_type = ENUM.PROCESS and event_sub_type = ENUM.PROCESS_START | filter lowercase(actor_process_image_name) = \"javaw.exe\" and lowercase(actor_process_image_command_line) contains \"jphp\" | filter lowercase(action_process_image_name) in (\"cmd.exe\", \"powershell.exe\") or lowercase(action_process_image_path) contains \"temp\" | fields _time, agent_hostname, actor_effective_username, causality_actor_process_image_path, causality_actor_process_command_line, actor_process_image_path, actor_process_command_line, action_process_image_path, action_process_image_command_line  ", "is_enabled": true, "description": "This query attempts to identify instances of Java that loaded JPHP libraries that spawn Powershell or binaries from temp directories.", "alert_name": "Unit42_MSIAM_TI_Impact Report Downloader Malware Written in JPHP Interpreter 1", "alert_category": "OTHER", "alert_type": null, "alert_description": "This query attempts to identify instances of Java that loaded JPHP libraries that spawn Powershell or binaries from temp directories.", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1105\ndataset = xdr_data  | filter agent_os_type = ENUM.AGENT_OS_WINDOWS  | filter event_type = ENUM.PROCESS and event_sub_type = ENUM.PROCESS_START | filter lowercase(actor_process_image_name) = \"javaw.exe\" and lowercase(actor_process_image_command_line) contains \"jphp\" | filter lowercase(action_process_image_name) in (\"cmd.exe\", \"powershell.exe\") or lowercase(action_process_image_path) contains \"temp\" | fields _time, agent_hostname, actor_effective_username, causality_actor_process_image_path, causality_actor_process_command_line, actor_process_image_path, actor_process_command_line, action_process_image_path, action_process_image_command_line  ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 95, "name": "Unit42_MSIAM_TI_Impact Report Chrome extensions with 6 million installs have hidden tracking code 1", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1176 - Browser Extensions\nconfig case_sensitive = false\n| preset = xdr_file\n| filter event_sub_type = FILE_OPEN\n| alter extension = arrayindex(regextract(action_file_path, \"(\\w{32})\"), 0)\n| filter action_file_path CONTAINS \"extensions\" \n  AND extension in (\n    \"odccobbfnngplckpongkahajfjpnbcck\", // Fire Shield Secure Search\n    \"afefmfbcccnppcaiebpmbpmddhilkkdi\", // Fire Shield Chrome Safety\n    \"oaljkhbgbedmfoiieocoenglpaeogjmf\", // Safe Search for Chrome\u2122\n    \"ndajnaaobjaganokllcgbapngenfbgkc\", // Fire Shield Extension Protection\n    \"okjdbeegldeilceaflghgfdemobmfhbd\", // Browser Checkup for Chrome by Doctor\n    \"jhigofkbdbndeooldpdhmphldaglejlh\", // Protecto for Chrome\u2122\n    \"pmgmbeeafpdjjhmeaalneginpmdhamhe\", // Unbiased Search by Protecto\n    \"eobcealmgdjeoheieiobkedbgddicaba\", // Securify Your Browser\n    \"lnedcnepmplnjmfdiclhbfhneconamoj\", // Web Privacy Assistant\n    \"gadjnphfolikkffmppnicebdfimlblkj\", // Securify Kid Protection\n    \"njfkgeajknkffkngdmjmjninkbgjedlo\", // Bing Search by Securify\n    \"eldjnmdpkecnjjkmmgndpcibgkfpodfh\", // Browse Securely for Chrome\u2122\n    \"omieocempinhilcpbmnfdaamgomapded\", // Better Browse by SecurySearch\n    \"ilgbcnkedmncjlhpfconadpjnhlflejf\", // Check My Permissions for Chrome\n    \"okggiiagcegdfiajlkodohfkeemnjlnd\", // Website Safety for Chrome\n    \"jgajjllfidghjkjfipmjbaegafkdpfha\", // MultiSearch for Chrome\u2122\n    \"gpibjjfllodpcfhcjpamonnblkbinbie\", // Global search for Chrome\u2122\n    \"hpdpddnfjaacnbcnoohlcipfafkbmdja\", // Map Search for Chrome\u2122\n    \"lljnhidbljbfkejjcfogkhgmgdihjmlf\", // Watch Tower Overview\n    \"gclgncjpanihjpbjbecgfmfnipggcckn\", // Incognito Shield for Chrome\u2122\n    \"cpehflfpgdgofpocagbdeecjlfhjfjdh\", // In Site Search for Chrome\u2122\n    \"mdenajpfccjjjnbochgkdahmnipfpelc\", // Privacy Guard for Chrome\u2122\n    \"eoclijfghiglinncpceohgaigfgnlbim\", // Yahoo Search by Ghost\n    \"cghdfcbncfjhleinblpalngjhojokjeo\", // Private Search for Chrome\u2122\n    \"jeahgicmhigopdgilnmclihdjjlhnmop\", // Total Safety for Chrome\u2122\n    \"edbhdbhgdbanjhdnpjcianjgfmdkgbcf\", // Data Shield for Chrome\n    \"jjnfhbcilcppomkcmkbbmcadoihkkgah\", // Browser WatchDog for Chrome\n    \"dmnajaiijohbndidolbdbpicdjanombo\", // Incognito Search for Chrome\u2122\n    \"gpghebehjahceknfdcfifeifhdbongld\", // Web Results for Chrome\u2122\n    \"gidejehfgombmkfflghejpncblgfkagj\", // Cuponomia - Coupon and Cashback\n    \"koolcjajfdkjjfklmidahmcjhcmmkhma\", // Securify for Chrome\u2122\n    \"gijlkeaijpeaoihdajcgmiajeoonnkoj\", // Securify Advanced Web Protection\n    \"kldgaejigkhpgmfglbamggiglngkifck\", // News Search for Chrome\u2122\n    \"ojlhcbolfcndnojcjhhjgmdblnojgefm\", // SecuryBrowse for Chrome\u2122\n    \"kiecdaoopedhfgapicmpebbhodepnbbp\", // Choose Your Chrome Tools\n    \"dmakkciciccnjgmfjflpbdfkdnmpfghp\", // Securify Viewpoint Search\u2122\n    \"ebhcaliljppmelancooakfgcgcceiind\", // Quick Manuals for Chrome\u2122\n    \"eekblbhfmladafbmpgkdedmolbjkjbnc\", // Search Images on Chrome\u2122\n    \"ejkdgndbgpfcaggpmnijcbddlnmdnpka\", // Givero Search for Chrome\u2122\n    \"fojomppheellamdaddnbgommepnlkooh\", // Secured Connection by SecuryBrowse\n    \"gmbebpcapalekeaoekfhpbioilghcfmp\", // AI Browser Manager\u2122\n    \"ndcphhjcebhifabfmebineokbfdnbphm\", // Protected Browsing on Chrome\u2122\n    \"oghbffaoaooigagpockijkpfpgmnibkh\", // ChatGPT Search for Chrome\u2122\n    \"oppeaknhldjjnfnflbcedipjbnbimhhf\", // Games Search for Chrome\u2122\n    \"pcfapghfanllmbdfiipeiihpkojekckk\", // Address Checker for Chrome\u2122\n    \"lfmdddfdacgdimongmjclgijepoknmjm\", // Recipe Search for Chrome\u2122\n    \"pmannhofeaiadkcdbcebhnkcnkjjnfpn\", // Search Safely by SecurySearch\n    \"lkbfbidpkbeicafnnhlaockggaknjolf\", // SecurySearch for Chrome\n    \"adjpoipklnhlapjijccnemdhkcphcegd\", // Website Orientations\n    \"dkcjihabohaldgjkdmenepolojcjdaah\", // Protecto Whois Search\u2122\n    \"iiegilogjnagependdonbfcmfmmaamon\", // Productive Search for Chrome\u2122\n    \"aiaaeimmjjeceodjpficfnjckenedbon\", // Secure Search for Chrome\u2122\n    \"alogdolelipkojjgggejccalcbdioolg\", // Yahoo SecurySearch\u2122\n    \"fchgahponkgfomlgieipannlfanfbfak\", // ProtectMyInfo for Chrome\u2122\n    \"ldanhaibkdifncinbpjdjpambmofmpkf\", // Advanced Search for Chrome\u2122\n    \"aehjmdkbfemaefoebbihbfcmhehgimcl\"  // New Tab for Chrome \u2122\n  )\n| dedup agent_hostname,actor_effective_username,actor_process_image_name,extension\n| fields agent_hostname,actor_effective_username,actor_process_image_name,extension, event_type, event_sub_type\n", "is_enabled": true, "description": "Identifies Chrome extensions installed on disk by checking for known 32-character extension IDs linked to over 6 million installations as reported by McAfee and BleepingComputer. These extensions contain obfuscated JavaScript capable of dynamic command-and-control behavior, user activity tracking, cookie access, and remote iframe injection. This detection helps uncover stealthy, potentially privacy-invasive plugins impersonating security and productivity tools.", "alert_name": "Unit42_MSIAM_TI_Impact Report Chrome extensions with 6 million installs have hidden tracking code 1", "alert_category": "OTHER", "alert_type": null, "alert_description": "Identifies Chrome extensions installed on disk by checking for known 32-character extension IDs linked to over 6 million installations as reported by McAfee and BleepingComputer. These extensions contain obfuscated JavaScript capable of dynamic command-and-control behavior, user activity tracking, cookie access, and remote iframe injection. This detection helps uncover stealthy, potentially privacy-invasive plugins impersonating security and productivity tools.", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1176 - Browser Extensions\nconfig case_sensitive = false\n| preset = xdr_file\n| filter event_sub_type = FILE_OPEN\n| alter extension = arrayindex(regextract(action_file_path, \"(\\w{32})\"), 0)\n| filter action_file_path CONTAINS \"extensions\" \n  AND extension in (\n    \"odccobbfnngplckpongkahajfjpnbcck\", // Fire Shield Secure Search\n    \"afefmfbcccnppcaiebpmbpmddhilkkdi\", // Fire Shield Chrome Safety\n    \"oaljkhbgbedmfoiieocoenglpaeogjmf\", // Safe Search for Chrome\u2122\n    \"ndajnaaobjaganokllcgbapngenfbgkc\", // Fire Shield Extension Protection\n    \"okjdbeegldeilceaflghgfdemobmfhbd\", // Browser Checkup for Chrome by Doctor\n    \"jhigofkbdbndeooldpdhmphldaglejlh\", // Protecto for Chrome\u2122\n    \"pmgmbeeafpdjjhmeaalneginpmdhamhe\", // Unbiased Search by Protecto\n    \"eobcealmgdjeoheieiobkedbgddicaba\", // Securify Your Browser\n    \"lnedcnepmplnjmfdiclhbfhneconamoj\", // Web Privacy Assistant\n    \"gadjnphfolikkffmppnicebdfimlblkj\", // Securify Kid Protection\n    \"njfkgeajknkffkngdmjmjninkbgjedlo\", // Bing Search by Securify\n    \"eldjnmdpkecnjjkmmgndpcibgkfpodfh\", // Browse Securely for Chrome\u2122\n    \"omieocempinhilcpbmnfdaamgomapded\", // Better Browse by SecurySearch\n    \"ilgbcnkedmncjlhpfconadpjnhlflejf\", // Check My Permissions for Chrome\n    \"okggiiagcegdfiajlkodohfkeemnjlnd\", // Website Safety for Chrome\n    \"jgajjllfidghjkjfipmjbaegafkdpfha\", // MultiSearch for Chrome\u2122\n    \"gpibjjfllodpcfhcjpamonnblkbinbie\", // Global search for Chrome\u2122\n    \"hpdpddnfjaacnbcnoohlcipfafkbmdja\", // Map Search for Chrome\u2122\n    \"lljnhidbljbfkejjcfogkhgmgdihjmlf\", // Watch Tower Overview\n    \"gclgncjpanihjpbjbecgfmfnipggcckn\", // Incognito Shield for Chrome\u2122\n    \"cpehflfpgdgofpocagbdeecjlfhjfjdh\", // In Site Search for Chrome\u2122\n    \"mdenajpfccjjjnbochgkdahmnipfpelc\", // Privacy Guard for Chrome\u2122\n    \"eoclijfghiglinncpceohgaigfgnlbim\", // Yahoo Search by Ghost\n    \"cghdfcbncfjhleinblpalngjhojokjeo\", // Private Search for Chrome\u2122\n    \"jeahgicmhigopdgilnmclihdjjlhnmop\", // Total Safety for Chrome\u2122\n    \"edbhdbhgdbanjhdnpjcianjgfmdkgbcf\", // Data Shield for Chrome\n    \"jjnfhbcilcppomkcmkbbmcadoihkkgah\", // Browser WatchDog for Chrome\n    \"dmnajaiijohbndidolbdbpicdjanombo\", // Incognito Search for Chrome\u2122\n    \"gpghebehjahceknfdcfifeifhdbongld\", // Web Results for Chrome\u2122\n    \"gidejehfgombmkfflghejpncblgfkagj\", // Cuponomia - Coupon and Cashback\n    \"koolcjajfdkjjfklmidahmcjhcmmkhma\", // Securify for Chrome\u2122\n    \"gijlkeaijpeaoihdajcgmiajeoonnkoj\", // Securify Advanced Web Protection\n    \"kldgaejigkhpgmfglbamggiglngkifck\", // News Search for Chrome\u2122\n    \"ojlhcbolfcndnojcjhhjgmdblnojgefm\", // SecuryBrowse for Chrome\u2122\n    \"kiecdaoopedhfgapicmpebbhodepnbbp\", // Choose Your Chrome Tools\n    \"dmakkciciccnjgmfjflpbdfkdnmpfghp\", // Securify Viewpoint Search\u2122\n    \"ebhcaliljppmelancooakfgcgcceiind\", // Quick Manuals for Chrome\u2122\n    \"eekblbhfmladafbmpgkdedmolbjkjbnc\", // Search Images on Chrome\u2122\n    \"ejkdgndbgpfcaggpmnijcbddlnmdnpka\", // Givero Search for Chrome\u2122\n    \"fojomppheellamdaddnbgommepnlkooh\", // Secured Connection by SecuryBrowse\n    \"gmbebpcapalekeaoekfhpbioilghcfmp\", // AI Browser Manager\u2122\n    \"ndcphhjcebhifabfmebineokbfdnbphm\", // Protected Browsing on Chrome\u2122\n    \"oghbffaoaooigagpockijkpfpgmnibkh\", // ChatGPT Search for Chrome\u2122\n    \"oppeaknhldjjnfnflbcedipjbnbimhhf\", // Games Search for Chrome\u2122\n    \"pcfapghfanllmbdfiipeiihpkojekckk\", // Address Checker for Chrome\u2122\n    \"lfmdddfdacgdimongmjclgijepoknmjm\", // Recipe Search for Chrome\u2122\n    \"pmannhofeaiadkcdbcebhnkcnkjjnfpn\", // Search Safely by SecurySearch\n    \"lkbfbidpkbeicafnnhlaockggaknjolf\", // SecurySearch for Chrome\n    \"adjpoipklnhlapjijccnemdhkcphcegd\", // Website Orientations\n    \"dkcjihabohaldgjkdmenepolojcjdaah\", // Protecto Whois Search\u2122\n    \"iiegilogjnagependdonbfcmfmmaamon\", // Productive Search for Chrome\u2122\n    \"aiaaeimmjjeceodjpficfnjckenedbon\", // Secure Search for Chrome\u2122\n    \"alogdolelipkojjgggejccalcbdioolg\", // Yahoo SecurySearch\u2122\n    \"fchgahponkgfomlgieipannlfanfbfak\", // ProtectMyInfo for Chrome\u2122\n    \"ldanhaibkdifncinbpjdjpambmofmpkf\", // Advanced Search for Chrome\u2122\n    \"aehjmdkbfemaefoebbihbfcmhehgimcl\"  // New Tab for Chrome \u2122\n  )\n| dedup agent_hostname,actor_effective_username,actor_process_image_name,extension\n| fields agent_hostname,actor_effective_username,actor_process_image_name,extension, event_type, event_sub_type\n", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 88, "name": "Unit42_MSIAM_TI_Impact Report Threat actors misuse Node.js to deliver malware and other malicious payloads 1", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1562, T1059\n config case_sensitive = false | dataset = xdr_data | filter event_type = ENUM.PROCESS and event_sub_type = ENUM.PROCESS_START | filter action_process_image_name = \"powershell.exe\" and action_process_image_command_line in (\"*Set-MpPreference*\", \"*Add-MpPreference*\") | filter action_process_image_command_line in (\"*ExclusionPath*\", \"*ExclusionProcess*\") | fields agent_hostname, actor_effective_username, action_process_image_name, action_process_image_command_line  ", "is_enabled": false, "description": "Detect Microsoft Defender being excluded through PowerShell. Note: High false positive rate from legitimate or unrelated activity.", "alert_name": "Unit42_MSIAM_TI_Impact Report Threat actors misuse Node.js to deliver malware and other malicious payloads 1", "alert_category": "OTHER", "alert_type": null, "alert_description": "Detect Microsoft Defender being excluded through PowerShell. Note: High false positive rate from legitimate or unrelated activity.", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1562, T1059\n config case_sensitive = false | dataset = xdr_data | filter event_type = ENUM.PROCESS and event_sub_type = ENUM.PROCESS_START | filter action_process_image_name = \"powershell.exe\" and action_process_image_command_line in (\"*Set-MpPreference*\", \"*Add-MpPreference*\") | filter action_process_image_command_line in (\"*ExclusionPath*\", \"*ExclusionProcess*\") | fields agent_hostname, actor_effective_username, action_process_image_name, action_process_image_command_line  ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 94, "name": "Unit42_MSIAM_TI_Impact Report TookPS DeepSeek isn\u2019t the only game in town 3", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1574.002\nconfig case_sensitive = false | dataset = xdr_data  | filter event_type = ENUM.LOAD_IMAGE  | filter actor_process_image_path contains \"AppData\\Roaming\\QTUpdate\" and (action_module_path contains \"AppData\\Roaming\\QTUpdate\\msi.dll\" and action_module_signature_status = ENUM.UNSIGNED) | fields agent_hostname, actor_effective_username, action_module_path, action_module_signature_status, action_module_sha256, actor_process_image_name, actor_process_image_path, actor_process_command_line, causality_actor_process_image_name, causality_actor_process_image_path, causality_actor_process_command_line ", "is_enabled": true, "description": "This query detects DLL sideloading used to load a malicious msi.dll file into TeamViewer, enabling covert remote access. ", "alert_name": "Unit42_MSIAM_TI_Impact Report TookPS DeepSeek isn\u2019t the only game in town 3", "alert_category": "OTHER", "alert_type": null, "alert_description": "This query detects DLL sideloading used to load a malicious msi.dll file into TeamViewer, enabling covert remote access. ", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1574.002\nconfig case_sensitive = false | dataset = xdr_data  | filter event_type = ENUM.LOAD_IMAGE  | filter actor_process_image_path contains \"AppData\\Roaming\\QTUpdate\" and (action_module_path contains \"AppData\\Roaming\\QTUpdate\\msi.dll\" and action_module_signature_status = ENUM.UNSIGNED) | fields agent_hostname, actor_effective_username, action_module_path, action_module_signature_status, action_module_sha256, actor_process_image_name, actor_process_image_path, actor_process_command_line, causality_actor_process_image_name, causality_actor_process_image_path, causality_actor_process_command_line ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 93, "name": "Unit42_MSIAM_TI_Impact Report TookPS DeepSeek isn\u2019t the only game in town 2", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1021.004\nconfig case_sensitive = false | dataset = xdr_data | filter event_type = ENUM.PROCESS and event_sub_type = ENUM.PROCESS_START  | filter actor_process_image_name = \"powershell.exe\"  | filter action_process_image_name = \"ssh.exe\" and action_process_image_command_line ~= \"-N -R \\d+:localhost:\\d+ .*@.* -i .* -f .*\" | fields agent_hostname, actor_effective_username, action_process_image_name, action_process_image_path, action_process_image_command_line, actor_process_image_name, actor_process_image_path, actor_process_command_line, causality_actor_process_image_name, causality_actor_process_image_path, causality_actor_process_command_line ", "is_enabled": true, "description": "This query detects potential SSH tunneling activity associated with TookPS malware by identifying suspicious ssh.exe command-line patterns.", "alert_name": "Unit42_MSIAM_TI_Impact Report TookPS DeepSeek isn\u2019t the only game in town 2", "alert_category": "OTHER", "alert_type": null, "alert_description": "This query detects potential SSH tunneling activity associated with TookPS malware by identifying suspicious ssh.exe command-line patterns.", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1021.004\nconfig case_sensitive = false | dataset = xdr_data | filter event_type = ENUM.PROCESS and event_sub_type = ENUM.PROCESS_START  | filter actor_process_image_name = \"powershell.exe\"  | filter action_process_image_name = \"ssh.exe\" and action_process_image_command_line ~= \"-N -R \\d+:localhost:\\d+ .*@.* -i .* -f .*\" | fields agent_hostname, actor_effective_username, action_process_image_name, action_process_image_path, action_process_image_command_line, actor_process_image_name, actor_process_image_path, actor_process_command_line, causality_actor_process_image_name, causality_actor_process_image_path, causality_actor_process_command_line ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 92, "name": "Unit42_MSIAM_TI_Impact Report TookPS DeepSeek isn\u2019t the only game in town 1", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID:  T1059.001\nconfig case_sensitive = false | dataset = xdr_data | filter event_type = ENUM.EVENT_LOG and action_evtlog_event_id = 1101 | filter actor_process_image_name in (\"powershell.exe\", \"pwsh.exe\") | alter content = action_evtlog_data_fields -> content | filter content ~= \"\\$\\w=iwr \\\"https?://.*\\.php\\?HWID=.*\\\" -usebasicparsing \\|iex;\" or content ~= \"\\$TookEnc\" | fields agent_hostname, actor_effective_username, content, actor_process_image_name, actor_process_command_line ", "is_enabled": true, "description": "This query identifies the command structure and unique variable used in PowerShell scripts executed by TookPS malware.", "alert_name": "Unit42_MSIAM_TI_Impact Report TookPS DeepSeek isn\u2019t the only game in town 1", "alert_category": "OTHER", "alert_type": null, "alert_description": "This query identifies the command structure and unique variable used in PowerShell scripts executed by TookPS malware.", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID:  T1059.001\nconfig case_sensitive = false | dataset = xdr_data | filter event_type = ENUM.EVENT_LOG and action_evtlog_event_id = 1101 | filter actor_process_image_name in (\"powershell.exe\", \"pwsh.exe\") | alter content = action_evtlog_data_fields -> content | filter content ~= \"\\$\\w=iwr \\\"https?://.*\\.php\\?HWID=.*\\\" -usebasicparsing \\|iex;\" or content ~= \"\\$TookEnc\" | fields agent_hostname, actor_effective_username, content, actor_process_image_name, actor_process_command_line ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 91, "name": "Unit42_MSIAM_TI_Impact Report Threat actors misuse Node.js to deliver malware and other malicious payloads 4", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1059\nconfig case_sensitive = false | dataset = xdr_data | filter event_type = STORY and actor_process_image_name = \"powershell.exe\" and dst_action_external_hostname = \"*trycloudflare.com\"  | fields event_type, agent_hostname, actor_effective_username, actor_process_image_name, actor_process_command_line, dst_action_external_hostname, action_local_ip, action_remote_ip, action_remote_port ", "is_enabled": true, "description": "Powershell connection to trycloudflare domain (network detection)", "alert_name": "Unit42_MSIAM_TI_Impact Report Threat actors misuse Node.js to deliver malware and other malicious payloads 4", "alert_category": "OTHER", "alert_type": null, "alert_description": "Powershell connection to trycloudflare domain (network detection)", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1059\nconfig case_sensitive = false | dataset = xdr_data | filter event_type = STORY and actor_process_image_name = \"powershell.exe\" and dst_action_external_hostname = \"*trycloudflare.com\"  | fields event_type, agent_hostname, actor_effective_username, actor_process_image_name, actor_process_command_line, dst_action_external_hostname, action_local_ip, action_remote_ip, action_remote_port ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 90, "name": "Unit42_MSIAM_TI_Impact Report Threat actors misuse Node.js to deliver malware and other malicious payloads 3", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1059\nconfig case_sensitive = false | dataset = xdr_data | filter event_type = PROCESS and action_process_image_name = \"powershell.exe\" and action_process_image_command_line contains \"trycloudflare.com\" | fields agent_hostname, actor_effective_username, actor_process_command_line, action_process_image_name, action_process_image_command_line ", "is_enabled": true, "description": "Powershell connection to trycloudflare domain (command line detection)", "alert_name": "Unit42_MSIAM_TI_Impact Report Threat actors misuse Node.js to deliver malware and other malicious payloads 3", "alert_category": "OTHER", "alert_type": null, "alert_description": "Powershell connection to trycloudflare domain (command line detection)", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1059\nconfig case_sensitive = false | dataset = xdr_data | filter event_type = PROCESS and action_process_image_name = \"powershell.exe\" and action_process_image_command_line contains \"trycloudflare.com\" | fields agent_hostname, actor_effective_username, actor_process_command_line, action_process_image_name, action_process_image_command_line ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 89, "name": "Unit42_MSIAM_TI_Impact Report Threat actors misuse Node.js to deliver malware and other malicious payloads 2", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1059, T1544\nconfig case_sensitive = false | dataset = xdr_data  | filter event_type = ENUM.FILE  and event_sub_type in (ENUM.FILE_CREATE_NEW, ENUM.FILE_WRITE, ENUM.FILE_RENAME) | filter actor_process_image_name = \"powershell.exe\" and action_file_extension in (\"js\", \"jsc\") and actor_process_command_line contains \"invoke-webrequest\" | fields event_type, event_sub_type, agent_hostname, actor_effective_username, action_file_path, action_file_extension, actor_process_image_path, actor_process_command_line ", "is_enabled": true, "description": "Powershell writing JS/JSC files to disk from internet source. Note: High false positive rate.", "alert_name": "Unit42_MSIAM_TI_Impact Report Threat actors misuse Node.js to deliver malware and other malicious payloads 2", "alert_category": "OTHER", "alert_type": null, "alert_description": "Powershell writing JS/JSC files to disk from internet source. Note: High false positive rate.", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1059, T1544\nconfig case_sensitive = false | dataset = xdr_data  | filter event_type = ENUM.FILE  and event_sub_type in (ENUM.FILE_CREATE_NEW, ENUM.FILE_WRITE, ENUM.FILE_RENAME) | filter actor_process_image_name = \"powershell.exe\" and action_file_extension in (\"js\", \"jsc\") and actor_process_command_line contains \"invoke-webrequest\" | fields event_type, event_sub_type, agent_hostname, actor_effective_username, action_file_path, action_file_extension, actor_process_image_path, actor_process_command_line ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 87, "name": "Unit42_MSIAM_TI_Impact Report Analyzing OBSCURE 7", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1543.003\ndataset = xdr_data | filter event_type = ENUM.FILE | fields _time, agent_hostname, actor_process_image_name, actor_process_image_path, actor_process_command_line, action_file_name, action_file_path, action_file_extension, action_file_sha256 | filter lowercase(action_file_path) contains \"windows\\system32\\drivers\\acpix86.sys\" ", "is_enabled": true, "description": "This query looks for the driver, ACPIx86.sys, being added", "alert_name": "Unit42_MSIAM_TI_Impact Report Analyzing OBSCURE 7", "alert_category": "OTHER", "alert_type": null, "alert_description": "This query looks for the driver, ACPIx86.sys, being added", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1543.003\ndataset = xdr_data | filter event_type = ENUM.FILE | fields _time, agent_hostname, actor_process_image_name, actor_process_image_path, actor_process_command_line, action_file_name, action_file_path, action_file_extension, action_file_sha256 | filter lowercase(action_file_path) contains \"windows\\system32\\drivers\\acpix86.sys\" ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 86, "name": "Unit42_MSIAM_TI_Impact Report Analyzing OBSCURE 6", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1112\ndataset = xdr_data | filter event_type = ENUM.REGISTRY  | fields _time, agent_hostname, event_sub_type, actor_primary_username, actor_process_image_name, actor_process_command_line, action_registry_key_name, action_registry_value_name, action_registry_data | filter action_registry_key_name contains \"\\$nya-\" or action_registry_value_name contains \"\\$nya-\" ", "is_enabled": true, "description": "This query looks for registry changes identified in the Securonix blog post", "alert_name": "Unit42_MSIAM_TI_Impact Report Analyzing OBSCURE 6", "alert_category": "OTHER", "alert_type": null, "alert_description": "This query looks for registry changes identified in the Securonix blog post", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1112\ndataset = xdr_data | filter event_type = ENUM.REGISTRY  | fields _time, agent_hostname, event_sub_type, actor_primary_username, actor_process_image_name, actor_process_command_line, action_registry_key_name, action_registry_value_name, action_registry_data | filter action_registry_key_name contains \"\\$nya-\" or action_registry_value_name contains \"\\$nya-\" ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 85, "name": "Unit42_MSIAM_TI_Impact Report Analyzing OBSCURE 5", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1059.001\ndataset = xdr_data | filter event_type = ENUM.PROCESS | fields _time, agent_hostname, actor_effective_username, actor_process_image_name, actor_process_image_path, actor_process_command_line, action_process_image_name, action_process_image_path, action_process_image_command_line, causality_actor_process_image_name, causality_actor_process_image_path, causality_actor_process_command_line  | filter action_process_image_name = \"cmd.exe\" and lowercase(action_process_image_command_line) contains \"echo function\" and lowercase(action_process_image_command_line) contains \"invoke-expression\" and lowercase(action_process_image_command_line) contains \"replace\" ", "is_enabled": true, "description": "This query looks for OBSCURE#BAT using cmd.exe to echo PowerShell code, with the intent of storing it in an environment variable", "alert_name": "Unit42_MSIAM_TI_Impact Report Analyzing OBSCURE 5", "alert_category": "OTHER", "alert_type": null, "alert_description": "This query looks for OBSCURE#BAT using cmd.exe to echo PowerShell code, with the intent of storing it in an environment variable", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1059.001\ndataset = xdr_data | filter event_type = ENUM.PROCESS | fields _time, agent_hostname, actor_effective_username, actor_process_image_name, actor_process_image_path, actor_process_command_line, action_process_image_name, action_process_image_path, action_process_image_command_line, causality_actor_process_image_name, causality_actor_process_image_path, causality_actor_process_command_line  | filter action_process_image_name = \"cmd.exe\" and lowercase(action_process_image_command_line) contains \"echo function\" and lowercase(action_process_image_command_line) contains \"invoke-expression\" and lowercase(action_process_image_command_line) contains \"replace\" ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 84, "name": "Unit42_MSIAM_TI_Impact Report Analyzing OBSCURE 4", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1059.001\ndataset = xdr_data | filter event_type = ENUM.REGISTRY  | fields _time, agent_hostname, event_sub_type, actor_primary_username, actor_process_image_name, actor_process_command_line, action_registry_key_name, action_registry_value_name, action_registry_data | filter lowercase(action_registry_key_name) contains \"environment\"  | filter lowercase(action_registry_data) contains \"function\" and lowercase(action_registry_data) contains \"invoke-expression\" and lowercase(action_registry_data) contains \"replace\" ", "is_enabled": true, "description": "This query looks for OBSCURE#BAT adding an environment variable that contains PowerShell code", "alert_name": "Unit42_MSIAM_TI_Impact Report Analyzing OBSCURE 4", "alert_category": "OTHER", "alert_type": null, "alert_description": "This query looks for OBSCURE#BAT adding an environment variable that contains PowerShell code", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1059.001\ndataset = xdr_data | filter event_type = ENUM.REGISTRY  | fields _time, agent_hostname, event_sub_type, actor_primary_username, actor_process_image_name, actor_process_command_line, action_registry_key_name, action_registry_value_name, action_registry_data | filter lowercase(action_registry_key_name) contains \"environment\"  | filter lowercase(action_registry_data) contains \"function\" and lowercase(action_registry_data) contains \"invoke-expression\" and lowercase(action_registry_data) contains \"replace\" ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 83, "name": "Unit42_MSIAM_TI_Impact Report Analyzing OBSCURE 3", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1497.001\ndataset = xdr_data | filter event_type = ENUM.PROCESS | fields _time, agent_hostname, actor_effective_username, actor_process_image_name, actor_process_image_path, actor_process_command_line, action_process_image_name, action_process_image_path, action_process_image_command_line, causality_actor_process_image_name, causality_actor_process_image_path, causality_actor_process_command_line  | filter action_process_image_name = \"powershell.exe\" and lowercase(action_process_image_command_line) contains \"get-wmiobject win32_diskdrive\" and lowercase(action_process_image_command_line) contains \"findstr\" and lowercase(action_process_image_command_line) contains \"wds100t2b0a\" ", "is_enabled": true, "description": "This query uses Process event logs to look for OBSCURE#BAT checking the disk drives. This is done to evade detection by a sandbox", "alert_name": "Unit42_MSIAM_TI_Impact Report Analyzing OBSCURE 3", "alert_category": "OTHER", "alert_type": null, "alert_description": "This query uses Process event logs to look for OBSCURE#BAT checking the disk drives. This is done to evade detection by a sandbox", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1497.001\ndataset = xdr_data | filter event_type = ENUM.PROCESS | fields _time, agent_hostname, actor_effective_username, actor_process_image_name, actor_process_image_path, actor_process_command_line, action_process_image_name, action_process_image_path, action_process_image_command_line, causality_actor_process_image_name, causality_actor_process_image_path, causality_actor_process_command_line  | filter action_process_image_name = \"powershell.exe\" and lowercase(action_process_image_command_line) contains \"get-wmiobject win32_diskdrive\" and lowercase(action_process_image_command_line) contains \"findstr\" and lowercase(action_process_image_command_line) contains \"wds100t2b0a\" ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 82, "name": "Unit42_MSIAM_TI_Impact Report Analyzing OBSCURE 2", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1497.001\ndataset = xdr_data | filter event_type = ENUM.EVENT_LOG and action_evtlog_provider_name = \"Microsoft-Windows-PowerShell\" and action_evtlog_event_id = 4103 | fields _time, agent_hostname, actor_effective_username, actor_primary_username, os_actor_primary_username, action_evtlog_event_id, action_evtlog_username, action_evtlog_record_id, actor_process_image_name, actor_process_image_path, causality_actor_process_image_name, causality_actor_process_image_path, os_actor_process_image_name, os_actor_process_image_path, action_evtlog_description, action_evtlog_message | filter lowercase(action_evtlog_message) contains \"get-wmiobject win32_diskdrive\" and lowercase(action_evtlog_message) contains \"findstr\" and lowercase(action_evtlog_message) contains \"wds100t2b0a\" ", "is_enabled": true, "description": "This query uses PowerShell event logs to look for OBSCURE#BAT checking the disk drives. This is done to evade detection by a sandbox", "alert_name": "Unit42_MSIAM_TI_Impact Report Analyzing OBSCURE 2", "alert_category": "OTHER", "alert_type": null, "alert_description": "This query uses PowerShell event logs to look for OBSCURE#BAT checking the disk drives. This is done to evade detection by a sandbox", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1497.001\ndataset = xdr_data | filter event_type = ENUM.EVENT_LOG and action_evtlog_provider_name = \"Microsoft-Windows-PowerShell\" and action_evtlog_event_id = 4103 | fields _time, agent_hostname, actor_effective_username, actor_primary_username, os_actor_primary_username, action_evtlog_event_id, action_evtlog_username, action_evtlog_record_id, actor_process_image_name, actor_process_image_path, causality_actor_process_image_name, causality_actor_process_image_path, os_actor_process_image_name, os_actor_process_image_path, action_evtlog_description, action_evtlog_message | filter lowercase(action_evtlog_message) contains \"get-wmiobject win32_diskdrive\" and lowercase(action_evtlog_message) contains \"findstr\" and lowercase(action_evtlog_message) contains \"wds100t2b0a\" ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 81, "name": "Unit42_MSIAM_TI_Impact Report Analyzing OBSCURE 1", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1566\ndataset = xdr_data | filter event_type = ENUM.REGISTRY  | fields _time, agent_hostname, event_sub_type, actor_primary_username, actor_process_image_name, actor_process_command_line, action_registry_key_name, action_registry_value_name, action_registry_data | filter lowercase(actor_process_image_name) = \"explorer.exe\" and lowercase(action_registry_key_name) contains \"software\\microsoft\\windows\\currentversion\\explorer\\runmru\" | filter lowercase(action_registry_data) contains \"curl.exe\" and lowercase(action_registry_data) contains \".bat\" ", "is_enabled": true, "description": "This query looks for Fake Captcha behaviors initiated by OBSECURE#BAT. Commands executed via the run dialog are recorded in the RunMRU registry key.", "alert_name": "Unit42_MSIAM_TI_Impact Report Analyzing OBSCURE 1", "alert_category": "OTHER", "alert_type": null, "alert_description": "This query looks for Fake Captcha behaviors initiated by OBSECURE#BAT. Commands executed via the run dialog are recorded in the RunMRU registry key.", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1566\ndataset = xdr_data | filter event_type = ENUM.REGISTRY  | fields _time, agent_hostname, event_sub_type, actor_primary_username, actor_process_image_name, actor_process_command_line, action_registry_key_name, action_registry_value_name, action_registry_data | filter lowercase(actor_process_image_name) = \"explorer.exe\" and lowercase(action_registry_key_name) contains \"software\\microsoft\\windows\\currentversion\\explorer\\runmru\" | filter lowercase(action_registry_data) contains \"curl.exe\" and lowercase(action_registry_data) contains \".bat\" ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 80, "name": "Unit42_MSIAM_TI_Impact Report NEPTUNE RAT An advanced Windows RAT with System Destruction Capabilities and Password Exfiltration from 270+ Applications 3", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1486\npreset = xdr_file  | filter action_file_name = \"How to Decrypt My Files.html\" | fields _time, agent_hostname, action_file_name, action_file_path, action_file_sha256, actor_process_image_name, actor_process_image_path, actor_process_command_line, causality_actor_process_image_name, causality_actor_process_image_path, causality_actor_process_command_line  ", "is_enabled": true, "description": "Ransom note dropping", "alert_name": "Unit42_MSIAM_TI_Impact Report NEPTUNE RAT An advanced Windows RAT with System Destruction Capabilities and Password Exfiltration from 270+ Applications 3", "alert_category": "OTHER", "alert_type": null, "alert_description": "Ransom note dropping", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1486\npreset = xdr_file  | filter action_file_name = \"How to Decrypt My Files.html\" | fields _time, agent_hostname, action_file_name, action_file_path, action_file_sha256, actor_process_image_name, actor_process_image_path, actor_process_command_line, causality_actor_process_image_name, causality_actor_process_image_path, causality_actor_process_command_line  ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 79, "name": "Unit42_MSIAM_TI_Impact Report NEPTUNE RAT An advanced Windows RAT with System Destruction Capabilities and Password Exfiltration from 270+ Applications 2", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1588.001\ndataset = xdr_data | filter event_type = ENUM.FILE and event_sub_type in (ENUM.FILE_CREATE_NEW, ENUM.FILE_WRITE) | filter lowercase(action_file_path) contains \"plugins\" | filter lowercase(action_file_name) in (\"ransomeware.dll\", \"clipper.dll\", \"uacbypass.dll\", \"destry.dll\", \"blockerantivirus.dll\", \"chromium.dll\") | alter directory = arrayindex(regextract(action_file_path, \"(.*)\\\\[^\\\\]+\"),0) | fields _time, agent_hostname, actor_effective_username, actor_process_image_path, actor_process_command_line, action_file_name, action_file_path, action_file_sha256, directory | comp values(action_file_name) as DLLs by agent_hostname, directory ", "is_enabled": true, "description": "Malicious DLLs placed in the Plugins folder", "alert_name": "Unit42_MSIAM_TI_Impact Report NEPTUNE RAT An advanced Windows RAT with System Destruction Capabilities and Password Exfiltration from 270+ Applications 2", "alert_category": "OTHER", "alert_type": null, "alert_description": "Malicious DLLs placed in the Plugins folder", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1588.001\ndataset = xdr_data | filter event_type = ENUM.FILE and event_sub_type in (ENUM.FILE_CREATE_NEW, ENUM.FILE_WRITE) | filter lowercase(action_file_path) contains \"plugins\" | filter lowercase(action_file_name) in (\"ransomeware.dll\", \"clipper.dll\", \"uacbypass.dll\", \"destry.dll\", \"blockerantivirus.dll\", \"chromium.dll\") | alter directory = arrayindex(regextract(action_file_path, \"(.*)\\\\[^\\\\]+\"),0) | fields _time, agent_hostname, actor_effective_username, actor_process_image_path, actor_process_command_line, action_file_name, action_file_path, action_file_sha256, directory | comp values(action_file_name) as DLLs by agent_hostname, directory ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 78, "name": "Unit42_MSIAM_TI_Impact Report NEPTUNE RAT An advanced Windows RAT with System Destruction Capabilities and Password Exfiltration from 270+ Applications 1", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: TA0003\nconfig case_sensitive = false  | dataset = xdr_data | filter event_type = ENUM.FILE and event_sub_type = ENUM.FILE_CREATE_NEW | filter action_file_path = \"C:\\Users\\*\\AppData\\Roaming\\*\" | alter file_name = arrayindex(split(action_file_name, \".\"),0) | fields action_file_path, action_file_name, file_name , agent_hostname  | join type=inner (     dataset = xdr_data     | filter event_type = ENUM.REGISTRY     | filter lowercase(action_registry_key_name) = \"*\\software\\microsoft\\windows\\currentversion\\run\" and action_registry_value_name != null and action_registry_data != null     | fields agent_hostname, action_registry_key_name, action_registry_value_name, action_registry_data ) as reg_create agent_hostname = reg_create.agent_hostname and file_name = reg_create.action_registry_value_name and action_file_path = reg_create.action_registry_data | join type = inner ( dataset = xdr_data  | filter event_type = ENUM.RPC_CALL | alter task_author = arrayindex(regextract(action_rpc_func_str_call_fields, \"<Author>(.*)</Author>\"), 0) | alter task_description = arrayindex(regextract(action_rpc_func_str_call_fields, \"<Description>(.*)</Description>\"), 0) | alter task_path = action_rpc_func_str_call_fields -> path | alter task_arguments_parsed = arrayindex(regextract(action_rpc_func_str_call_fields, \"<Arguments>(.*)</Arguments>\"), 0) | alter task_userid_parsed = arrayindex(regextract(action_rpc_func_str_call_fields, \"<UserId>(.*)</UserId>\"), 0) | alter task_RunLevel = arrayindex(regextract(action_rpc_func_str_call_fields, \"<RunLevel>(.*)</RunLevel>\"), 0) | alter task_command = arrayindex(regextract(action_rpc_func_str_call_fields, \"<command>(.*)</command>\"), 0) | alter task_command = replace(task_command, \"\"\"\\\\\\\\\"\"\", \"\"\"\\\\\"\"\") | filter action_rpc_interface_uuid = \"{86D35949-83C9-4044-B424-DB363231FD0C}\" and action_rpc_func_opnum = 1 | filter task_command != \"\" and task_command != null | fields _time, agent_hostname, actor_effective_username,actor_process_image_name, actor_process_command_line,actor_process_instance_id, task_arguments_parsed, task_userid_parsed, task_author, task_description, task_path, action_rpc_func_name, action_rpc_func_opnum, action_rpc_interface_uuid, action_rpc_func_str_call_fields,task_RunLevel,task_command  ) as tasks tasks.agent_hostname = agent_hostname and tasks.task_command = action_file_path and tasks.task_path contains file_name ", "is_enabled": true, "description": "A file being dropped following with a Run registry key and a scheduled task creation with the same name as the file", "alert_name": "Unit42_MSIAM_TI_Impact Report NEPTUNE RAT An advanced Windows RAT with System Destruction Capabilities and Password Exfiltration from 270+ Applications 1", "alert_category": "OTHER", "alert_type": null, "alert_description": "A file being dropped following with a Run registry key and a scheduled task creation with the same name as the file", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: TA0003\nconfig case_sensitive = false  | dataset = xdr_data | filter event_type = ENUM.FILE and event_sub_type = ENUM.FILE_CREATE_NEW | filter action_file_path = \"C:\\Users\\*\\AppData\\Roaming\\*\" | alter file_name = arrayindex(split(action_file_name, \".\"),0) | fields action_file_path, action_file_name, file_name , agent_hostname  | join type=inner (     dataset = xdr_data     | filter event_type = ENUM.REGISTRY     | filter lowercase(action_registry_key_name) = \"*\\software\\microsoft\\windows\\currentversion\\run\" and action_registry_value_name != null and action_registry_data != null     | fields agent_hostname, action_registry_key_name, action_registry_value_name, action_registry_data ) as reg_create agent_hostname = reg_create.agent_hostname and file_name = reg_create.action_registry_value_name and action_file_path = reg_create.action_registry_data | join type = inner ( dataset = xdr_data  | filter event_type = ENUM.RPC_CALL | alter task_author = arrayindex(regextract(action_rpc_func_str_call_fields, \"<Author>(.*)</Author>\"), 0) | alter task_description = arrayindex(regextract(action_rpc_func_str_call_fields, \"<Description>(.*)</Description>\"), 0) | alter task_path = action_rpc_func_str_call_fields -> path | alter task_arguments_parsed = arrayindex(regextract(action_rpc_func_str_call_fields, \"<Arguments>(.*)</Arguments>\"), 0) | alter task_userid_parsed = arrayindex(regextract(action_rpc_func_str_call_fields, \"<UserId>(.*)</UserId>\"), 0) | alter task_RunLevel = arrayindex(regextract(action_rpc_func_str_call_fields, \"<RunLevel>(.*)</RunLevel>\"), 0) | alter task_command = arrayindex(regextract(action_rpc_func_str_call_fields, \"<command>(.*)</command>\"), 0) | alter task_command = replace(task_command, \"\"\"\\\\\\\\\"\"\", \"\"\"\\\\\"\"\") | filter action_rpc_interface_uuid = \"{86D35949-83C9-4044-B424-DB363231FD0C}\" and action_rpc_func_opnum = 1 | filter task_command != \"\" and task_command != null | fields _time, agent_hostname, actor_effective_username,actor_process_image_name, actor_process_command_line,actor_process_instance_id, task_arguments_parsed, task_userid_parsed, task_author, task_description, task_path, action_rpc_func_name, action_rpc_func_opnum, action_rpc_interface_uuid, action_rpc_func_str_call_fields,task_RunLevel,task_command  ) as tasks tasks.agent_hostname = agent_hostname and tasks.task_command = action_file_path and tasks.task_path contains file_name ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 76, "name": "Unit42_MSIAM_TI_Impact Report Mining in Plain Sight The VS Code Extension Cryptojacking Campaign 3", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1574.002\ndataset = xdr_data  | filter event_type = ENUM.LOAD_IMAGE and lowercase(actor_process_image_name) = \"computerdefaults.exe\" and lowercase(action_module_path) ~= \"\\\\mlang\\.dll\" | fields agent_hostname, actor_effective_username, actor_process_image_path, actor_process_image_sha256, action_module_path, action_module_sha256 ", "is_enabled": true, "description": "Query looks for computerdefaults.exe loading a DLL named MLANG.dll (which may be legitimate, so we have to check the location of the exe and the hash of the dll for any hits)", "alert_name": "Unit42_MSIAM_TI_Impact Report Mining in Plain Sight The VS Code Extension Cryptojacking Campaign 3", "alert_category": "OTHER", "alert_type": null, "alert_description": "Query looks for computerdefaults.exe loading a DLL named MLANG.dll (which may be legitimate, so we have to check the location of the exe and the hash of the dll for any hits)", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1574.002\ndataset = xdr_data  | filter event_type = ENUM.LOAD_IMAGE and lowercase(actor_process_image_name) = \"computerdefaults.exe\" and lowercase(action_module_path) ~= \"\\\\mlang\\.dll\" | fields agent_hostname, actor_effective_username, actor_process_image_path, actor_process_image_sha256, action_module_path, action_module_sha256 ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 75, "name": "Unit42_MSIAM_TI_Impact Report Mining in Plain Sight The VS Code Extension Cryptojacking Campaign 2", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1053.005\ndataset = xdr_data | filter event_type = ENUM.EVENT_LOG and action_evtlog_event_id = 4698 | alter schtask_creation_task_name = trim(json_extract(action_evtlog_data_fields, \"$.TaskName\"), \"\\\"\"),         schtask_creation_subject_user_sid = trim(json_extract(action_evtlog_data_fields, \"$.SubjectUserSid\"), \"\\\"\"),         schtask_creation_rpc_client_locality = trim(json_extract(action_evtlog_data_fields, \"$.RpcCallClientLocality\"), \"\\\"\"),         schtask_creation_subject_domain_name = trim(json_extract(action_evtlog_data_fields, \"$.SubjectDomainName\"), \"\\\"\"),         schtask_creation_subject_user_name = trim(json_extract(action_evtlog_data_fields, \"$.SubjectUserName\"), \"\\\"\"),         schtasks_creation_command = regextract(json_extract(action_evtlog_data_fields, \"$.TaskContent\"), \"Command[>](.*)[<][/]Command\"),         schtasks_creation_args = regextract(json_extract(action_evtlog_data_fields, \"$.TaskContent\"), \"Arguments[>](.*)[<][/]Arguments\") | filter lowercase(schtask_creation_task_name) ~= \"onedrivestartup\" | fields agent_hostname, actor_effective_username, action_evtlog*, schtask_*, schtasks_* ", "is_enabled": true, "description": "Query looks for the \"OnedriveStartup\" task, which the campaign uses for persistence", "alert_name": "Unit42_MSIAM_TI_Impact Report Mining in Plain Sight The VS Code Extension Cryptojacking Campaign 2", "alert_category": "OTHER", "alert_type": null, "alert_description": "Query looks for the \"OnedriveStartup\" task, which the campaign uses for persistence", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1053.005\ndataset = xdr_data | filter event_type = ENUM.EVENT_LOG and action_evtlog_event_id = 4698 | alter schtask_creation_task_name = trim(json_extract(action_evtlog_data_fields, \"$.TaskName\"), \"\\\"\"),         schtask_creation_subject_user_sid = trim(json_extract(action_evtlog_data_fields, \"$.SubjectUserSid\"), \"\\\"\"),         schtask_creation_rpc_client_locality = trim(json_extract(action_evtlog_data_fields, \"$.RpcCallClientLocality\"), \"\\\"\"),         schtask_creation_subject_domain_name = trim(json_extract(action_evtlog_data_fields, \"$.SubjectDomainName\"), \"\\\"\"),         schtask_creation_subject_user_name = trim(json_extract(action_evtlog_data_fields, \"$.SubjectUserName\"), \"\\\"\"),         schtasks_creation_command = regextract(json_extract(action_evtlog_data_fields, \"$.TaskContent\"), \"Command[>](.*)[<][/]Command\"),         schtasks_creation_args = regextract(json_extract(action_evtlog_data_fields, \"$.TaskContent\"), \"Arguments[>](.*)[<][/]Arguments\") | filter lowercase(schtask_creation_task_name) ~= \"onedrivestartup\" | fields agent_hostname, actor_effective_username, action_evtlog*, schtask_*, schtasks_* ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 74, "name": "Unit42_MSIAM_TI_Impact Report Mining in Plain Sight The VS Code Extension Cryptojacking Campaign 1", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1112\ndataset = xdr_data  | filter event_type = ENUM.PROCESS and event_sub_type = ENUM.PROCESS_START  | filter action_process_image_name = \"reg.exe\" and action_process_image_command_line ~= \"reg\\s{1,2}add \\\"HKCU\\\\Software\\\\Microsoft\\\" \\/v \\\"Application\\\" \\/t REG_SZ \\/d Yes \\/f\" | fields _time, agent_hostname, action_process_username, action_process_image_name, action_process_image_path, action_process_image_command_line, action_process_image_sha256, action_process_cwd, action_process_file_info, action_process_file_size, action_process_file_web_mark, actor_effective_username, actor_process_image_name, actor_process_image_path, actor_process_image_command_line, actor_process_image_sha256, causality_actor_primary_username, causality_actor_process_image_name, causality_actor_process_image_path, causality_actor_process_command_line, causality_actor_process_image_sha256, os_actor_primary_username, os_actor_process_image_name, os_actor_process_image_path, os_actor_process_image_command_line, os_actor_process_image_sha256  | sort desc _time ", "is_enabled": true, "description": "Query looks for reg.exe being used to add the kill switch the XMRig campaign uses", "alert_name": "Unit42_MSIAM_TI_Impact Report Mining in Plain Sight The VS Code Extension Cryptojacking Campaign 1", "alert_category": "OTHER", "alert_type": null, "alert_description": "Query looks for reg.exe being used to add the kill switch the XMRig campaign uses", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1112\ndataset = xdr_data  | filter event_type = ENUM.PROCESS and event_sub_type = ENUM.PROCESS_START  | filter action_process_image_name = \"reg.exe\" and action_process_image_command_line ~= \"reg\\s{1,2}add \\\"HKCU\\\\Software\\\\Microsoft\\\" \\/v \\\"Application\\\" \\/t REG_SZ \\/d Yes \\/f\" | fields _time, agent_hostname, action_process_username, action_process_image_name, action_process_image_path, action_process_image_command_line, action_process_image_sha256, action_process_cwd, action_process_file_info, action_process_file_size, action_process_file_web_mark, actor_effective_username, actor_process_image_name, actor_process_image_path, actor_process_image_command_line, actor_process_image_sha256, causality_actor_primary_username, causality_actor_process_image_name, causality_actor_process_image_path, causality_actor_process_command_line, causality_actor_process_image_sha256, os_actor_primary_username, os_actor_process_image_name, os_actor_process_image_path, os_actor_process_image_command_line, os_actor_process_image_sha256  | sort desc _time ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 73, "name": "Unit42_MSIAM_TI_Impact Report Exploitation of CLFS Zero-Day Leads to Ransomware Activity \u2013 Microsoft Security Blog 3", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1055.002,T1003.001\nconfig case_sensitive = false | preset=xdr_process | filter action_process_image_name = \"dllhost.exe\" and action_process_image_command_line  contains \" -accepteula \" ", "is_enabled": true, "description": "Commandline of dllhost processes with procdump injected into it in a Microsoft observed campaign featured procdump commandlines including -accepteula standard of sysinternals tools.", "alert_name": "Unit42_MSIAM_TI_Impact Report Exploitation of CLFS Zero-Day Leads to Ransomware Activity \u2013 Microsoft Security Blog 3", "alert_category": "OTHER", "alert_type": null, "alert_description": "Commandline of dllhost processes with procdump injected into it in a Microsoft observed campaign featured procdump commandlines including -accepteula standard of sysinternals tools.", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1055.002,T1003.001\nconfig case_sensitive = false | preset=xdr_process | filter action_process_image_name = \"dllhost.exe\" and action_process_image_command_line  contains \" -accepteula \" ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 72, "name": "Unit42_MSIAM_TI_Impact Report Exploitation of CLFS Zero-Day Leads to Ransomware Activity \u2013 Microsoft Security Blog 2", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1055.002,T1486\nconfig case_sensitive = false | preset=xdr_process | filter action_process_image_name = \"dllhost.exe\" and action_process_image_command_line  contains \" -do \" ", "is_enabled": true, "description": "Commandline of dllhost processes injected into with ransomware binaries in a Microsoft observed campaign featured a -do argument", "alert_name": "Unit42_MSIAM_TI_Impact Report Exploitation of CLFS Zero-Day Leads to Ransomware Activity \u2013 Microsoft Security Blog 2", "alert_category": "OTHER", "alert_type": null, "alert_description": "Commandline of dllhost processes injected into with ransomware binaries in a Microsoft observed campaign featured a -do argument", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1055.002,T1486\nconfig case_sensitive = false | preset=xdr_process | filter action_process_image_name = \"dllhost.exe\" and action_process_image_command_line  contains \" -do \" ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 71, "name": "Unit42_MSIAM_TI_Impact Report Exploitation of CLFS Zero-Day Leads to Ransomware Activity \u2013 Microsoft Security Blog 1", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1068\nconfig case_sensitive = false | preset=xdr_file | filter action_file_path = \"C:\\ProgramData\\SkyPDF\\PDUDrv.blf\"  ", "is_enabled": true, "description": ".blf file generated by exploitation of CLFS vulnerability CVE-2025-29814 in Microsoft observed ransomware campaign", "alert_name": "Unit42_MSIAM_TI_Impact Report Exploitation of CLFS Zero-Day Leads to Ransomware Activity \u2013 Microsoft Security Blog 1", "alert_category": "OTHER", "alert_type": null, "alert_description": ".blf file generated by exploitation of CLFS vulnerability CVE-2025-29814 in Microsoft observed ransomware campaign", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1068\nconfig case_sensitive = false | preset=xdr_file | filter action_file_path = \"C:\\ProgramData\\SkyPDF\\PDUDrv.blf\"  ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 70, "name": "Unit42_MSIAM_TI_Impact Report Fake Zoom Ends in BlackSuit Ransomware 3", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1105\ndataset = xdr_data | filter event_type in (ENUM.NETWORK,ENUM.STORY) | filter actor_process_image_name = \"msbuild.exe\" | filter dns_query_name = \"*pastebin.com*\" OR action_external_hostname = \"*pastebin.com*\" OR dst_action_external_hostname = \"*pastebin.com*\" | fields _time, agent_hostname, actor_process_command_line, causality_actor_process_command_line, action_local_ip, action_remote_ip, action_remote_port, dns_query_name, action_external_hostname, dst_action_external_hostname,action_network_dpi_fields ", "is_enabled": true, "description": "This query monitors for instances where msbuild.exe initiates network connections to domains like \"pastebin.com.\" Such behavior is suspicious as msbuild.exe is a legitimate Microsoft tool that can be exploited to execute malicious code downloaded from external sources like Pastebin.", "alert_name": "Unit42_MSIAM_TI_Impact Report Fake Zoom Ends in BlackSuit Ransomware 3", "alert_category": "OTHER", "alert_type": null, "alert_description": "This query monitors for instances where msbuild.exe initiates network connections to domains like \"pastebin.com.\" Such behavior is suspicious as msbuild.exe is a legitimate Microsoft tool that can be exploited to execute malicious code downloaded from external sources like Pastebin.", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1105\ndataset = xdr_data | filter event_type in (ENUM.NETWORK,ENUM.STORY) | filter actor_process_image_name = \"msbuild.exe\" | filter dns_query_name = \"*pastebin.com*\" OR action_external_hostname = \"*pastebin.com*\" OR dst_action_external_hostname = \"*pastebin.com*\" | fields _time, agent_hostname, actor_process_command_line, causality_actor_process_command_line, action_local_ip, action_remote_ip, action_remote_port, dns_query_name, action_external_hostname, dst_action_external_hostname,action_network_dpi_fields ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 69, "name": "Unit42_MSIAM_TI_Impact Report Fake Zoom Ends in BlackSuit Ransomware 2", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1564.001\nconfig case_sensitive = false | dataset = xdr_data  | filter event_type = ENUM.PROCESS and event_sub_type = ENUM.PROCESS_START | filter actor_process_image_name = \"cmd.exe\" | filter action_process_image_command_line = \"*attrib*+s*+h*/D*C:\\Program Files\\Windows NT*\" | fields _time, agent_hostname,actor_effective_username, action_process_image_path, action_process_image_command_line, action_process_image_sha256, actor_process_image_path, actor_process_command_line,causality_actor_process_image_path, causality_actor_process_command_line ", "is_enabled": true, "description": "This query detects instances where cmd.exe is used to execute the attrib command with parameters that set files or directories to hidden and system attributes within the \"C:\\P\u200brogram Files\\W\u200bindows NT\" directory. Such actions may indicate attempts to conceal malicious files or activities.", "alert_name": "Unit42_MSIAM_TI_Impact Report Fake Zoom Ends in BlackSuit Ransomware 2", "alert_category": "OTHER", "alert_type": null, "alert_description": "This query detects instances where cmd.exe is used to execute the attrib command with parameters that set files or directories to hidden and system attributes within the \"C:\\P\u200brogram Files\\W\u200bindows NT\" directory. Such actions may indicate attempts to conceal malicious files or activities.", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1564.001\nconfig case_sensitive = false | dataset = xdr_data  | filter event_type = ENUM.PROCESS and event_sub_type = ENUM.PROCESS_START | filter actor_process_image_name = \"cmd.exe\" | filter action_process_image_command_line = \"*attrib*+s*+h*/D*C:\\Program Files\\Windows NT*\" | fields _time, agent_hostname,actor_effective_username, action_process_image_path, action_process_image_command_line, action_process_image_sha256, actor_process_image_path, actor_process_command_line,causality_actor_process_image_path, causality_actor_process_command_line ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 68, "name": "Unit42_MSIAM_TI_Impact Report Fake Zoom Ends in BlackSuit Ransomware 1", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1204.002\nconfig case_sensitive = false | dataset = xdr_data | filter event_type = ENUM.PROCESS | filter action_process_image_path contains \"zoom\"  | alter product_name = action_process_file_info -> product_name | filter product_name contains \"Little further\"  | fields _time, agent_hostname, actor_effective_username, actor_process_image_name, actor_process_command_line, action_process_image_name, action_process_image_command_line, action_process_signature_vendor, action_process_signature_product, action_process_file_info, action_process_image_path, product_name, action_process_file_info ", "is_enabled": true, "description": "This query identifies processes where the image path contains \"zoom\" and the product name includes \"Little further,\" indicating potential malicious Zoom installers. It focuses on processes that may masquerade as legitimate Zoom applications to deliver malware.", "alert_name": "Unit42_MSIAM_TI_Impact Report Fake Zoom Ends in BlackSuit Ransomware 1", "alert_category": "OTHER", "alert_type": null, "alert_description": "This query identifies processes where the image path contains \"zoom\" and the product name includes \"Little further,\" indicating potential malicious Zoom installers. It focuses on processes that may masquerade as legitimate Zoom applications to deliver malware.", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1204.002\nconfig case_sensitive = false | dataset = xdr_data | filter event_type = ENUM.PROCESS | filter action_process_image_path contains \"zoom\"  | alter product_name = action_process_file_info -> product_name | filter product_name contains \"Little further\"  | fields _time, agent_hostname, actor_effective_username, actor_process_image_name, actor_process_command_line, action_process_image_name, action_process_image_command_line, action_process_signature_vendor, action_process_signature_product, action_process_file_info, action_process_image_path, product_name, action_process_file_info ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 67, "name": "Unit42_MSIAM_TI_Impact Report:The Espionage Toolkit of Earth Alux 3", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1574.001\nconfig case_sensitive = false | preset=xdr_image_load  | filter actor_process_image_name  =\"fontdrvhost.exe\" and action_module_path  contains \"userenv.dll\" ", "is_enabled": true, "description": "Earth Alux deploys VARGEIT using a renamed esfui to sideload malicious userenv", "alert_name": "Unit42_MSIAM_TI_Impact Report:The Espionage Toolkit of Earth Alux 3", "alert_category": "OTHER", "alert_type": null, "alert_description": "Earth Alux deploys VARGEIT using a renamed esfui to sideload malicious userenv", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1574.001\nconfig case_sensitive = false | preset=xdr_image_load  | filter actor_process_image_name  =\"fontdrvhost.exe\" and action_module_path  contains \"userenv.dll\" ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 66, "name": "Unit42_MSIAM_TI_Impact Report:The Espionage Toolkit of Earth Alux 2", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1127\nconfig case_sensitive = false | preset=xdr_process | filter action_process_image_name =\"fontdrvhost.exe\" and action_process_image_command_line contains \"-cf c:\\programdata\\config.ini\" ", "is_enabled": true, "description": "Earth Alux deploys VARGEIT using a renamed cdb.exe", "alert_name": "Unit42_MSIAM_TI_Impact Report:The Espionage Toolkit of Earth Alux 2", "alert_category": "OTHER", "alert_type": null, "alert_description": "Earth Alux deploys VARGEIT using a renamed cdb.exe", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1127\nconfig case_sensitive = false | preset=xdr_process | filter action_process_image_name =\"fontdrvhost.exe\" and action_process_image_command_line contains \"-cf c:\\programdata\\config.ini\" ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 65, "name": "Unit42_MSIAM_TI_Impact Report:The Espionage Toolkit of Earth Alux 1", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1505.003, T1190\nconfig case_sensitive = false | dataset = xdr_data  | fields _time, agent_hostname, actor_process_image_name, event_type, event_sub_type, dynamic_event_string_map, actor_process_image_command_line, agent_os_type, event_id | filter event_type = ENUM.DOT_NET and event_sub_type = ENUM.DOT_NET_ASPX_EVENT and agent_os_type = ENUM.AGENT_OS_WINDOWS  | alter dotnet_callstack = json_extract(dynamic_event_string_map, \"$.1\") | alter hook_type = json_extract(dynamic_event_string_map, \"$.25\") | alter uri_path = json_extract(dynamic_event_string_map, \"$.26\") | alter user_host_address = json_extract(dynamic_event_string_map, \"$.27\") | alter aspx_path = json_extract(dynamic_event_string_map, \"$.28\") | alter loaded_assembly_name = json_extract(dynamic_event_string_map, \"$.29\") | alter http_headers = json_extract(dynamic_event_string_map, \"$.32\") | alter http_body_params = json_extract(dynamic_event_string_map, \"$.33\") | filter loaded_assembly_name contains \"payload\" ", "is_enabled": true, "description": "Earth Alux and other threat actors often deploy the GodZilla module with internal name 'payload' to gain an initial foothold.", "alert_name": "Unit42_MSIAM_TI_Impact Report:The Espionage Toolkit of Earth Alux 1", "alert_category": "OTHER", "alert_type": null, "alert_description": "Earth Alux and other threat actors often deploy the GodZilla module with internal name 'payload' to gain an initial foothold.", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1505.003, T1190\nconfig case_sensitive = false | dataset = xdr_data  | fields _time, agent_hostname, actor_process_image_name, event_type, event_sub_type, dynamic_event_string_map, actor_process_image_command_line, agent_os_type, event_id | filter event_type = ENUM.DOT_NET and event_sub_type = ENUM.DOT_NET_ASPX_EVENT and agent_os_type = ENUM.AGENT_OS_WINDOWS  | alter dotnet_callstack = json_extract(dynamic_event_string_map, \"$.1\") | alter hook_type = json_extract(dynamic_event_string_map, \"$.25\") | alter uri_path = json_extract(dynamic_event_string_map, \"$.26\") | alter user_host_address = json_extract(dynamic_event_string_map, \"$.27\") | alter aspx_path = json_extract(dynamic_event_string_map, \"$.28\") | alter loaded_assembly_name = json_extract(dynamic_event_string_map, \"$.29\") | alter http_headers = json_extract(dynamic_event_string_map, \"$.32\") | alter http_body_params = json_extract(dynamic_event_string_map, \"$.33\") | filter loaded_assembly_name contains \"payload\" ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 64, "name": "Unit42_MSIAM_TI_Impact Report: Konni RATs Advanced Stealth and Persistence Techniques 2", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1059.005\nconfig case_sensitive = false | preset=xdr_file  | filter event_sub_type IN (ENUM.FILE_WRITE , ENUM.FILE_CREATE_NEW ) and action_file_path = \"C:\\Users\\Public\\Documents\\start.vbs\" ", "is_enabled": true, "description": "Konni rat writes start.vbs into a public documents file and is used as the main script for persistence", "alert_name": "Unit42_MSIAM_TI_Impact Report: Konni RATs Advanced Stealth and Persistence Techniques 2", "alert_category": "OTHER", "alert_type": null, "alert_description": "Konni rat writes start.vbs into a public documents file and is used as the main script for persistence", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1059.005\nconfig case_sensitive = false | preset=xdr_file  | filter event_sub_type IN (ENUM.FILE_WRITE , ENUM.FILE_CREATE_NEW ) and action_file_path = \"C:\\Users\\Public\\Documents\\start.vbs\" ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 63, "name": "Unit42_MSIAM_TI_Impact Report: Konni RATs Advanced Stealth and Persistence Techniques 1", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1592.002\nconfig case_sensitive = false | preset=xdr_process   | filter event_sub_type IN (ENUM.PROCESS_START) and action_process_image_name = \"cmd.exe\" and action_process_image_command_line contains \"findstr /i rshell.exe\" ", "is_enabled": true, "description": "Konni rat identifies powershell paths by searching for rshell.exe ", "alert_name": "Unit42_MSIAM_TI_Impact Report: Konni RATs Advanced Stealth and Persistence Techniques 1", "alert_category": "OTHER", "alert_type": null, "alert_description": "Konni rat identifies powershell paths by searching for rshell.exe ", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1592.002\nconfig case_sensitive = false | preset=xdr_process   | filter event_sub_type IN (ENUM.PROCESS_START) and action_process_image_name = \"cmd.exe\" and action_process_image_command_line contains \"findstr /i rshell.exe\" ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 62, "name": "Unit42_MSIAM_TI_Impact Report Qilin affiliates spear-phish MSP ScreenConnect admin, targeting customers downstream 3", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1203\nconfig case_sensitive = false | preset = xdr_file    | filter event_sub_type IN (ENUM.FILE_CREATE_NEW , ENUM.FILE_WRITE ) and action_file_path = \"C:\\programdata\\veeam.exe\" | fields _time, agent_hostname , event_id , event_type , event_sub_type , actor_process_image_name , actor_process_command_line, action_file_name , action_file_path , action_file_sha256 , action_file_previous_file_name  ,  actor_effective_username  ", "is_enabled": true, "description": "Deploy an exploit for CVE-2023-27532 as a new file", "alert_name": "Unit42_MSIAM_TI_Impact Report Qilin affiliates spear-phish MSP ScreenConnect admin, targeting customers downstream 3", "alert_category": "OTHER", "alert_type": null, "alert_description": "Deploy an exploit for CVE-2023-27532 as a new file", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1203\nconfig case_sensitive = false | preset = xdr_file    | filter event_sub_type IN (ENUM.FILE_CREATE_NEW , ENUM.FILE_WRITE ) and action_file_path = \"C:\\programdata\\veeam.exe\" | fields _time, agent_hostname , event_id , event_type , event_sub_type , actor_process_image_name , actor_process_command_line, action_file_name , action_file_path , action_file_sha256 , action_file_previous_file_name  ,  actor_effective_username  ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 61, "name": "Unit42_MSIAM_TI_Impact Report Qilin affiliates spear-phish MSP ScreenConnect admin, targeting customers downstream 2", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1567.002\nconfig case_sensitive = false | preset = network_story   | filter actor_process_image_name  = \"chrome.exe\" and dst_action_external_hostname = \"easyupload.io\" and (actor_process_command_line IN (\"*--incognito*\",\"*in private*\") or causality_actor_process_command_line  IN (\"*--incognito*\",\"*in private*\")) | fields _time, agent_hostname , event_id , event_type , event_sub_type , causality_actor_process_command_line, actor_process_command_line, actor_process_image_name , dst_action_external_hostname , action_remote_ip ,  actor_effective_username  ", "is_enabled": true, "description": "Threat actor has used incognito/private chrome mode to access easyupload.io", "alert_name": "Unit42_MSIAM_TI_Impact Report Qilin affiliates spear-phish MSP ScreenConnect admin, targeting customers downstream 2", "alert_category": "OTHER", "alert_type": null, "alert_description": "Threat actor has used incognito/private chrome mode to access easyupload.io", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1567.002\nconfig case_sensitive = false | preset = network_story   | filter actor_process_image_name  = \"chrome.exe\" and dst_action_external_hostname = \"easyupload.io\" and (actor_process_command_line IN (\"*--incognito*\",\"*in private*\") or causality_actor_process_command_line  IN (\"*--incognito*\",\"*in private*\")) | fields _time, agent_hostname , event_id , event_type , event_sub_type , causality_actor_process_command_line, actor_process_command_line, actor_process_image_name , dst_action_external_hostname , action_remote_ip ,  actor_effective_username  ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 60, "name": "Unit42_MSIAM_TI_Impact Report Qilin affiliates spear-phish MSP ScreenConnect admin, targeting customers downstream 1", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1072,T1219\nconfig case_sensitive = false | preset = xdr_process  | filter action_process_image_name = \"msiexec.exe\" and action_process_image_command_line contains \"ScreenConnect\" and action_process_image_command_line contains \"\\ru.msi\" | fields _time, agent_hostname , event_id , event_type , event_sub_type , action_process_image_name , action_process_image_command_line, actor_effective_username  ", "is_enabled": true, "description": "Once ScreenConnect management consoles were compromised threat actors have deployed their own backup screenconnect instance as ru.msi", "alert_name": "Unit42_MSIAM_TI_Impact Report Qilin affiliates spear-phish MSP ScreenConnect admin, targeting customers downstream 1", "alert_category": "OTHER", "alert_type": null, "alert_description": "Once ScreenConnect management consoles were compromised threat actors have deployed their own backup screenconnect instance as ru.msi", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1072,T1219\nconfig case_sensitive = false | preset = xdr_process  | filter action_process_image_name = \"msiexec.exe\" and action_process_image_command_line contains \"ScreenConnect\" and action_process_image_command_line contains \"\\ru.msi\" | fields _time, agent_hostname , event_id , event_type , event_sub_type , action_process_image_name , action_process_image_command_line, actor_effective_username  ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 59, "name": "Unit42_MSIAM_TI_Impact Report You will always remember this as the day you finally caught FamousSparrow 4", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1003.002\nconfig case_sensitive = false \n| dataset = xdr_data \n| filter event_type = ENUM.FILE and (event_sub_type in(ENUM.FILE_CREATE_NEW,ENUM.FILE_WRITE))\n| filter actor_process_image_name contains \"reg.exe\"\n| filter action_file_path = \"C:\\users\\public\\*.hiv\" \n| fields _time, agent_hostname, event_type, event_sub_type, actor_effective_username, action_file_path,action_file_type, action_file_extension, action_file_sha256, actor_process_image_path, actor_process_image_sha256, causality_actor_process_image_path,actor_process_instance_id \n", "is_enabled": true, "description": "During the compromise, the threat actor dumps the registry hives that related to credentials and system security.", "alert_name": "Unit42_MSIAM_TI_Impact Report You will always remember this as the day you finally caught FamousSparrow 4", "alert_category": "OTHER", "alert_type": null, "alert_description": "During the compromise, the threat actor dumps the registry hives that related to credentials and system security.", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1003.002\nconfig case_sensitive = false \n| dataset = xdr_data \n| filter event_type = ENUM.FILE and (event_sub_type in(ENUM.FILE_CREATE_NEW,ENUM.FILE_WRITE))\n| filter actor_process_image_name contains \"reg.exe\"\n| filter action_file_path = \"C:\\users\\public\\*.hiv\" \n| fields _time, agent_hostname, event_type, event_sub_type, actor_effective_username, action_file_path,action_file_type, action_file_extension, action_file_sha256, actor_process_image_path, actor_process_image_sha256, causality_actor_process_image_path,actor_process_instance_id \n", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 58, "name": "Unit42_MSIAM_TI_Impact Report You will always remember this as the day you finally caught FamousSparrow 3", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1574.002\nconfig case_sensitive = false\n| dataset = xdr_data\n| fields _time, agent_hostname, actor_process_image_name, actor_process_image_path, action_module_path, action_module_signature_vendor, action_module_sha256, event_type, agent_os_type\n| filter event_type = ENUM.LOAD_IMAGE and agent_os_type = ENUM.AGENT_OS_WINDOWS\n| filter actor_process_image_name in (\"imecmnt.exe\",\"imjp14k.exe\")\n| alter exe_path = arrayindex(regextract(actor_process_image_path, \"^(.*\\\\)[^\\\\]+$\"), 0)\n| filter action_module_path contains exe_path\n| fields _time, agent_hostname, actor_process_image_path, action_module_path, action_module_signature_vendor, action_module_sha256 ", "is_enabled": true, "description": "The threat actor execute the malicious loader via DLL side-loading by the more-than-14-year-old, legitimate, outdated version of the Microsoft Office IME executable", "alert_name": "Unit42_MSIAM_TI_Impact Report You will always remember this as the day you finally caught FamousSparrow 3", "alert_category": "OTHER", "alert_type": null, "alert_description": "The threat actor execute the malicious loader via DLL side-loading by the more-than-14-year-old, legitimate, outdated version of the Microsoft Office IME executable", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1574.002\nconfig case_sensitive = false\n| dataset = xdr_data\n| fields _time, agent_hostname, actor_process_image_name, actor_process_image_path, action_module_path, action_module_signature_vendor, action_module_sha256, event_type, agent_os_type\n| filter event_type = ENUM.LOAD_IMAGE and agent_os_type = ENUM.AGENT_OS_WINDOWS\n| filter actor_process_image_name in (\"imecmnt.exe\",\"imjp14k.exe\")\n| alter exe_path = arrayindex(regextract(actor_process_image_path, \"^(.*\\\\)[^\\\\]+$\"), 0)\n| filter action_module_path contains exe_path\n| fields _time, agent_hostname, actor_process_image_path, action_module_path, action_module_signature_vendor, action_module_sha256 ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 57, "name": "Unit42_MSIAM_TI_Impact Report You will always remember this as the day you finally caught FamousSparrow 2", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1543.003\nconfig case_sensitive = false\n| dataset = xdr_data \n| filter event_type = ENUM.EVENT_LOG and action_evtlog_event_id = 7045\n| alter \n    Service_Name = arrayindex(regextract(action_evtlog_message, \"Service Name:  (.*)\\r\\nService\"),0),\n    Service_Path = arrayindex(regextract(action_evtlog_message, \"Service File Name:  (.*)\\r\\nService\"),0),\n    Service_Type = arrayindex(regextract(action_evtlog_message, \"Service Type:  (.*)\\r\\nService\"),0),\n    Start_Type = arrayindex(regextract(action_evtlog_message, \"Service Start Type:  (.*)\\r\\nService\"),0),\n    Account_Name = arrayindex(regextract(action_evtlog_message, \"Service Account:  (.*)\"),0)\n| filter Service_Name in (\"K7Soft\")\n| fields _time, agent_hostname, event_id, action_evtlog_description, Service_Name, Service_Path, Service_Type, Start_Type, Account_Name, action_evtlog_message ", "is_enabled": true, "description": "The threat actor create service on the infected machine that is set to run automatically on startup.", "alert_name": "Unit42_MSIAM_TI_Impact Report You will always remember this as the day you finally caught FamousSparrow 2", "alert_category": "OTHER", "alert_type": null, "alert_description": "The threat actor create service on the infected machine that is set to run automatically on startup.", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1543.003\nconfig case_sensitive = false\n| dataset = xdr_data \n| filter event_type = ENUM.EVENT_LOG and action_evtlog_event_id = 7045\n| alter \n    Service_Name = arrayindex(regextract(action_evtlog_message, \"Service Name:  (.*)\\r\\nService\"),0),\n    Service_Path = arrayindex(regextract(action_evtlog_message, \"Service File Name:  (.*)\\r\\nService\"),0),\n    Service_Type = arrayindex(regextract(action_evtlog_message, \"Service Type:  (.*)\\r\\nService\"),0),\n    Start_Type = arrayindex(regextract(action_evtlog_message, \"Service Start Type:  (.*)\\r\\nService\"),0),\n    Account_Name = arrayindex(regextract(action_evtlog_message, \"Service Account:  (.*)\"),0)\n| filter Service_Name in (\"K7Soft\")\n| fields _time, agent_hostname, event_id, action_evtlog_description, Service_Name, Service_Path, Service_Type, Start_Type, Account_Name, action_evtlog_message ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 56, "name": "Unit42_MSIAM_TI_Impact Report You will always remember this as the day you finally caught FamousSparrow 1", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1140 \nconfig case_sensitive = false\n| dataset = xdr_data \n| filter event_type = ENUM.FILE and (event_sub_type in(ENUM.FILE_OPEN))\n| filter actor_process_image_name contains \"certutil.exe\"\n| filter action_file_extension contains \"txt\"\n| fields _time, agent_hostname, event_type, event_sub_type, actor_effective_username, action_file_path,action_file_type, action_file_extension, action_file_sha256, actor_process_image_path, actor_process_image_sha256, causality_actor_process_image_path,actor_process_instance_id \n| join type = inner  conflict_strategy = both (\ndataset = xdr_data \n| filter event_type = ENUM.FILE and (event_sub_type in(ENUM.FILE_CREATE_NEW,ENUM.FILE_WRITE))\n| filter actor_process_image_name contains \"certutil.exe\"\n| filter action_file_extension contains \"ashx\"\n| fields _time, agent_hostname, event_type, event_sub_type, actor_effective_username, action_file_path,action_file_type, action_file_extension, action_file_sha256, actor_process_image_path, actor_process_image_sha256, causality_actor_process_image_path,actor_process_instance_id ) as decode_file decode_file.actor_process_instance_id = actor_process_instance_id", "is_enabled": true, "description": "The threat actor utilize the certutil for decoding the webshell content.", "alert_name": "Unit42_MSIAM_TI_Impact Report You will always remember this as the day you finally caught FamousSparrow 1", "alert_category": "OTHER", "alert_type": null, "alert_description": "The threat actor utilize the certutil for decoding the webshell content.", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1140 \nconfig case_sensitive = false\n| dataset = xdr_data \n| filter event_type = ENUM.FILE and (event_sub_type in(ENUM.FILE_OPEN))\n| filter actor_process_image_name contains \"certutil.exe\"\n| filter action_file_extension contains \"txt\"\n| fields _time, agent_hostname, event_type, event_sub_type, actor_effective_username, action_file_path,action_file_type, action_file_extension, action_file_sha256, actor_process_image_path, actor_process_image_sha256, causality_actor_process_image_path,actor_process_instance_id \n| join type = inner  conflict_strategy = both (\ndataset = xdr_data \n| filter event_type = ENUM.FILE and (event_sub_type in(ENUM.FILE_CREATE_NEW,ENUM.FILE_WRITE))\n| filter actor_process_image_name contains \"certutil.exe\"\n| filter action_file_extension contains \"ashx\"\n| fields _time, agent_hostname, event_type, event_sub_type, actor_effective_username, action_file_path,action_file_type, action_file_extension, action_file_sha256, actor_process_image_path, actor_process_image_sha256, causality_actor_process_image_path,actor_process_instance_id ) as decode_file decode_file.actor_process_instance_id = actor_process_instance_id", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 55, "name": "Unit42_MSIAM_TI_Impact Report CoffeeLoader: A Brew of Stealthy Techniques 2", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1218\nconfig case_sensitive = false | dataset = xdr_data | fields _time, agent_hostname, actor_process_image_name, actor_process_command_line, event_type, agent_os_type | filter event_type = ENUM.PROCESS and agent_os_type = ENUM.AGENT_OS_WINDOWS | filter (actor_process_image_name = \"rundll32.exe\" and actor_process_command_line contains \"Post_EntrypointReturn\") or (actor_process_image_name = \"schtasks.exe\" and actor_process_command_line contains \"ArmouryAIOSDK.dll\") ", "is_enabled": true, "description": "Query to detect the CoffeeLoader dropper based on execution via rundll32 and scheduled task creation", "alert_name": "Unit42_MSIAM_TI_Impact Report CoffeeLoader: A Brew of Stealthy Techniques 2", "alert_category": "OTHER", "alert_type": null, "alert_description": "Query to detect the CoffeeLoader dropper based on execution via rundll32 and scheduled task creation", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1218\nconfig case_sensitive = false | dataset = xdr_data | fields _time, agent_hostname, actor_process_image_name, actor_process_command_line, event_type, agent_os_type | filter event_type = ENUM.PROCESS and agent_os_type = ENUM.AGENT_OS_WINDOWS | filter (actor_process_image_name = \"rundll32.exe\" and actor_process_command_line contains \"Post_EntrypointReturn\") or (actor_process_image_name = \"schtasks.exe\" and actor_process_command_line contains \"ArmouryAIOSDK.dll\") ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 54, "name": "Unit42_MSIAM_TI_Impact Report CoffeeLoader: A Brew of Stealthy Techniques 1", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1027\nconfig case_sensitive = false  | dataset = xdr_data  | fields _time, agent_hostname, actor_process_image_name, actor_process_signature_status, actor_process_command_line, actor_process_image_sha256, action_module_path, action_module_sha256, event_type, agent_os_type | filter event_type = ENUM.LOAD_IMAGE and agent_os_type = ENUM.AGENT_OS_WINDOWS  | filter action_module_path in (\"*\\ArmouryAIOSDK.dll\", \"*\\ArmouryA.dll\") | filter (actor_process_image_name != \"asus_framework.exe\" and actor_process_signature_status != ENUM.SIGNED) ", "is_enabled": true, "description": "Query to detect Armoury malware packer  by DLL loads", "alert_name": "Unit42_MSIAM_TI_Impact Report CoffeeLoader: A Brew of Stealthy Techniques 1", "alert_category": "OTHER", "alert_type": null, "alert_description": "Query to detect Armoury malware packer  by DLL loads", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1027\nconfig case_sensitive = false  | dataset = xdr_data  | fields _time, agent_hostname, actor_process_image_name, actor_process_signature_status, actor_process_command_line, actor_process_image_sha256, action_module_path, action_module_sha256, event_type, agent_os_type | filter event_type = ENUM.LOAD_IMAGE and agent_os_type = ENUM.AGENT_OS_WINDOWS  | filter action_module_path in (\"*\\ArmouryAIOSDK.dll\", \"*\\ArmouryA.dll\") | filter (actor_process_image_name != \"asus_framework.exe\" and actor_process_signature_status != ENUM.SIGNED) ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 53, "name": "Unit42_MSIAM_TI_Impact Report CVE-2025-26633: How Water Gamayun Weaponizes MUIPath using MSC EvilTwin 3", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1218.014\nconfig case_sensitive = false | dataset = xdr_data  | filter event_type = ENUM.PROCESS  and event_sub_type = ENUM.PROCESS_START  | filter actor_process_image_name = \"mmc.exe\" and action_process_image_name = \"powershell.exe\" and action_process_image_command_line contains \"-WindowStyle Hidden\"  | alter cgo_msc_path = arrayindex(regextract(causality_actor_process_command_line, \"C:\\\\Windows\\\\system32\\\\mmc.exe.*?(\\w.*.msc)\"),0) | alter actor_msc_path = arrayindex(regextract(actor_process_command_line, \"C:\\\\Windows\\\\system32\\\\mmc.exe.*?(\\w.*.msc)\"),0) | filter actor_msc_path not in (null, \"C:\\windows\\system32\\*\", \"C:\\Program Files\\Microsoft Deployment Toolkit\\*\", \"C:\\Program Files\\Citrix\\*\")  | fields _time, agent_hostname, causality_actor_process_command_line, cgo_msc_path, actor_process_image_name, actor_process_command_line, action_process_image_name, action_process_image_command_line  | comp count_distinct(agent_hostname) as observed_on_X_hosts, values(agent_hostname) as values_hostname, values(actor_process_command_line) as actor_cli, values(actor_process_image_name) as actor_image_name, values(action_process_image_name) as action_image_name, values(action_process_image_command_line) as action_cli by action_process_image_name, action_process_image_command_line  | sort asc observed_on_X_hosts   | join (     dataset = endpoints      | filter endpoint_status in (ENUM.CONNECTED, ENUM.DISCONNECTED)     | comp count_distinct(endpoint_id) as active_xdr_agent_count ) as agent_count \"true\" = \"true\"  | alter percent_of_total_agent_count = divide(observed_on_X_hosts, active_xdr_agent_count) | filter percent_of_total_agent_count <= 0.01 | fields - active_xdr_agent_count  | alter percent_of_total_agent_count = format_string(\"%.2f\", multiply(percent_of_total_agent_count, 100))  | fields values_hostname, actor_cli, action_cli, observed_on_X_hosts, percent_of_total_agent_count ", "is_enabled": true, "description": "Query looks for rare child processes and command lines", "alert_name": "Unit42_MSIAM_TI_Impact Report CVE-2025-26633: How Water Gamayun Weaponizes MUIPath using MSC EvilTwin 3", "alert_category": "OTHER", "alert_type": null, "alert_description": "Query looks for rare child processes and command lines", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": false, "suppression_duration": null, "suppression_fields": null, "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1218.014\nconfig case_sensitive = false | dataset = xdr_data  | filter event_type = ENUM.PROCESS  and event_sub_type = ENUM.PROCESS_START  | filter actor_process_image_name = \"mmc.exe\" and action_process_image_name = \"powershell.exe\" and action_process_image_command_line contains \"-WindowStyle Hidden\"  | alter cgo_msc_path = arrayindex(regextract(causality_actor_process_command_line, \"C:\\\\Windows\\\\system32\\\\mmc.exe.*?(\\w.*.msc)\"),0) | alter actor_msc_path = arrayindex(regextract(actor_process_command_line, \"C:\\\\Windows\\\\system32\\\\mmc.exe.*?(\\w.*.msc)\"),0) | filter actor_msc_path not in (null, \"C:\\windows\\system32\\*\", \"C:\\Program Files\\Microsoft Deployment Toolkit\\*\", \"C:\\Program Files\\Citrix\\*\")  | fields _time, agent_hostname, causality_actor_process_command_line, cgo_msc_path, actor_process_image_name, actor_process_command_line, action_process_image_name, action_process_image_command_line  | comp count_distinct(agent_hostname) as observed_on_X_hosts, values(agent_hostname) as values_hostname, values(actor_process_command_line) as actor_cli, values(actor_process_image_name) as actor_image_name, values(action_process_image_name) as action_image_name, values(action_process_image_command_line) as action_cli by action_process_image_name, action_process_image_command_line  | sort asc observed_on_X_hosts   | join (     dataset = endpoints      | filter endpoint_status in (ENUM.CONNECTED, ENUM.DISCONNECTED)     | comp count_distinct(endpoint_id) as active_xdr_agent_count ) as agent_count \"true\" = \"true\"  | alter percent_of_total_agent_count = divide(observed_on_X_hosts, active_xdr_agent_count) | filter percent_of_total_agent_count <= 0.01 | fields - active_xdr_agent_count  | alter percent_of_total_agent_count = format_string(\"%.2f\", multiply(percent_of_total_agent_count, 100))  | fields values_hostname, actor_cli, action_cli, observed_on_X_hosts, percent_of_total_agent_count ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "CUSTOM", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 52, "name": "Unit42_MSIAM_TI_Impact Report CVE-2025-26633: How Water Gamayun Weaponizes MUIPath using MSC EvilTwin 2", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1218.014\nconfig case_sensitive = false | dataset = xdr_data  | filter event_type = ENUM.STORY and agent_os_type = ENUM.AGENT_OS_WINDOWS  | filter causality_actor_process_image_name = \"mmc.exe\" and actor_process_image_name = \"powershell.exe\"  | filter (action_external_hostname ~= \"(?:[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?\\.)+[a-z0-9][a-z0-9-]{0,61}[a-z0-9]\" or dst_action_external_hostname ~= \"(?:[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?\\.)+[a-z0-9][a-z0-9-]{0,61}[a-z0-9]\") and       dst_action_external_hostname !~= \".*.lan|.*.local|.*.forest|.*.root|.*.internal\" and       action_remote_ip not in (\"8.8.8.8\", \"1.1.1.1\", \"8.8.4.4\")  | alter msc_path = arrayindex(regextract(causality_actor_process_command_line, \"C:\\\\Windows\\\\system32\\\\mmc.exe.*?(\\w.*.msc)\"),0) | filter msc_path != null and msc_path !~= \"C:\\\\windows\\\\system32\\\\.*\"  | filter incidr(action_remote_ip, \"10.0.0.0/8\") != true and                     incidr(action_remote_ip, \"192.168.0.0/16\") != true and          incidr(action_remote_ip, \"172.16.0.0/12\") != true and          incidr(action_remote_ip, \"100.64.0.0/10\") != true and          incidr(action_remote_ip, \"127.0.0.0/8\") != true and          incidr(action_remote_ip, \"169.254.0.0/16\") != true and          incidr(action_remote_ip, \"224.0.0.0/4\") != true and          incidr(action_remote_ip, \"255.255.255.255/32\") != true | iploc action_remote_ip loc_asn, loc_asn_org, loc_city, loc_country   | fields _time, agent_hostname, actor_effective_username, actor_process_image_name, actor_process_command_line, msc_path, action_remote_ip, action_remote_port, action_external_hostname, dst_action_external_hostname, loc_asn, loc_asn_org, loc_city, loc_country   | comp count_distinct(agent_hostname) as observed_on_X_hosts, values(agent_hostname) as values_hostname, values(action_remote_ip) as values_ip_address, values(action_remote_port) as values_port, values(loc_country) as values_coutnry, values(loc_asn) as values_asn, values(dst_action_external_hostname) as value_dst_ext_hostname, values(action_external_hostname) as value_action_ext_hostname, values(loc_asn_org) as values_asn_org, values(actor_effective_username) as values_usernames by msc_path, actor_process_command_line | sort asc observed_on_X_hosts   | join (     dataset = endpoints      | filter endpoint_status in (ENUM.CONNECTED, ENUM.DISCONNECTED)     | comp count_distinct(endpoint_id) as active_xdr_agent_count ) as agent_count \"true\" = \"true\"  | alter percent_of_total_agent_count = divide(observed_on_X_hosts, active_xdr_agent_count) | filter percent_of_total_agent_count <= 0.01 | fields - active_xdr_agent_count  | alter percent_of_total_agent_count = format_string(\"%.2f\", multiply(percent_of_total_agent_count, 100))   | fields values_hostname, values_usernames, msc_path, actor_process_command_line, values_ip_address, values_port, value_action_ext_hostname, value_dst_ext_hostname, values_coutnry, values_asn, values_asn_org, percent_of_total_agent_count, observed_on_X_hosts ", "is_enabled": true, "description": "Query looks for rare MSC file path execution, where the child process has a network connection.", "alert_name": "Unit42_MSIAM_TI_Impact Report CVE-2025-26633: How Water Gamayun Weaponizes MUIPath using MSC EvilTwin 2", "alert_category": "OTHER", "alert_type": null, "alert_description": "Query looks for rare MSC file path execution, where the child process has a network connection.", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": false, "suppression_duration": null, "suppression_fields": null, "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1218.014\nconfig case_sensitive = false | dataset = xdr_data  | filter event_type = ENUM.STORY and agent_os_type = ENUM.AGENT_OS_WINDOWS  | filter causality_actor_process_image_name = \"mmc.exe\" and actor_process_image_name = \"powershell.exe\"  | filter (action_external_hostname ~= \"(?:[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?\\.)+[a-z0-9][a-z0-9-]{0,61}[a-z0-9]\" or dst_action_external_hostname ~= \"(?:[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?\\.)+[a-z0-9][a-z0-9-]{0,61}[a-z0-9]\") and       dst_action_external_hostname !~= \".*.lan|.*.local|.*.forest|.*.root|.*.internal\" and       action_remote_ip not in (\"8.8.8.8\", \"1.1.1.1\", \"8.8.4.4\")  | alter msc_path = arrayindex(regextract(causality_actor_process_command_line, \"C:\\\\Windows\\\\system32\\\\mmc.exe.*?(\\w.*.msc)\"),0) | filter msc_path != null and msc_path !~= \"C:\\\\windows\\\\system32\\\\.*\"  | filter incidr(action_remote_ip, \"10.0.0.0/8\") != true and                     incidr(action_remote_ip, \"192.168.0.0/16\") != true and          incidr(action_remote_ip, \"172.16.0.0/12\") != true and          incidr(action_remote_ip, \"100.64.0.0/10\") != true and          incidr(action_remote_ip, \"127.0.0.0/8\") != true and          incidr(action_remote_ip, \"169.254.0.0/16\") != true and          incidr(action_remote_ip, \"224.0.0.0/4\") != true and          incidr(action_remote_ip, \"255.255.255.255/32\") != true | iploc action_remote_ip loc_asn, loc_asn_org, loc_city, loc_country   | fields _time, agent_hostname, actor_effective_username, actor_process_image_name, actor_process_command_line, msc_path, action_remote_ip, action_remote_port, action_external_hostname, dst_action_external_hostname, loc_asn, loc_asn_org, loc_city, loc_country   | comp count_distinct(agent_hostname) as observed_on_X_hosts, values(agent_hostname) as values_hostname, values(action_remote_ip) as values_ip_address, values(action_remote_port) as values_port, values(loc_country) as values_coutnry, values(loc_asn) as values_asn, values(dst_action_external_hostname) as value_dst_ext_hostname, values(action_external_hostname) as value_action_ext_hostname, values(loc_asn_org) as values_asn_org, values(actor_effective_username) as values_usernames by msc_path, actor_process_command_line | sort asc observed_on_X_hosts   | join (     dataset = endpoints      | filter endpoint_status in (ENUM.CONNECTED, ENUM.DISCONNECTED)     | comp count_distinct(endpoint_id) as active_xdr_agent_count ) as agent_count \"true\" = \"true\"  | alter percent_of_total_agent_count = divide(observed_on_X_hosts, active_xdr_agent_count) | filter percent_of_total_agent_count <= 0.01 | fields - active_xdr_agent_count  | alter percent_of_total_agent_count = format_string(\"%.2f\", multiply(percent_of_total_agent_count, 100))   | fields values_hostname, values_usernames, msc_path, actor_process_command_line, values_ip_address, values_port, value_action_ext_hostname, value_dst_ext_hostname, values_coutnry, values_asn, values_asn_org, percent_of_total_agent_count, observed_on_X_hosts ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "CUSTOM", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 51, "name": "Unit42_MSIAM_TI_Impact Report CVE-2025-26633: How Water Gamayun Weaponizes MUIPath using MSC EvilTwin 1", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1218.014\ndataset = xdr_data  | filter agent_os_type = ENUM.AGENT_OS_WINDOWS  | filter event_type = ENUM.FILE and event_sub_type = ENUM.FILE_CREATE_NEW  | fields _time, agent_hostname, actor_process_image_name, actor_process_command_line, action_file_name, action_file_path, action_file_extension  | filter action_file_extension = \"msc\" and actor_process_image_name in (\"powershell.exe\", \"cmd.exe\", \"cscript.exe\", \"wscript.exe\", \"mshta.exe\", \"msiexec.exe\")  | comp count(action_file_path) as count_paths, values(action_file_path) as file_paths, values(actor_process_command_line) as actor_command_lines by actor_process_image_name, action_file_name, agent_hostname | alter has_mui_path = array_any(file_paths , \"@element\" ~= \"\\\\[a-z]{2}-[A-Z]{2}\\\\\")  | filter has_mui_path = true and count_paths > 1 ", "is_enabled": true, "description": "Query looks for an MSC file being created in two locations, one of which contains a MUI Path", "alert_name": "Unit42_MSIAM_TI_Impact Report CVE-2025-26633: How Water Gamayun Weaponizes MUIPath using MSC EvilTwin 1", "alert_category": "OTHER", "alert_type": null, "alert_description": "Query looks for an MSC file being created in two locations, one of which contains a MUI Path", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1218.014\ndataset = xdr_data  | filter agent_os_type = ENUM.AGENT_OS_WINDOWS  | filter event_type = ENUM.FILE and event_sub_type = ENUM.FILE_CREATE_NEW  | fields _time, agent_hostname, actor_process_image_name, actor_process_command_line, action_file_name, action_file_path, action_file_extension  | filter action_file_extension = \"msc\" and actor_process_image_name in (\"powershell.exe\", \"cmd.exe\", \"cscript.exe\", \"wscript.exe\", \"mshta.exe\", \"msiexec.exe\")  | comp count(action_file_path) as count_paths, values(action_file_path) as file_paths, values(actor_process_command_line) as actor_command_lines by actor_process_image_name, action_file_name, agent_hostname | alter has_mui_path = array_any(file_paths , \"@element\" ~= \"\\\\[a-z]{2}-[A-Z]{2}\\\\\")  | filter has_mui_path = true and count_paths > 1 ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 50, "name": "Unit42_MSIAM_TI_Impact Report: SocGholish's Intrusion Techniques Facilitate Distribution of RansomHub Ransomware 5", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1003.002\nconfig case_sensitive = false | dataset = xdr_data | filter event_type = ENUM.FILE and event_sub_type in (ENUM.FILE_CREATE_NEW, ENUM.FILE_RENAME, ENUM.FILE_WRITE) | filter action_file_name in (\"sa1.txt\", \"se1.txt\", \"sy1.txt\") and actor_process_image_name = \"certutil.exe\" | fields agent_hostname, actor_process_image_name, action_file_name, action_file_path, action_file_sha256, event_type, event_sub_type ", "is_enabled": true, "description": "This query detects credential dumping using Certutil", "alert_name": "Unit42_MSIAM_TI_Impact Report: SocGholish's Intrusion Techniques Facilitate Distribution of RansomHub Ransomware 5", "alert_category": "OTHER", "alert_type": null, "alert_description": "This query detects credential dumping using Certutil", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1003.002\nconfig case_sensitive = false | dataset = xdr_data | filter event_type = ENUM.FILE and event_sub_type in (ENUM.FILE_CREATE_NEW, ENUM.FILE_RENAME, ENUM.FILE_WRITE) | filter action_file_name in (\"sa1.txt\", \"se1.txt\", \"sy1.txt\") and actor_process_image_name = \"certutil.exe\" | fields agent_hostname, actor_process_image_name, action_file_name, action_file_path, action_file_sha256, event_type, event_sub_type ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 49, "name": "Unit42_MSIAM_TI_Impact Report: SocGholish's Intrusion Techniques Facilitate Distribution of RansomHub Ransomware 4", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1053.005\ndataset = xdr_data | filter event_type = ENUM.EVENT_LOG and action_evtlog_event_id in (4698, 4702) | filter json_extract(action_evtlog_data_fields, \"$.TaskName\") contains \"Update\" and json_extract(action_evtlog_data_fields, \"$.TaskContentNew\") contains \"ssh.exe*-p*443\" | alter schtask_creation_task_name = json_extract(action_evtlog_data_fields, \"$.TaskName\"),         schtask_creation_subject_user_sid = json_extract(action_evtlog_data_fields, \"$.SubjectUserSid\"),         schtask_creation_rpc_client_locality = json_extract(action_evtlog_data_fields, \"$.RpcCallClientLocality\"),         schtask_creation_subject_domain_name = json_extract(action_evtlog_data_fields, \"$.SubjectDomainName\"),         schtask_creation_subject_user_name = json_extract(action_evtlog_data_fields, \"$.SubjectUserName\"),         schtasks_creation_command = regextract(json_extract(action_evtlog_data_fields, \"$.TaskContentNew\"), \"Command[>](.*)[<][/]Command\"),         schtasks_creation_args = regextract(json_extract(action_evtlog_data_fields, \"$.TaskContentNew\"), \"Arguments[>](.*)[<][/]Arguments\") | fields agent_hostname, actor_process_image_name, actor_process_command_line, actor_effective_username, schtasks_*, schtask_* ", "is_enabled": true, "description": "Identifies a new scheduled task created of SSH reverse shell with port forwarding", "alert_name": "Unit42_MSIAM_TI_Impact Report: SocGholish's Intrusion Techniques Facilitate Distribution of RansomHub Ransomware 4", "alert_category": "OTHER", "alert_type": null, "alert_description": "Identifies a new scheduled task created of SSH reverse shell with port forwarding", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1053.005\ndataset = xdr_data | filter event_type = ENUM.EVENT_LOG and action_evtlog_event_id in (4698, 4702) | filter json_extract(action_evtlog_data_fields, \"$.TaskName\") contains \"Update\" and json_extract(action_evtlog_data_fields, \"$.TaskContentNew\") contains \"ssh.exe*-p*443\" | alter schtask_creation_task_name = json_extract(action_evtlog_data_fields, \"$.TaskName\"),         schtask_creation_subject_user_sid = json_extract(action_evtlog_data_fields, \"$.SubjectUserSid\"),         schtask_creation_rpc_client_locality = json_extract(action_evtlog_data_fields, \"$.RpcCallClientLocality\"),         schtask_creation_subject_domain_name = json_extract(action_evtlog_data_fields, \"$.SubjectDomainName\"),         schtask_creation_subject_user_name = json_extract(action_evtlog_data_fields, \"$.SubjectUserName\"),         schtasks_creation_command = regextract(json_extract(action_evtlog_data_fields, \"$.TaskContentNew\"), \"Command[>](.*)[<][/]Command\"),         schtasks_creation_args = regextract(json_extract(action_evtlog_data_fields, \"$.TaskContentNew\"), \"Arguments[>](.*)[<][/]Arguments\") | fields agent_hostname, actor_process_image_name, actor_process_command_line, actor_effective_username, schtasks_*, schtask_* ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 48, "name": "Unit42_MSIAM_TI_Impact Report: SocGholish's Intrusion Techniques Facilitate Distribution of RansomHub Ransomware 3", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1555.003\nconfig case_sensitive = false | dataset = xdr_data | filter event_type = FILE AND event_sub_type in(ENUM.FILE_WRITE, FILE_OPEN, FILE_CREATE_NEW) | filter action_file_name = \"other_user_data_*.bin\" | fields agent_hostname, actor_process_image_name, action_file_name, action_file_path, action_file_sha256, event_type, event_sub_type ", "is_enabled": true, "description": "This query identifies .bin files prepared for exfiltration", "alert_name": "Unit42_MSIAM_TI_Impact Report: SocGholish's Intrusion Techniques Facilitate Distribution of RansomHub Ransomware 3", "alert_category": "OTHER", "alert_type": null, "alert_description": "This query identifies .bin files prepared for exfiltration", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1555.003\nconfig case_sensitive = false | dataset = xdr_data | filter event_type = FILE AND event_sub_type in(ENUM.FILE_WRITE, FILE_OPEN, FILE_CREATE_NEW) | filter action_file_name = \"other_user_data_*.bin\" | fields agent_hostname, actor_process_image_name, action_file_name, action_file_path, action_file_sha256, event_type, event_sub_type ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 47, "name": "Unit42_MSIAM_TI_Impact Report: SocGholish's Intrusion Techniques Facilitate Distribution of RansomHub Ransomware 2", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1555.003\nconfig case_sensitive = false | dataset = xdr_data | filter event_type= ENUM.PROCESS and event_sub_type = ENUM.PROCESS_START | filter action_process_image_name = \"powershell.exe\" and action_process_image_command_line in (\"*Get-Content*Edge*user data*app_bound_encrypted_key*\", \"*Get-Content*chrome*user data*app_bound_encrypted_key*\") | fields agent_hostname, actor_effective_username, actor_process_image_name, actor_process_command_line, action_process_image_name, action_process_image_command_line ", "is_enabled": true, "description": "This query identifies extraction of App Bound keys from Edge and Chrome", "alert_name": "Unit42_MSIAM_TI_Impact Report: SocGholish's Intrusion Techniques Facilitate Distribution of RansomHub Ransomware 2", "alert_category": "OTHER", "alert_type": null, "alert_description": "This query identifies extraction of App Bound keys from Edge and Chrome", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1555.003\nconfig case_sensitive = false | dataset = xdr_data | filter event_type= ENUM.PROCESS and event_sub_type = ENUM.PROCESS_START | filter action_process_image_name = \"powershell.exe\" and action_process_image_command_line in (\"*Get-Content*Edge*user data*app_bound_encrypted_key*\", \"*Get-Content*chrome*user data*app_bound_encrypted_key*\") | fields agent_hostname, actor_effective_username, actor_process_image_name, actor_process_command_line, action_process_image_name, action_process_image_command_line ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 46, "name": "Unit42_MSIAM_TI_Impact Report: SocGholish's Intrusion Techniques Facilitate Distribution of RansomHub Ransomware 1", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1059.001\nconfig case_sensitive = false | dataset = xdr_data | filter event_type= ENUM.PROCESS and event_sub_type = ENUM.PROCESS_START | filter action_process_image_name = \"powershell.exe\" and action_process_image_command_line in (\"*wget*\\python3.12.zip*\", \"*-OutFile *pip.pyz;*pythonw.exe pip.pyz*\", \"*-Execute pythonw.exe -Argument *pypa.py*\") | fields agent_hostname, actor_effective_username, actor_process_image_name, actor_process_command_line, action_process_image_name, action_process_image_command_line ", "is_enabled": true, "description": "This query detects common deployment powershell commands", "alert_name": "Unit42_MSIAM_TI_Impact Report: SocGholish's Intrusion Techniques Facilitate Distribution of RansomHub Ransomware 1", "alert_category": "OTHER", "alert_type": null, "alert_description": "This query detects common deployment powershell commands", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1059.001\nconfig case_sensitive = false | dataset = xdr_data | filter event_type= ENUM.PROCESS and event_sub_type = ENUM.PROCESS_START | filter action_process_image_name = \"powershell.exe\" and action_process_image_command_line in (\"*wget*\\python3.12.zip*\", \"*-OutFile *pip.pyz;*pythonw.exe pip.pyz*\", \"*-Execute pythonw.exe -Argument *pypa.py*\") | fields agent_hostname, actor_effective_username, actor_process_image_name, actor_process_command_line, action_process_image_name, action_process_image_command_line ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 42, "name": "Unit42_MSIAM_TI_Impact Report: New Steganographic Campaign Distributing Multiple Malware Variants 1", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1203\npreset = xdr_process | filter event_sub_type = ENUM.PROCESS_START | filter lowercase(action_process_image_name) = \"mshta.exe\" and lowercase(actor_process_image_name) = \"excel.exe\" | fields _time, agent_hostname, action_process_image_name, action_process_image_command_line, actor_process_command_line, causality_actor_process_command_line ", "is_enabled": true, "description": "mshta.exe spawned by Microsoft Excel as a result of exploitation of CVE-2017-0199", "alert_name": "Unit42_MSIAM_TI_Impact Report: New Steganographic Campaign Distributing Multiple Malware Variants 1", "alert_category": "OTHER", "alert_type": null, "alert_description": "mshta.exe spawned by Microsoft Excel as a result of exploitation of CVE-2017-0199", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "0 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1203\npreset = xdr_process | filter event_sub_type = ENUM.PROCESS_START | filter lowercase(action_process_image_name) = \"mshta.exe\" and lowercase(actor_process_image_name) = \"excel.exe\" | fields _time, agent_hostname, action_process_image_name, action_process_image_command_line, actor_process_command_line, causality_actor_process_command_line ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": []}, {"rule_id": 45, "name": "Unit42_MSIAM_TI_Impact Report: New Steganographic Campaign Distributing Multiple Malware Variants 4", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1204.002\nconfig case_sensitive = false  | dataset = xdr_data | filter event_type = ENUM.SYSTEM_CALL and event_sub_type = ENUM.SYSTEM_CALL_NT_CREATE_MUTANT  | fields agent_hostname, action_syscall_string_params  | alter syscall_mutant_name = json_extract(action_syscall_string_params, \"$.1\") | alter syscall_mutant_name = trim(to_string(syscall_mutant_name),\"\\\"\") | filter ((`syscall_mutant_name` contains \"\"\"asasasas2242dqwe\"\"\" or `syscall_mutant_name` contains \"\"\"Rmc-IB3RDF\"\"\"))  ", "is_enabled": true, "description": "Detect mutex creation Remcos and AsyncRat", "alert_name": "Unit42_MSIAM_TI_Impact Report: New Steganographic Campaign Distributing Multiple Malware Variants 4", "alert_category": "OTHER", "alert_type": null, "alert_description": "Detect mutex creation Remcos and AsyncRat", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1204.002\nconfig case_sensitive = false  | dataset = xdr_data | filter event_type = ENUM.SYSTEM_CALL and event_sub_type = ENUM.SYSTEM_CALL_NT_CREATE_MUTANT  | fields agent_hostname, action_syscall_string_params  | alter syscall_mutant_name = json_extract(action_syscall_string_params, \"$.1\") | alter syscall_mutant_name = trim(to_string(syscall_mutant_name),\"\\\"\") | filter ((`syscall_mutant_name` contains \"\"\"asasasas2242dqwe\"\"\" or `syscall_mutant_name` contains \"\"\"Rmc-IB3RDF\"\"\"))  ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 44, "name": "Unit42_MSIAM_TI_Impact Report: New Steganographic Campaign Distributing Multiple Malware Variants 3", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1055.012\ndataset = xdr_data | filter event_type = ENUM.INJECTION and event_sub_type = ENUM.INJECTION_PROCESS_HOLLOW | filter lowercase(actor_process_image_name) = \"powershell.exe\" and not actor_process_is_64bit | fields _time, agent_hostname, action_remote_process_*, actor_process_command_line, causality_actor_process_command_line ", "is_enabled": true, "description": "32-bit powershell performs process hollowing", "alert_name": "Unit42_MSIAM_TI_Impact Report: New Steganographic Campaign Distributing Multiple Malware Variants 3", "alert_category": "OTHER", "alert_type": null, "alert_description": "32-bit powershell performs process hollowing", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1055.012\ndataset = xdr_data | filter event_type = ENUM.INJECTION and event_sub_type = ENUM.INJECTION_PROCESS_HOLLOW | filter lowercase(actor_process_image_name) = \"powershell.exe\" and not actor_process_is_64bit | fields _time, agent_hostname, action_remote_process_*, actor_process_command_line, causality_actor_process_command_line ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 43, "name": "Unit42_MSIAM_TI_Impact Report: New Steganographic Campaign Distributing Multiple Malware Variants 2", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1105\nconfig case_sensitive = false | dataset = xdr_data  | filter event_type = ENUM.FILE and event_sub_type in (ENUM.FILE_CREATE_NEW, ENUM.FILE_WRITE) and action_file_extension = \"JPG\" and action_file_type in (0,1,18) | filter actor_process_image_name in (\"wscript.exe\",\"cscript.exe\") | fields agent_hostname, actor_effective_username, causality_actor_process_image_path, actor_process_image_path, action_file_path, action_file_sha256, action_file_type | filter (`actor_effective_username` not contains \"\"\"SYSTEM\"\"\")  ", "is_enabled": true, "description": "VBScript downloading JPG file", "alert_name": "Unit42_MSIAM_TI_Impact Report: New Steganographic Campaign Distributing Multiple Malware Variants 2", "alert_category": "OTHER", "alert_type": null, "alert_description": "VBScript downloading JPG file", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1105\nconfig case_sensitive = false | dataset = xdr_data  | filter event_type = ENUM.FILE and event_sub_type in (ENUM.FILE_CREATE_NEW, ENUM.FILE_WRITE) and action_file_extension = \"JPG\" and action_file_type in (0,1,18) | filter actor_process_image_name in (\"wscript.exe\",\"cscript.exe\") | fields agent_hostname, actor_effective_username, causality_actor_process_image_path, actor_process_image_path, action_file_path, action_file_sha256, action_file_type | filter (`actor_effective_username` not contains \"\"\"SYSTEM\"\"\")  ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 41, "name": "Unit42_MSIAM_TI_Impact Report: Windows Shortcut Exploit Abused as Zero-Day in Widespread APT Campaigns 2", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1204.002\ndataset = xdr_data | filter event_type = ENUM.FILE and lowercase(action_file_extension) = \"lnk\" and action_file_web_mark != null | alter HostURL = action_file_web_mark -> HostUrl | alter ReferrerUrl = action_file_web_mark -> ReferrerUrl | filter lowercase(HostURL) ~= \"http\" | alter URI_Host_IP = arrayindex(regextract(HostURL, \"\\b(?:\\d{1,3}\\.){3}\\d{1,3}\\b\"),0) | alter rfc1918_172 = incidr(URI_Host_IP, \"172.16.0.0/12\") | alter rfc1918_10 =  incidr(URI_Host_IP, \"10.0.0.0/8\") | alter rfc1918_192 = incidr(URI_Host_IP, \"192.168.0.0/16\") | filter rfc1918_172 = false and rfc1918_10 = false and rfc1918_192 = false and URI_Host_IP not in (\"127.0.0.1\", null, \"\") | fields agent_hostname, action_file_name, action_file_path, action_file_sha256, HostURL, ReferrerUrl, URI_Host_IP ", "is_enabled": true, "description": "Query looks for Mark of the Web data for LNK files to see if they originated from URLs", "alert_name": "Unit42_MSIAM_TI_Impact Report: Windows Shortcut Exploit Abused as Zero-Day in Widespread APT Campaigns 2", "alert_category": "OTHER", "alert_type": null, "alert_description": "Query looks for Mark of the Web data for LNK files to see if they originated from URLs", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1204.002\ndataset = xdr_data | filter event_type = ENUM.FILE and lowercase(action_file_extension) = \"lnk\" and action_file_web_mark != null | alter HostURL = action_file_web_mark -> HostUrl | alter ReferrerUrl = action_file_web_mark -> ReferrerUrl | filter lowercase(HostURL) ~= \"http\" | alter URI_Host_IP = arrayindex(regextract(HostURL, \"\\b(?:\\d{1,3}\\.){3}\\d{1,3}\\b\"),0) | alter rfc1918_172 = incidr(URI_Host_IP, \"172.16.0.0/12\") | alter rfc1918_10 =  incidr(URI_Host_IP, \"10.0.0.0/8\") | alter rfc1918_192 = incidr(URI_Host_IP, \"192.168.0.0/16\") | filter rfc1918_172 = false and rfc1918_10 = false and rfc1918_192 = false and URI_Host_IP not in (\"127.0.0.1\", null, \"\") | fields agent_hostname, action_file_name, action_file_path, action_file_sha256, HostURL, ReferrerUrl, URI_Host_IP ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 40, "name": "Unit42_MSIAM_TI_Impact Report: Windows Shortcut Exploit Abused as Zero-Day in Widespread APT Campaigns 1", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1204.002\ndataset = xdr_data | filter event_type = ENUM.PROCESS and lowercase(action_process_image_name) in (\"cmd.exe\", \"wscript.exe\", \"powershell.exe\") and lowercase(actor_process_image_name) = \"explorer.exe\" | join conflict_strategy=left type=inner (     dataset = xdr_data      | filter event_type = ENUM.FILE and event_sub_type = ENUM.FILE_OPEN and lowercase(action_file_extension) = \"lnk\" and action_file_size > 1024000 and lowercase(actor_process_image_name) = \"explorer.exe\"     | fields action_file_path as lnk_file_path, action_file_name as lnk_file_name, action_file_extension as lnk_file_extension, action_file_size as lnk_file_size, _time, agent_id ) as lnk_read timestamp_diff(_time, lnk_read._time, \"SECOND\") < 3 and timestamp_diff(_time, lnk_read._time, \"SECOND\") > -1 and agent_id = lnk_read.agent_id | fields agent_hostname, actor_effective_username, action_process_image_command_line, lnk_file_name, lnk_file_path, lnk_file_size, actor_process_image_name ", "is_enabled": true, "description": "Query looks for shell/script handler invocation explorer.exe within 2 seconds of explorer reading a LNK file > 1MB", "alert_name": "Unit42_MSIAM_TI_Impact Report: Windows Shortcut Exploit Abused as Zero-Day in Widespread APT Campaigns 1", "alert_category": "OTHER", "alert_type": null, "alert_description": "Query looks for shell/script handler invocation explorer.exe within 2 seconds of explorer reading a LNK file > 1MB", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1204.002\ndataset = xdr_data | filter event_type = ENUM.PROCESS and lowercase(action_process_image_name) in (\"cmd.exe\", \"wscript.exe\", \"powershell.exe\") and lowercase(actor_process_image_name) = \"explorer.exe\" | join conflict_strategy=left type=inner (     dataset = xdr_data      | filter event_type = ENUM.FILE and event_sub_type = ENUM.FILE_OPEN and lowercase(action_file_extension) = \"lnk\" and action_file_size > 1024000 and lowercase(actor_process_image_name) = \"explorer.exe\"     | fields action_file_path as lnk_file_path, action_file_name as lnk_file_name, action_file_extension as lnk_file_extension, action_file_size as lnk_file_size, _time, agent_id ) as lnk_read timestamp_diff(_time, lnk_read._time, \"SECOND\") < 3 and timestamp_diff(_time, lnk_read._time, \"SECOND\") > -1 and agent_id = lnk_read.agent_id | fields agent_hostname, actor_effective_username, action_process_image_command_line, lnk_file_name, lnk_file_path, lnk_file_size, actor_process_image_name ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 39, "name": "Unit42_MSIAM_TI_Impact Report: Medusa Ransomware Targets Multiple Sectors: New Tactics and Indicators Identified 3", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1105\nconfig case_sensitive = false | dataset = xdr_data  | filter event_type = NETWORK and actor_process_image_name = \"certutil.exe\" and          action_process_image_command_line ~= \"((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\" and (action_process_image_command_line contains \".msi\" or action_process_image_command_line contains \".dll\") | filter actor_process_command_line  contains action_remote_ip ", "is_enabled": true, "description": "Attempt to detect CertUtil downloading MSI or DLLs", "alert_name": "Unit42_MSIAM_TI_Impact Report: Medusa Ransomware Targets Multiple Sectors: New Tactics and Indicators Identified 3", "alert_category": "OTHER", "alert_type": null, "alert_description": "Attempt to detect CertUtil downloading MSI or DLLs", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1105\nconfig case_sensitive = false | dataset = xdr_data  | filter event_type = NETWORK and actor_process_image_name = \"certutil.exe\" and          action_process_image_command_line ~= \"((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\" and (action_process_image_command_line contains \".msi\" or action_process_image_command_line contains \".dll\") | filter actor_process_command_line  contains action_remote_ip ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 38, "name": "Unit42_MSIAM_TI_Impact Report: Medusa Ransomware Targets Multiple Sectors: New Tactics and Indicators Identified 2", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1136.002\nconfig case_sensitive = false  |dataset = xdr_data  | filter event_type = PROCESS and event_sub_type = PROCESS_START and (action_process_image_name contains \"net.exe\" OR action_process_image_name contains \"net1.exe\" OR action_process_image_name contains \"cmd.exe\") | filter (action_process_image_command_line contains \"domain admins\" or action_process_image_command_line contains \"enterprise admins\" or action_process_image_command_line contains \"schema admins\") and (action_process_image_command_line ~= \"net\\s+group\" or action_process_image_command_line ~= \"net1\\s+group\") and action_process_image_command_line contains \"/domain\" and action_process_image_command_line contains \"/add\" |fields _time, agent_hostname , agent_id, agent_version, action_process_image_name, action_process_image_command_line, action_process_image_sha256, actor_process_image_name, actor_process_image_command_line, actor_process_image_sha256  ", "is_enabled": true, "description": "Attempt to add user to Domain Admins group", "alert_name": "Unit42_MSIAM_TI_Impact Report: Medusa Ransomware Targets Multiple Sectors: New Tactics and Indicators Identified 2", "alert_category": "OTHER", "alert_type": null, "alert_description": "Attempt to add user to Domain Admins group", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1136.002\nconfig case_sensitive = false  |dataset = xdr_data  | filter event_type = PROCESS and event_sub_type = PROCESS_START and (action_process_image_name contains \"net.exe\" OR action_process_image_name contains \"net1.exe\" OR action_process_image_name contains \"cmd.exe\") | filter (action_process_image_command_line contains \"domain admins\" or action_process_image_command_line contains \"enterprise admins\" or action_process_image_command_line contains \"schema admins\") and (action_process_image_command_line ~= \"net\\s+group\" or action_process_image_command_line ~= \"net1\\s+group\") and action_process_image_command_line contains \"/domain\" and action_process_image_command_line contains \"/add\" |fields _time, agent_hostname , agent_id, agent_version, action_process_image_name, action_process_image_command_line, action_process_image_sha256, actor_process_image_name, actor_process_image_command_line, actor_process_image_sha256  ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 37, "name": "Unit42_MSIAM_TI_Impact Report: Medusa Ransomware Targets Multiple Sectors: New Tactics and Indicators Identified 1", "severity": "SEV_030_MEDIUM", "xql_query": "// MITRE ATT&CK TTP ID: T1105\nconfig case_sensitive = false | dataset = xdr_data  | filter event_type = NETWORK and actor_process_image_name = \"powershell.exe\" and action_process_image_command_line ~= \"((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\" and action_process_image_command_line contains \".msi\" | filter actor_process_command_line  contains action_remote_ip ", "is_enabled": true, "description": "Detect direct Powershell execution of internet-hosted MSI file", "alert_name": "Unit42_MSIAM_TI_Impact Report: Medusa Ransomware Targets Multiple Sectors: New Tactics and Indicators Identified 1", "alert_category": "OTHER", "alert_type": null, "alert_description": "Detect direct Powershell execution of internet-hosted MSI file", "alert_domain": "DOMAIN_HUNTING", "alert_fields": {}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "1 hour", "timezone": "Asia/Jerusalem", "crontab": "*/60 * * * *", "suppression_enabled": true, "suppression_duration": "1 hours", "suppression_fields": ["agent_hostname"], "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "// MITRE ATT&CK TTP ID: T1105\nconfig case_sensitive = false | dataset = xdr_data  | filter event_type = NETWORK and actor_process_image_name = \"powershell.exe\" and action_process_image_command_line ~= \"((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\" and action_process_image_command_line contains \".msi\" | filter actor_process_command_line  contains action_remote_ip ", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 36, "name": "PaloAltoNetworks_PrismaCloudCompute Alerts (2025Feb26  - no Vuln Management Alerts)", "severity": "User Defined", "xql_query": "dataset = paloaltonetworks_prismacloudcompute_generic_alert_raw\n| filter _alert_data != null\n| filter _alert_data not contains \"Vulnerabilities\"\n| alter alert_severity = json_extract_scalar(_alert_data, \"$.severity\")\n| alter alert_category = json_extract_scalar(_alert_data, \"$.alert_category\")\n| alter alert_name = json_extract_scalar(_alert_data, \"$.alert_name\")\n| alter alert_description = json_extract_scalar(_alert_data, \"$.alert_description\")", "is_enabled": false, "description": null, "alert_name": "$alert_name", "alert_category": "User Defined", "alert_type": null, "alert_description": "$alert_description", "alert_domain": "DOMAIN_SECURITY", "alert_fields": {}, "execution_mode": "REAL_TIME", "search_window": null, "simple_schedule": null, "timezone": null, "crontab": null, "suppression_enabled": false, "suppression_duration": null, "suppression_fields": null, "dataset": "alerts", "user_defined_severity": "alert_severity", "user_defined_category": "alert_category", "mitre_defs": {}, "investigation_query_link": "", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": []}, {"rule_id": 35, "name": "Google BigQuery Alerts (automatically generated)", "severity": "User Defined", "xql_query": "dataset = google_bigquery_generic_alert_raw\n| filter _alert_data != null\n| alter alert_severity = json_extract_scalar(_alert_data, \"$.severity\")\n| alter alert_category = json_extract_scalar(_alert_data, \"$.alert_category\")\n| alter alert_name = json_extract_scalar(_alert_data, \"$.alert_name\")\n| alter alert_description = json_extract_scalar(_alert_data, \"$.alert_description\")", "is_enabled": true, "description": null, "alert_name": "$alert_name", "alert_category": "User Defined", "alert_type": null, "alert_description": "$alert_description", "alert_domain": "DOMAIN_SECURITY", "alert_fields": null, "execution_mode": "REAL_TIME", "search_window": null, "simple_schedule": null, "timezone": null, "crontab": null, "suppression_enabled": false, "suppression_duration": null, "suppression_fields": null, "dataset": "alerts", "user_defined_severity": "alert_severity", "user_defined_category": "alert_category", "mitre_defs": null, "investigation_query_link": null, "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 33, "name": "Generic SQL Alerts (automatically generated)", "severity": "User Defined", "xql_query": "dataset = generic_sql_generic_alert_raw\n| filter _alert_data != null\n| alter alert_severity = json_extract_scalar(_alert_data, \"$.severity\")\n| alter alert_category = json_extract_scalar(_alert_data, \"$.alert_category\")\n| alter alert_name = json_extract_scalar(_alert_data, \"$.alert_name\")\n| alter alert_description = json_extract_scalar(_alert_data, \"$.alert_description\")", "is_enabled": true, "description": null, "alert_name": "$alert_name", "alert_category": "User Defined", "alert_type": null, "alert_description": "$alert_description", "alert_domain": "DOMAIN_SECURITY", "alert_fields": null, "execution_mode": "REAL_TIME", "search_window": null, "simple_schedule": null, "timezone": null, "crontab": null, "suppression_enabled": false, "suppression_duration": null, "suppression_fields": null, "dataset": "alerts", "user_defined_severity": "alert_severity", "user_defined_category": "alert_category", "mitre_defs": null, "investigation_query_link": null, "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 30, "name": "EWSO365 Alerts (automatically generated)", "severity": "User Defined", "xql_query": "dataset = ewso365_generic_alert_raw\n| filter _alert_data != null\n| alter alert_severity = json_extract_scalar(_alert_data, \"$.severity\")\n| alter alert_category = json_extract_scalar(_alert_data, \"$.alert_category\")\n| alter alert_name = json_extract_scalar(_alert_data, \"$.alert_name\")\n| alter alert_description = json_extract_scalar(_alert_data, \"$.alert_description\")", "is_enabled": true, "description": null, "alert_name": "$alert_name", "alert_category": "User Defined", "alert_type": null, "alert_description": "$alert_description", "alert_domain": "DOMAIN_SECURITY", "alert_fields": null, "execution_mode": "REAL_TIME", "search_window": null, "simple_schedule": null, "timezone": null, "crontab": null, "suppression_enabled": false, "suppression_duration": null, "suppression_fields": null, "dataset": "alerts", "user_defined_severity": "alert_severity", "user_defined_category": "alert_category", "mitre_defs": null, "investigation_query_link": null, "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 31, "name": "Microsoft 365 Defender Alerts (automatically generated)", "severity": "User Defined", "xql_query": "dataset = microsoft_365_defender_generic_alert_raw\n| filter _alert_data != null\n| alter alert_severity = json_extract_scalar(_alert_data, \"$.severity\")\n| alter alert_category = json_extract_scalar(_alert_data, \"$.alert_category\")\n| alter alert_name = json_extract_scalar(_alert_data, \"$.alert_name\")\n| alter alert_description = json_extract_scalar(_alert_data, \"$.alert_description\")", "is_enabled": true, "description": null, "alert_name": "$alert_name", "alert_category": "User Defined", "alert_type": null, "alert_description": "$alert_description", "alert_domain": "DOMAIN_SECURITY", "alert_fields": null, "execution_mode": "REAL_TIME", "search_window": null, "simple_schedule": null, "timezone": null, "crontab": null, "suppression_enabled": false, "suppression_duration": null, "suppression_fields": null, "dataset": "alerts", "user_defined_severity": "alert_severity", "user_defined_category": "alert_category", "mitre_defs": null, "investigation_query_link": null, "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 32, "name": "Gmail Alerts (automatically generated)", "severity": "User Defined", "xql_query": "dataset = gmail_generic_alert_raw\n| filter _alert_data != null\n| alter alert_severity = json_extract_scalar(_alert_data, \"$.severity\")\n| alter alert_category = json_extract_scalar(_alert_data, \"$.alert_category\")\n| alter alert_name = json_extract_scalar(_alert_data, \"$.alert_name\")\n| alter alert_description = json_extract_scalar(_alert_data, \"$.alert_description\")", "is_enabled": true, "description": null, "alert_name": "$alert_name", "alert_category": "User Defined", "alert_type": null, "alert_description": "$alert_description", "alert_domain": "DOMAIN_SECURITY", "alert_fields": null, "execution_mode": "REAL_TIME", "search_window": null, "simple_schedule": null, "timezone": null, "crontab": null, "suppression_enabled": false, "suppression_duration": null, "suppression_fields": null, "dataset": "alerts", "user_defined_severity": "alert_severity", "user_defined_category": "alert_category", "mitre_defs": null, "investigation_query_link": null, "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 29, "name": "TUC1518-Potential DDoS Traffic", "severity": "User Defined", "xql_query": "dataset = panw_ngfw_threat_raw\n//| filter threat_category not in (\"info-leak\", \"scan\")\n| filter (threat_category = \"dos\" and action = \"alert\" and threat_name not contains \"Vulnerability\")\n| filter not incidr(source_ip, \"10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16\")\n| filter incidr(dest_ip, \"10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16\")\n| comp count_distinct(source_ip) as sourceip_count, values(source_ip) as source_ip by dest_ip, threat_category, threat_id, severity, app, direction_of_attack, inbound_if, outbound_if, threat_name_firewall \n//| comp count() as event_count by dest_ip, source_ip, threat_category , threat_id , threat_name, threat_name_firewall\n| filter sourceip_count >= 5\n| alter sourceIp_list = arraystring(source_ip, \",\")", "is_enabled": true, "description": null, "alert_name": "TUC1518-Potential DDoS Traffic", "alert_category": "User Defined", "alert_type": null, "alert_description": "Potential DDoS traffic has been detected from $source_ip to $dest_ip on $threat_name_firewall, inbound interface =  $inbound_if and outbound interface = $outbound_if", "alert_domain": "DOMAIN_SECURITY", "alert_fields": {"deviceid": "threat_name_firewall", "severity": "severity", "alert_category": "threat_category", "action_local_ip": "source_ip", "trafficdirection": "direction_of_attack", "destinationnetworks": "dest_ip"}, "execution_mode": "SCHEDULED", "search_window": "7 days", "simple_schedule": "10 minutes", "timezone": "America/Indianapolis", "crontab": "*/10 * * * *", "suppression_enabled": false, "suppression_duration": null, "suppression_fields": null, "dataset": "alerts", "user_defined_severity": "severity", "user_defined_category": "threat_category", "mitre_defs": {}, "investigation_query_link": "", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "CUSTOM", "action": "ALERTS", "lookup_mapping": []}, {"rule_id": 25, "name": "TUC1531-Multiple Attacks Detected from Same Source", "severity": "SEV_040_HIGH", "xql_query": "dataset = panw_ngfw_threat_raw\n| filter threat_category not in (\"info-leak\", \"scan\")\n| filter not incidr(source_ip, \"10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16\")\n| filter incidr(dest_ip, \"10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16\")\n| comp count() as event_count by source_ip, threat_category , threat_id , threat_name, threat_name_firewall\n| filter event_count >= 500", "is_enabled": false, "description": "Multipe Attacks from the same IP - 500 in 1 Hour", "alert_name": "TUC1531-Multiple Attacks Detected from Same Source", "alert_category": "OTHER", "alert_type": null, "alert_description": null, "alert_domain": "DOMAIN_SECURITY", "alert_fields": {"threatname": "threat_name", "alert_category": "threat_category", "action_remote_ip": "source_ip", "numberofeventsinoffense": "event_count"}, "execution_mode": "SCHEDULED", "search_window": "1 days", "simple_schedule": "1 hour", "timezone": "America/New_York", "crontab": "0 * * * *", "suppression_enabled": false, "suppression_duration": null, "suppression_fields": null, "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {"TA0006 - Credential Access": ["T1110 - Brute Force"]}, "investigation_query_link": "", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "CUSTOM", "action": "ALERTS", "lookup_mapping": []}, {"rule_id": 26, "name": "TUC1168-Login from Unauthorized Country", "severity": "SEV_040_HIGH", "xql_query": "dataset = msft_azure_ad_raw\n| alter country = json_extract_scalar(location, \"$.countryOrRegion\")\n| alter country = if(Country = \"\", \"Unknown Country\", Country)\n| alter city = json_extract_scalar(location, \"$.city\")\n| alter city = if(city = \"\", \"Unknown City\", city)\n| alter result = json_extract_scalar(status, \"$.errorCode\")\n| filter country in (\"PH\", \"CZ\", \"BG\", \"TH\", \"HK\", \"DE\", \"CO\", \"CL\", \"MX\", \"ZA\", \"GB\", \"PK\", \"SG\", \"CR\", \"EG\", \"NZ\", \"FR\", \"DO\", \"GT\", \"CN\", \"BD\", \"PT\", \"AE\", \"NL\", \"TZ\", \"AU\", \"TW\", \"SE\", \"CD\", \"MA\", \"IQ\", \"ES\", \"AL\", \"BR\", \"KR\", \"CH\", \"JP\", \"RU\", \"KY\", \"LV\", \"JM\", \"NO\", \"AR\", \"IT\", \"VN\", \"LK\", \"BB\", \"AT\", \"TR\", \"PA\", \"MY\", \"CU\", \"BS\", \"LU\", \"RO\", \"DZ\", \"GY\", \"ET\")\n//| filter country != \"CA\"\n//| filter country != \"Unknown Country\"\n\n| filter result = \"0\"\n| fields userPrincipalName  , city, country, result, clientAppUsed , appDisplayName , ipAddress , userDisplayName , networkLocationDetails , ipAddress \n\n| join type = left ( dataset = pan_dss_raw \n    | filter type = \"user\" \n    | fields upn, sam_account_name, ou, domain_name , manager_sam_account_name , department, member_of , company_name, sam_account_name , security_groups , aad_roles \n    ) as ad userPrincipalName  contains ad.upn ", "is_enabled": false, "description": "Login from Unauthorized Country", "alert_name": "TUC1168-Login from Unauthorized Country", "alert_category": "INFILTRATION", "alert_type": null, "alert_description": "There has been a successful login to Azure Entra ID from $city, $country, which is an unauthorized country, by user: $userPrincipalName", "alert_domain": "DOMAIN_SECURITY", "alert_fields": {"city": "city", "orgunit": "ou", "department": "department", "domainname": "domain_name", "companyname": "company_name", "managername": "manager_sam_account_name", "accountgroups": "security_groups", "action_country": "country", "samaccountname": "sam_account_name", "accountmemberof": "member_of", "fw_app_category": "appDisplayName", "action_remote_ip": "ipAddress", "contactemailaddress": "userPrincipalName", "actor_effective_username": "userDisplayName", "prisma_cloud_account_groups": "aad_roles"}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "10 minutes", "timezone": "America/Indianapolis", "crontab": "*/10 * * * *", "suppression_enabled": false, "suppression_duration": null, "suppression_fields": null, "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {"TA0001 - Initial Access": ["T1078 - Valid Accounts"]}, "investigation_query_link": "", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "CUSTOM", "action": "ALERTS", "lookup_mapping": []}, {"rule_id": 28, "name": "PC - Anomaly Test1", "severity": "SEV_040_HIGH", "xql_query": "dataset = prisma_cloud_raw \n//| filter (id = \"\"\"P-69154918\"\"\") \n//| filter (id = \"\"\"P-69087147\"\"\")\n| filter policy contains \"Unusual user activity\"\n| alter subject = json_extract_scalar(anomalyDetail, \"$.subject\")\n| alter action = json_extract_scalar(anomalyDetail, \"$.action\")\n| alter type = json_extract_scalar(anomalyDetail, \"$.type\")\n//| alter cloud_accountName = json_extract_scalar(anomalyDetail, \"$.accountName\")\n| alter cloud_accountName = json_extract_scalar(resource, \"$.account\")\n| alter cloud_accountID = json_extract_scalar(resource, \"$.accountId\")\n| alter cloud_accountGroups = json_extract_array(resource, \"$.cloudAccountGroups\")\n| alter reasonValues = json_extract_array(anomalyDetail, \"$.reasonValues\")\n| alter policyId = json_extract_scalar(policy, \"$.policyId\")\n| alter policyname = json_extract_scalar(policy, \"$.name\")\n| alter policydescription = json_extract_scalar(policy, \"$.description\")\n//\n", "is_enabled": true, "description": null, "alert_name": "PC - Anomaly Test1", "alert_category": "CREDENTIAL_ACCESS", "alert_type": null, "alert_description": null, "alert_domain": "DOMAIN_SECURITY", "alert_fields": {"project": "cloud_accountName", "policyid": "policyId", "alerttypeid": "type", "eventaction": "action", "policydetails": "policyname", "alertmalicious": "reasonValues", "cloudaccountid": "cloud_accountID", "policydescription": "policydescription", "actor_effective_username": "subject", "prisma_cloud_account_groups": "cloud_accountGroups"}, "execution_mode": "SCHEDULED", "search_window": "7 days", "simple_schedule": "10 minutes", "timezone": "America/New_York", "crontab": "*/10 * * * *", "suppression_enabled": false, "suppression_duration": null, "suppression_fields": null, "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {"TA0001 - Initial Access": ["T1078 - Valid Accounts"]}, "investigation_query_link": "", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "CUSTOM", "action": "ALERTS", "lookup_mapping": []}, {"rule_id": 5, "name": "PaloAltoNetworks_PrismaCloudCompute Alerts (automatically generated)", "severity": "User Defined", "xql_query": "dataset = paloaltonetworks_prismacloudcompute_generic_alert_raw\n| filter _alert_data != null\n| alter alert_severity = json_extract_scalar(_alert_data, \"$.severity\")\n| alter alert_category = json_extract_scalar(_alert_data, \"$.alert_category\")\n| alter alert_name = json_extract_scalar(_alert_data, \"$.alert_name\")\n| alter alert_description = json_extract_scalar(_alert_data, \"$.alert_description\")", "is_enabled": false, "description": null, "alert_name": "$alert_name", "alert_category": "User Defined", "alert_type": null, "alert_description": "$alert_description", "alert_domain": "DOMAIN_SECURITY", "alert_fields": null, "execution_mode": "REAL_TIME", "search_window": null, "simple_schedule": null, "timezone": null, "crontab": null, "suppression_enabled": false, "suppression_duration": null, "suppression_fields": null, "dataset": "alerts", "user_defined_severity": "alert_severity", "user_defined_category": "alert_category", "mitre_defs": null, "investigation_query_link": null, "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 3, "name": "PrismaCloud v2 Alerts (automatically generated)", "severity": "User Defined", "xql_query": "dataset = prismacloud_v2_generic_alert_raw\n| filter _alert_data != null\n| alter alert_severity = json_extract_scalar(_alert_data, \"$.severity\")\n| alter alert_category = json_extract_scalar(_alert_data, \"$.alert_category\")\n| alter alert_name = json_extract_scalar(_alert_data, \"$.alert_name\")\n| alter alert_description = json_extract_scalar(_alert_data, \"$.alert_description\")", "is_enabled": false, "description": null, "alert_name": "$alert_name", "alert_category": "User Defined", "alert_type": null, "alert_description": "$alert_description", "alert_domain": "DOMAIN_SECURITY", "alert_fields": null, "execution_mode": "REAL_TIME", "search_window": null, "simple_schedule": null, "timezone": null, "crontab": null, "suppression_enabled": false, "suppression_duration": null, "suppression_fields": null, "dataset": "alerts", "user_defined_severity": "alert_severity", "user_defined_category": "alert_category", "mitre_defs": null, "investigation_query_link": null, "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 27, "name": "TUC1909-Malware email targeting multiple accounts", "severity": "SEV_040_HIGH", "xql_query": "dataset = proofpoint_tap_v2_generic_alert_raw\n| filter _alert_data != null\n| alter recipient_domain = rtrim(arrayindex(regextract(recipient, \"[^@]+$\"),0), \"\\\"]\")\n| alter threattype = json_extract_scalar(threatsInfoMap, \"$[0].threatType\")\n| alter alert_severity = json_extract_scalar(_alert_data, \"$.severity\")\n| alter alert_category = json_extract_scalar(_alert_data, \"$.alert_category\")\n| alter alert_name = json_extract_scalar(_alert_data, \"$.alert_name\")\n| alter alert_description = json_extract_scalar(_alert_data, \"$.alert_description\")\n| alter campaignId = json_extract_scalar(threatsInfoMap , \"$[0].campaignID\")\n| alter classification = json_extract_scalar(threatsInfoMap, \"$[0].classification\")\n| filter classification = \"malware\"\n| filter type = \"messages delivered\"\n//| alter day = date_floor(_time, \"D\")\n//| alter concat_recipient_subject = concat(recipient, \"_\", subject)\n| comp count_distinct(recipient) as recipient_count, values(recipient) as recpients by subject // recipient, _time, concat_recipient_subject\n|filter recipient_count > 1\n|alter recipient_list = arraystring(recpients, \",\")\n\n\n", "is_enabled": true, "description": null, "alert_name": "TUC1909-Malware email targeting multiple accounts", "alert_category": "EXECUTION", "alert_type": null, "alert_description": null, "alert_domain": "DOMAIN_SECURITY", "alert_fields": {"fw_email_subject": "subject", "fw_email_recipient": "recipient_list"}, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "10 minutes", "timezone": "America/New_York", "crontab": "*/10 * * * *", "suppression_enabled": false, "suppression_duration": null, "suppression_fields": null, "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {}, "investigation_query_link": "", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": []}, {"rule_id": 11, "name": "Proofpoint TAP v2 Alerts (automatically generated) 2024Nov27", "severity": "User Defined", "xql_query": "dataset = proofpoint_tap_v2_generic_alert_raw\n| filter _alert_data != null\n| alter recipient_domain = rtrim(arrayindex(regextract(recipient, \"[^@]+$\"),0), \"\\\"]\")\n| alter threattype = json_extract_scalar(threatsInfoMap, \"$[0].threatType\")\n| alter alert_severity = json_extract_scalar(_alert_data, \"$.severity\")\n| alter alert_category = json_extract_scalar(_alert_data, \"$.alert_category\")\n| alter alert_name = json_extract_scalar(_alert_data, \"$.alert_name\")\n| alter alert_description = json_extract_scalar(_alert_data, \"$.alert_description\")\n| alter campaignId = json_extract_scalar(threatsInfoMap , \"$[0].campaignID\")\n| alter classification = json_extract_scalar(threatsInfoMap, \"$[0].classification\")", "is_enabled": false, "description": null, "alert_name": "$alert_name", "alert_category": "User Defined", "alert_type": null, "alert_description": "$alert_description", "alert_domain": "DOMAIN_SECURITY", "alert_fields": {"proofpointtapid": "threatID", "proofpointtapthreatinfomap": "threatsInfoMap"}, "execution_mode": "REAL_TIME", "search_window": null, "simple_schedule": null, "timezone": null, "crontab": null, "suppression_enabled": false, "suppression_duration": null, "suppression_fields": null, "dataset": "alerts", "user_defined_severity": "alert_severity", "user_defined_category": "alert_category", "mitre_defs": {}, "investigation_query_link": "", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": []}, {"rule_id": 23, "name": "LCL - TUC1711-Account Disabled", "severity": "SEV_030_MEDIUM", "xql_query": "dataset = microsoft_windows_raw \n| filter (event_id = 4725)\n| alter target_user = json_extract_scalar(event_data, \"$.TargetUserName\")\n| alter target_sid = json_extract_scalar(event_data, \"$.TargetSid\")\n| alter subject_user = json_extract_scalar(event_data, \"$.SubjectUserName\")\n| alter subject_sid = json_extract_scalar(event_data, \"$.SubjectUserSid\")\n| alter target_domain = json_extract_scalar(event_data, \"$.TargetDomainName\")", "is_enabled": false, "description": "Alert triggering on Windows Event ID 4725 - Account Disabled", "alert_name": "LCL - TUC1711-Account Disabled", "alert_category": "EVASION", "alert_type": null, "alert_description": "Windows account disabled, triggering on Windows Event ID 4725.", "alert_domain": "DOMAIN_SECURITY", "alert_fields": {"userid": "target_user", "accountid": "subject_user", "eventaction": "event_data", "agent_hostname": "host_name", "agent_device_domain": "target_domain"}, "execution_mode": "SCHEDULED", "search_window": "1 days", "simple_schedule": "10 minutes", "timezone": "America/New_York", "crontab": "*/10 * * * *", "suppression_enabled": false, "suppression_duration": null, "suppression_fields": null, "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {"TA0005 - Defense Evasion": ["T1078.003 - Valid Accounts: Local Accounts"]}, "investigation_query_link": "", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "CUSTOM", "action": "ALERTS", "lookup_mapping": []}, {"rule_id": 22, "name": "Risky Login from Malicious IP Address-Azure", "severity": "SEV_040_HIGH", "xql_query": "dataset = msft_graph_security_alerts_raw \n| filter title = \"Malicious IP address\"\n| alter accountName = json_extract_scalar(evidence, \"$.0.userAccount.userPrincipalName\")\n| alter domainName = json_extract_scalar(evidence, \"$.0.userAccount.domainName\")\n| alter src_ip = json_extract_scalar(evidence, \"$.1.ipAddress\")\n| alter comment = json_extract_scalar(comments, \"$.0.comment\")", "is_enabled": true, "description": "Alert triggering on Azure Sentinel alert \"Malicious IP address\"", "alert_name": "Risky Login from Malicious IP Address-Azure", "alert_category": "CREDENTIAL_ACCESS", "alert_type": null, "alert_description": null, "alert_domain": "DOMAIN_SECURITY", "alert_fields": {"comment": "comment", "agent_hostname": null, "action_local_ip": "src_ip", "action_remote_ip": null, "action_remote_port": null, "agent_device_domain": "domainName", "actor_effective_username": "accountName", "actor_process_image_name": null, "actor_process_image_path": null, "actor_process_command_line": null, "actor_process_image_sha256": null}, "execution_mode": "SCHEDULED", "search_window": "7 days", "simple_schedule": "10 minutes", "timezone": "America/New_York", "crontab": "*/10 * * * *", "suppression_enabled": false, "suppression_duration": null, "suppression_fields": null, "dataset": "alerts", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": {"TA0001 - Initial Access": ["T1078.004 - Valid Accounts: Cloud Accounts"]}, "investigation_query_link": "", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "CUSTOM", "action": "ALERTS", "lookup_mapping": []}, {"rule_id": 24, "name": "Microsoft Graph Alerts (automatically generated)", "severity": "User Defined", "xql_query": "dataset = microsoft_graph_generic_alert_raw\n| filter _alert_data != null\n| alter alert_severity = json_extract_scalar(_alert_data, \"$.severity\")\n| alter alert_category = json_extract_scalar(_alert_data, \"$.alert_category\")\n| alter alert_name = json_extract_scalar(_alert_data, \"$.alert_name\")\n| alter alert_description = json_extract_scalar(_alert_data, \"$.alert_description\")", "is_enabled": true, "description": null, "alert_name": "$alert_name", "alert_category": "User Defined", "alert_type": null, "alert_description": "$alert_description", "alert_domain": "DOMAIN_SECURITY", "alert_fields": null, "execution_mode": "REAL_TIME", "search_window": null, "simple_schedule": null, "timezone": null, "crontab": null, "suppression_enabled": false, "suppression_duration": null, "suppression_fields": null, "dataset": "alerts", "user_defined_severity": "alert_severity", "user_defined_category": "alert_category", "mitre_defs": null, "investigation_query_link": null, "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 21, "name": "HelloWorld Alerts (automatically generated)", "severity": "User Defined", "xql_query": "dataset = helloworld_generic_alert_raw\n| filter _alert_data != null\n| alter alert_severity = json_extract_scalar(_alert_data, \"$.severity\")\n| alter alert_category = json_extract_scalar(_alert_data, \"$.alert_category\")\n| alter alert_name = json_extract_scalar(_alert_data, \"$.alert_name\")\n| alter alert_description = json_extract_scalar(_alert_data, \"$.alert_description\")", "is_enabled": true, "description": null, "alert_name": "$alert_name", "alert_category": "User Defined", "alert_type": null, "alert_description": "$alert_description", "alert_domain": "DOMAIN_SECURITY", "alert_fields": null, "execution_mode": "REAL_TIME", "search_window": null, "simple_schedule": null, "timezone": null, "crontab": null, "suppression_enabled": false, "suppression_duration": null, "suppression_fields": null, "dataset": "alerts", "user_defined_severity": "alert_severity", "user_defined_category": "alert_category", "mitre_defs": null, "investigation_query_link": null, "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 20, "name": "Okta IAM Alerts (automatically generated)", "severity": "User Defined", "xql_query": "dataset = okta_iam_generic_alert_raw\n| filter _alert_data != null\n| alter alert_severity = json_extract_scalar(_alert_data, \"$.severity\")\n| alter alert_category = json_extract_scalar(_alert_data, \"$.alert_category\")\n| alter alert_name = json_extract_scalar(_alert_data, \"$.alert_name\")\n| alter alert_description = json_extract_scalar(_alert_data, \"$.alert_description\")", "is_enabled": true, "description": null, "alert_name": "$alert_name", "alert_category": "User Defined", "alert_type": null, "alert_description": "$alert_description", "alert_domain": "DOMAIN_SECURITY", "alert_fields": null, "execution_mode": "REAL_TIME", "search_window": null, "simple_schedule": null, "timezone": null, "crontab": null, "suppression_enabled": false, "suppression_duration": null, "suppression_fields": null, "dataset": "alerts", "user_defined_severity": "alert_severity", "user_defined_category": "alert_category", "mitre_defs": null, "investigation_query_link": null, "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 18, "name": "Microsoft Graph Mail Single User Alerts (automatically generated)", "severity": "User Defined", "xql_query": "dataset = microsoft_graph_mail_single_user_generic_alert_raw\n| filter _alert_data != null\n| alter alert_severity = json_extract_scalar(_alert_data, \"$.severity\")\n| alter alert_category = json_extract_scalar(_alert_data, \"$.alert_category\")\n| alter alert_name = json_extract_scalar(_alert_data, \"$.alert_name\")\n| alter alert_description = json_extract_scalar(_alert_data, \"$.alert_description\")", "is_enabled": true, "description": null, "alert_name": "$alert_name", "alert_category": "User Defined", "alert_type": null, "alert_description": "$alert_description", "alert_domain": "DOMAIN_SECURITY", "alert_fields": null, "execution_mode": "REAL_TIME", "search_window": null, "simple_schedule": null, "timezone": null, "crontab": null, "suppression_enabled": false, "suppression_duration": null, "suppression_fields": null, "dataset": "alerts", "user_defined_severity": "alert_severity", "user_defined_category": "alert_category", "mitre_defs": null, "investigation_query_link": null, "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 19, "name": "MicrosoftGraphMail Alerts (automatically generated)", "severity": "User Defined", "xql_query": "dataset = microsoftgraphmail_generic_alert_raw\n| filter _alert_data != null\n| alter alert_severity = json_extract_scalar(_alert_data, \"$.severity\")\n| alter alert_category = json_extract_scalar(_alert_data, \"$.alert_category\")\n| alter alert_name = json_extract_scalar(_alert_data, \"$.alert_name\")\n| alter alert_description = json_extract_scalar(_alert_data, \"$.alert_description\")", "is_enabled": true, "description": null, "alert_name": "$alert_name", "alert_category": "User Defined", "alert_type": null, "alert_description": "$alert_description", "alert_domain": "DOMAIN_SECURITY", "alert_fields": null, "execution_mode": "REAL_TIME", "search_window": null, "simple_schedule": null, "timezone": null, "crontab": null, "suppression_enabled": false, "suppression_duration": null, "suppression_fields": null, "dataset": "alerts", "user_defined_severity": "alert_severity", "user_defined_category": "alert_category", "mitre_defs": null, "investigation_query_link": null, "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 10, "name": "Proofpoint TAP v2 Alerts (automatically generated) (Copy)", "severity": "User Defined", "xql_query": "dataset = proofpoint_tap_v2_generic_alert_raw\n| filter _alert_data != null\n| alter threattype = json_extract_scalar(threatsInfoMap, \"$[0].threatType\")\n| alter alert_severity = json_extract_scalar(_alert_data, \"$.severity\")\n| alter alert_category = json_extract_scalar(_alert_data, \"$.alert_category\")\n| alter alert_name = json_extract_scalar(_alert_data, \"$.alert_name\")\n| alter alert_description = json_extract_scalar(_alert_data, \"$.alert_description\")\n| alter campaignId = json_extract_scalar(threatsInfoMap , \"$[0].campaignID\")\n| alter classification = json_extract_scalar(threatsInfoMap, \"$[0].classification\")\n| alter recipient = rtrim(arrayindex(regextract(recipient, \"[^@]+$\"),0), \"\\\"]\")", "is_enabled": false, "description": null, "alert_name": "$alert_name", "alert_category": "User Defined", "alert_type": null, "alert_description": "$alert_description", "alert_domain": "DOMAIN_SECURITY", "alert_fields": {"proofpointtapclassification": "classification"}, "execution_mode": "REAL_TIME", "search_window": null, "simple_schedule": null, "timezone": null, "crontab": null, "suppression_enabled": false, "suppression_duration": null, "suppression_fields": null, "dataset": "alerts", "user_defined_severity": "alert_severity", "user_defined_category": "alert_category", "mitre_defs": {}, "investigation_query_link": "", "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": []}, {"rule_id": 14, "name": "SplunkPy Alerts (automatically generated)", "severity": "User Defined", "xql_query": "dataset = splunkpy_generic_alert_raw\n| filter _alert_data != null\n| alter alert_severity = json_extract_scalar(_alert_data, \"$.severity\")\n| alter alert_category = json_extract_scalar(_alert_data, \"$.alert_category\")\n| alter alert_name = json_extract_scalar(_alert_data, \"$.alert_name\")\n| alter alert_description = json_extract_scalar(_alert_data, \"$.alert_description\")", "is_enabled": true, "description": null, "alert_name": "$alert_name", "alert_category": "User Defined", "alert_type": null, "alert_description": "$alert_description", "alert_domain": "DOMAIN_SECURITY", "alert_fields": null, "execution_mode": "REAL_TIME", "search_window": null, "simple_schedule": null, "timezone": null, "crontab": null, "suppression_enabled": false, "suppression_duration": null, "suppression_fields": null, "dataset": "alerts", "user_defined_severity": "alert_severity", "user_defined_category": "alert_category", "mitre_defs": null, "investigation_query_link": null, "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 15, "name": "QRadar Alerts (automatically generated)", "severity": "User Defined", "xql_query": "dataset = qradar_generic_alert_raw\n| filter _alert_data != null\n| alter alert_severity = json_extract_scalar(_alert_data, \"$.severity\")\n| alter alert_category = json_extract_scalar(_alert_data, \"$.alert_category\")\n| alter alert_name = json_extract_scalar(_alert_data, \"$.alert_name\")\n| alter alert_description = json_extract_scalar(_alert_data, \"$.alert_description\")", "is_enabled": true, "description": null, "alert_name": "$alert_name", "alert_category": "User Defined", "alert_type": null, "alert_description": "$alert_description", "alert_domain": "DOMAIN_SECURITY", "alert_fields": null, "execution_mode": "REAL_TIME", "search_window": null, "simple_schedule": null, "timezone": null, "crontab": null, "suppression_enabled": false, "suppression_duration": null, "suppression_fields": null, "dataset": "alerts", "user_defined_severity": "alert_severity", "user_defined_category": "alert_category", "mitre_defs": null, "investigation_query_link": null, "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 16, "name": "Palo Alto Networks IoT Alerts (automatically generated)", "severity": "User Defined", "xql_query": "dataset = palo_alto_networks_iot_generic_alert_raw\n| filter _alert_data != null\n| alter alert_severity = json_extract_scalar(_alert_data, \"$.severity\")\n| alter alert_category = json_extract_scalar(_alert_data, \"$.alert_category\")\n| alter alert_name = json_extract_scalar(_alert_data, \"$.alert_name\")\n| alter alert_description = json_extract_scalar(_alert_data, \"$.alert_description\")", "is_enabled": true, "description": null, "alert_name": "$alert_name", "alert_category": "User Defined", "alert_type": null, "alert_description": "$alert_description", "alert_domain": "DOMAIN_SECURITY", "alert_fields": null, "execution_mode": "REAL_TIME", "search_window": null, "simple_schedule": null, "timezone": null, "crontab": null, "suppression_enabled": false, "suppression_duration": null, "suppression_fields": null, "dataset": "alerts", "user_defined_severity": "alert_severity", "user_defined_category": "alert_category", "mitre_defs": null, "investigation_query_link": null, "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 17, "name": "MicrosoftGraphIdentityandAccess Alerts (automatically generated)", "severity": "User Defined", "xql_query": "dataset = microsoftgraphidentityandaccess_generic_alert_raw\n| filter _alert_data != null\n| alter alert_severity = json_extract_scalar(_alert_data, \"$.severity\")\n| alter alert_category = json_extract_scalar(_alert_data, \"$.alert_category\")\n| alter alert_name = json_extract_scalar(_alert_data, \"$.alert_name\")\n| alter alert_description = json_extract_scalar(_alert_data, \"$.alert_description\")", "is_enabled": true, "description": null, "alert_name": "$alert_name", "alert_category": "User Defined", "alert_type": null, "alert_description": "$alert_description", "alert_domain": "DOMAIN_SECURITY", "alert_fields": null, "execution_mode": "REAL_TIME", "search_window": null, "simple_schedule": null, "timezone": null, "crontab": null, "suppression_enabled": false, "suppression_duration": null, "suppression_fields": null, "dataset": "alerts", "user_defined_severity": "alert_severity", "user_defined_category": "alert_category", "mitre_defs": null, "investigation_query_link": null, "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 13, "name": "Panorama Alerts (automatically generated)", "severity": "User Defined", "xql_query": "dataset = panorama_generic_alert_raw\n| filter _alert_data != null\n| alter alert_severity = json_extract_scalar(_alert_data, \"$.severity\")\n| alter alert_category = json_extract_scalar(_alert_data, \"$.alert_category\")\n| alter alert_name = json_extract_scalar(_alert_data, \"$.alert_name\")\n| alter alert_description = json_extract_scalar(_alert_data, \"$.alert_description\")", "is_enabled": true, "description": null, "alert_name": "$alert_name", "alert_category": "User Defined", "alert_type": null, "alert_description": "$alert_description", "alert_domain": "DOMAIN_SECURITY", "alert_fields": null, "execution_mode": "REAL_TIME", "search_window": null, "simple_schedule": null, "timezone": null, "crontab": null, "suppression_enabled": false, "suppression_duration": null, "suppression_fields": null, "dataset": "alerts", "user_defined_severity": "alert_severity", "user_defined_category": "alert_category", "mitre_defs": null, "investigation_query_link": null, "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 12, "name": "VirusTotal - Premium (API v3) Alerts (automatically generated)", "severity": "User Defined", "xql_query": "dataset = virustotal_premium_api_v3__generic_alert_raw\n| filter _alert_data != null\n| alter alert_severity = json_extract_scalar(_alert_data, \"$.severity\")\n| alter alert_category = json_extract_scalar(_alert_data, \"$.alert_category\")\n| alter alert_name = json_extract_scalar(_alert_data, \"$.alert_name\")\n| alter alert_description = json_extract_scalar(_alert_data, \"$.alert_description\")", "is_enabled": true, "description": null, "alert_name": "$alert_name", "alert_category": "User Defined", "alert_type": null, "alert_description": "$alert_description", "alert_domain": "DOMAIN_SECURITY", "alert_fields": null, "execution_mode": "REAL_TIME", "search_window": null, "simple_schedule": null, "timezone": null, "crontab": null, "suppression_enabled": false, "suppression_duration": null, "suppression_fields": null, "dataset": "alerts", "user_defined_severity": "alert_severity", "user_defined_category": "alert_category", "mitre_defs": null, "investigation_query_link": null, "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 2, "name": "Proofpoint TAP v2 Alerts (automatically generated)", "severity": "User Defined", "xql_query": "dataset = proofpoint_tap_v2_generic_alert_raw\n| filter _alert_data != null\n| alter alert_severity = json_extract_scalar(_alert_data, \"$.severity\")\n| alter alert_category = json_extract_scalar(_alert_data, \"$.alert_category\")\n| alter alert_name = json_extract_scalar(_alert_data, \"$.alert_name\")\n| alter alert_description = json_extract_scalar(_alert_data, \"$.alert_description\")", "is_enabled": false, "description": null, "alert_name": "$alert_name", "alert_category": "User Defined", "alert_type": null, "alert_description": "$alert_description", "alert_domain": "DOMAIN_SECURITY", "alert_fields": null, "execution_mode": "REAL_TIME", "search_window": null, "simple_schedule": null, "timezone": null, "crontab": null, "suppression_enabled": false, "suppression_duration": null, "suppression_fields": null, "dataset": "alerts", "user_defined_severity": "alert_severity", "user_defined_category": "alert_category", "mitre_defs": null, "investigation_query_link": null, "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 6, "name": "ServiceNow v2 Alerts (automatically generated)", "severity": "User Defined", "xql_query": "dataset = servicenow_v2_generic_alert_raw\n| filter _alert_data != null\n| alter alert_severity = json_extract_scalar(_alert_data, \"$.severity\")\n| alter alert_category = json_extract_scalar(_alert_data, \"$.alert_category\")\n| alter alert_name = json_extract_scalar(_alert_data, \"$.alert_name\")\n| alter alert_description = json_extract_scalar(_alert_data, \"$.alert_description\")", "is_enabled": true, "description": null, "alert_name": "$alert_name", "alert_category": "User Defined", "alert_type": null, "alert_description": "$alert_description", "alert_domain": "DOMAIN_SECURITY", "alert_fields": null, "execution_mode": "REAL_TIME", "search_window": null, "simple_schedule": null, "timezone": null, "crontab": null, "suppression_enabled": false, "suppression_duration": null, "suppression_fields": null, "dataset": "alerts", "user_defined_severity": "alert_severity", "user_defined_category": "alert_category", "mitre_defs": null, "investigation_query_link": null, "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 7, "name": "ServiceNow Alerts (automatically generated)", "severity": "User Defined", "xql_query": "dataset = servicenow_generic_alert_raw\n| filter _alert_data != null\n| alter alert_severity = json_extract_scalar(_alert_data, \"$.severity\")\n| alter alert_category = json_extract_scalar(_alert_data, \"$.alert_category\")\n| alter alert_name = json_extract_scalar(_alert_data, \"$.alert_name\")\n| alter alert_description = json_extract_scalar(_alert_data, \"$.alert_description\")", "is_enabled": true, "description": null, "alert_name": "$alert_name", "alert_category": "User Defined", "alert_type": null, "alert_description": "$alert_description", "alert_domain": "DOMAIN_SECURITY", "alert_fields": null, "execution_mode": "REAL_TIME", "search_window": null, "simple_schedule": null, "timezone": null, "crontab": null, "suppression_enabled": false, "suppression_duration": null, "suppression_fields": null, "dataset": "alerts", "user_defined_severity": "alert_severity", "user_defined_category": "alert_category", "mitre_defs": null, "investigation_query_link": null, "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 8, "name": "jira-v2 Alerts (automatically generated)", "severity": "User Defined", "xql_query": "dataset = jira_v2_generic_alert_raw\n| filter _alert_data != null\n| alter alert_severity = json_extract_scalar(_alert_data, \"$.severity\")\n| alter alert_category = json_extract_scalar(_alert_data, \"$.alert_category\")\n| alter alert_name = json_extract_scalar(_alert_data, \"$.alert_name\")\n| alter alert_description = json_extract_scalar(_alert_data, \"$.alert_description\")", "is_enabled": true, "description": null, "alert_name": "$alert_name", "alert_category": "User Defined", "alert_type": null, "alert_description": "$alert_description", "alert_domain": "DOMAIN_SECURITY", "alert_fields": null, "execution_mode": "REAL_TIME", "search_window": null, "simple_schedule": null, "timezone": null, "crontab": null, "suppression_enabled": false, "suppression_duration": null, "suppression_fields": null, "dataset": "alerts", "user_defined_severity": "alert_severity", "user_defined_category": "alert_category", "mitre_defs": null, "investigation_query_link": null, "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 9, "name": "Jira V3 Alerts (automatically generated)", "severity": "User Defined", "xql_query": "dataset = jira_v3_generic_alert_raw\n| filter _alert_data != null\n| alter alert_severity = json_extract_scalar(_alert_data, \"$.severity\")\n| alter alert_category = json_extract_scalar(_alert_data, \"$.alert_category\")\n| alter alert_name = json_extract_scalar(_alert_data, \"$.alert_name\")\n| alter alert_description = json_extract_scalar(_alert_data, \"$.alert_description\")", "is_enabled": true, "description": null, "alert_name": "$alert_name", "alert_category": "User Defined", "alert_type": null, "alert_description": "$alert_description", "alert_domain": "DOMAIN_SECURITY", "alert_fields": null, "execution_mode": "REAL_TIME", "search_window": null, "simple_schedule": null, "timezone": null, "crontab": null, "suppression_enabled": false, "suppression_duration": null, "suppression_fields": null, "dataset": "alerts", "user_defined_severity": "alert_severity", "user_defined_category": "alert_category", "mitre_defs": null, "investigation_query_link": null, "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 4, "name": "RedLock Alerts (automatically generated)", "severity": "User Defined", "xql_query": "dataset = redlock_generic_alert_raw\n| filter _alert_data != null\n| alter alert_severity = json_extract_scalar(_alert_data, \"$.severity\")\n| alter alert_category = json_extract_scalar(_alert_data, \"$.alert_category\")\n| alter alert_name = json_extract_scalar(_alert_data, \"$.alert_name\")\n| alter alert_description = json_extract_scalar(_alert_data, \"$.alert_description\")", "is_enabled": true, "description": null, "alert_name": "$alert_name", "alert_category": "User Defined", "alert_type": null, "alert_description": "$alert_description", "alert_domain": "DOMAIN_SECURITY", "alert_fields": null, "execution_mode": "REAL_TIME", "search_window": null, "simple_schedule": null, "timezone": null, "crontab": null, "suppression_enabled": false, "suppression_duration": null, "suppression_fields": null, "dataset": "alerts", "user_defined_severity": "alert_severity", "user_defined_category": "alert_category", "mitre_defs": null, "investigation_query_link": null, "drilldown_query_timeframe": "ALERT", "mapping_strategy": "AUTO", "action": "ALERTS", "lookup_mapping": null}, {"rule_id": 1, "name": "Test11", "severity": null, "xql_query": "dataset = xdr_data \r\n| filter agent_hostname contains \"clhescvpr002\" \r\n\r\n", "is_enabled": true, "description": null, "alert_name": "Test11", "alert_category": null, "alert_type": null, "alert_description": null, "alert_domain": null, "alert_fields": null, "execution_mode": "SCHEDULED", "search_window": "1 hours", "simple_schedule": "30 minutes", "timezone": "America/New_York", "crontab": "*/30 * * * *", "suppression_enabled": false, "suppression_duration": null, "suppression_fields": null, "dataset": "Test", "user_defined_severity": null, "user_defined_category": null, "mitre_defs": null, "investigation_query_link": null, "drilldown_query_timeframe": null, "mapping_strategy": "CUSTOM", "action": "DATASET", "lookup_mapping": null}]